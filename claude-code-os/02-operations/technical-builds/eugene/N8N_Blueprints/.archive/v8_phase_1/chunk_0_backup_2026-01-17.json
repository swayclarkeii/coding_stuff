[
  {
    "type": "text",
    "text": "{\n  \"success\": true,\n  \"data\": {\n    \"updatedAt\": \"2026-01-12T19:19:59.058Z\",\n    \"createdAt\": \"2026-01-02T14:40:24.891Z\",\n    \"id\": \"zbxHkXOoD1qaz6OS\",\n    \"name\": \"AMA Chunk 0: Folder Initialization (V4 - Parameterized)\",\n    \"description\": null,\n    \"active\": true,\n    \"isArchived\": false,\n    \"nodes\": [\n      {\n        \"parameters\": {\n          \"jsCode\": \"// V4 REFACTORED: Accept client parameters from Pre-Chunk 0\\n// Input: client_name, client_normalized, parent_folder_id\\n\\nconst inputData = $input.first().json;\\nconst clientName = inputData.client_name || 'Unknown_Client';\\nconst clientNormalized = inputData.client_normalized || 'unknown_client';\\nconst parentFolderId = inputData.parent_folder_id || '1ikw3k-EgpVg_h2ySDdqdUFB7-FQyYDFm';\\n\\n// Dynamic root folder name based on client\\nconst rootFolderName = `${clientNormalized}_Documents`;\\n\\nconst folderConfig = {\\n  root: rootFolderName,\\n  clientName: clientName,\\n  clientNormalized: clientNormalized,\\n  parentFolderId: parentFolderId,\\n  staging: '_Staging',\\n  parents: [\\n    { name: 'OBJEKTUNTERLAGEN', varPrefix: 'OBJEKT' },\\n    { name: 'WIRTSCHAFTLICHE_UNTERLAGEN', varPrefix: 'WIRT' },\\n    { name: 'RECHTLICHE_UNTERLAGEN', varPrefix: 'RECHT' },\\n    { name: 'SONSTIGES', varPrefix: 'SONST' }\\n  ],\\n  subfolders: [\\n    // OBJEKTUNTERLAGEN\\n    { parent: 'OBJEKTUNTERLAGEN', name: '01_Projektbeschreibung', varName: 'FOLDER_01_PROJEKTBESCHREIBUNG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '02_Kaufvertrag', varName: 'FOLDER_02_KAUFVERTRAG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '03_Grundbuchauszug', varName: 'FOLDER_03_GRUNDBUCHAUSZUG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '04_Eintragungsbewilligungen', varName: 'FOLDER_04_EINTRAGUNGSBEWILLIGUNGEN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '05_Bodenrichtwert', varName: 'FOLDER_05_BODENRICHTWERT' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '06_Baulastenverzeichnis', varName: 'FOLDER_06_BAULASTENVERZEICHNIS' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '07_Altlastenkataster', varName: 'FOLDER_07_ALTLASTENKATASTER' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '08_Baugrundgutachten', varName: 'FOLDER_08_BAUGRUNDGUTACHTEN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '09_Lageplan', varName: 'FOLDER_09_LAGEPLAN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '10_Bautraegerkalkulation_DIN276', varName: 'FOLDER_10_BAUTRAEGERKALKULATION' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '15_Flaechenberechnung_DIN277', varName: 'FOLDER_15_FLAECHENBERECHNUNG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '16_GU_Werkvertraege', varName: 'FOLDER_16_GU_WERKVERTRAEGE' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '17_Bauzeichnungen', varName: 'FOLDER_17_BAUZEICHNUNGEN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '18_Baugenehmigung', varName: 'FOLDER_18_BAUGENEHMIGUNG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '22_Gutachterauftrag', varName: 'FOLDER_22_GUTACHTERAUFTRAG' },\\n    // WIRTSCHAFTLICHE_UNTERLAGEN\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '11_Verkaufspreise', varName: 'FOLDER_11_VERKAUFSPREISE' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '12_Bauzeitenplan_Liquiditaet', varName: 'FOLDER_12_BAUZEITENPLAN' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '13_Vertriebsweg', varName: 'FOLDER_13_VERTRIEBSWEG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '14_Bau_Ausstattungsbeschreibung', varName: 'FOLDER_14_AUSSTATTUNG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '19_Teilungserklaerung', varName: 'FOLDER_19_TEILUNGSERKLAERUNG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '20_Versicherungen', varName: 'FOLDER_20_VERSICHERUNGEN' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '21_Muster_Verkaufsvertrag', varName: 'FOLDER_21_MUSTER_VERKAUFSVERTRAG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '23_Umsatzsteuervoranmeldung', varName: 'FOLDER_23_USTVA' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '24_BWA', varName: 'FOLDER_24_BWA' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '25_Jahresabschluss', varName: 'FOLDER_25_JAHRESABSCHLUSS' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '26_Finanzierungsbestaetigung', varName: 'FOLDER_26_FINANZIERUNGSBESTAETIGUNG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '27_Darlehensvertrag', varName: 'FOLDER_27_DARLEHENSVERTRAG' },\\n    // RECHTLICHE_UNTERLAGEN\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '28_Gesellschaftsvertrag', varName: 'FOLDER_28_GESELLSCHAFTSVERTRAG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '29_Handelsregisterauszug', varName: 'FOLDER_29_HANDELSREGISTERAUSZUG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '30_Gewerbeanmeldung', varName: 'FOLDER_30_GEWERBEANMELDUNG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '31_Steuer_ID', varName: 'FOLDER_31_STEUER_ID' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '32_Freistellungsbescheinigung', varName: 'FOLDER_32_FREISTELLUNGSBESCHEINIGUNG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '33_Vollmachten', varName: 'FOLDER_33_VOLLMACHTEN' },\\n    // SONSTIGES\\n    { parent: 'SONSTIGES', name: '34_Korrespondenz', varName: 'FOLDER_34_KORRESPONDENZ' },\\n    { parent: 'SONSTIGES', name: '35_Sonstiges_Allgemein', varName: 'FOLDER_35_SONSTIGES_ALLGEMEIN' },\\n    { parent: 'SONSTIGES', name: '36_Exit_Strategie', varName: 'FOLDER_36_EXIT_STRATEGIE' },\\n    { parent: 'SONSTIGES', name: '37_Others', varName: 'FOLDER_37_OTHERS' },\\n    { parent: 'SONSTIGES', name: '38_Unknowns', varName: 'FOLDER_38_UNKNOWNS' },\\n    // V4: _Archive subfolders for document versioning\\n    { parent: 'OBJEKTUNTERLAGEN', name: '01_Projektbeschreibung/_Archive', varName: 'FOLDER_01_ARCHIVE' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '03_Grundbuchauszug/_Archive', varName: 'FOLDER_03_ARCHIVE' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '10_Bautraegerkalkulation_DIN276/_Archive', varName: 'FOLDER_10_ARCHIVE' },\\n    { parent: 'SONSTIGES', name: '36_Exit_Strategie/_Archive', varName: 'FOLDER_36_ARCHIVE' },\\n    // V8: Holding folders for SECONDARY document types (nested under categories)\\n    { parent: 'OBJEKTUNTERLAGEN', name: '_Holding_Property', varName: 'FOLDER_HOLDING_PROPERTY' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '_Holding_Financial', varName: 'FOLDER_HOLDING_FINANCIAL' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '_Holding_Legal', varName: 'FOLDER_HOLDING_LEGAL' },\\n    { parent: 'SONSTIGES', name: '_Holding_Misc', varName: 'FOLDER_HOLDING_MISC' }\\n  ]\\n};\\n\\nconst createdFolders = {\\n  root: null,\\n  staging: null,\\n  parents: {},\\n  subfolders: {}\\n};\\n\\nreturn [{ json: { folderConfig, createdFolders } }];\"\n        },\n        \"name\": \"Define Folder Structure\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          -176,\n          720\n        ],\n        \"id\": \"c8f728c0-0324-4c11-864b-04b43f17e4f2\"\n      },\n      {\n        \"parameters\": {\n          \"resource\": \"folder\",\n          \"name\": \"={{ $('Define Folder Structure').first().json.folderConfig.root }}\",\n          \"driveId\": {\n            \"__rl\": true,\n            \"mode\": \"list\",\n            \"value\": \"My Drive\"\n          },\n          \"folderId\": {\n            \"__rl\": true,\n            \"value\": \"={{ $('Define Folder Structure').first().json.folderConfig.parentFolderId }}\",\n            \"mode\": \"id\"\n          },\n          \"options\": {}\n        },\n        \"name\": \"Create Root Folder\",\n        \"type\": \"n8n-nodes-base.googleDrive\",\n        \"typeVersion\": 3,\n        \"position\": [\n          48,\n          720\n        ],\n        \"id\": \"11bf245e-6cfe-420c-b86f-d02f8e9b058e\",\n        \"credentials\": {\n          \"googleDriveOAuth2Api\": {\n            \"id\": \"a4m50EefR3DJoU0R\",\n            \"name\": \"Google Drive account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// V4: Prepare parent folders for batch creation\\n// FIXED: Use .first() instead of .item for consistency\\nconst folderConfig = $('Define Folder Structure').first().json.folderConfig;\\nconst rootFolderId = $input.first().json.id;\\n\\nconst parentItems = folderConfig.parents.map(p => ({\\n  parentName: p.name,\\n  parentFolderId: rootFolderId,\\n  varPrefix: p.varPrefix\\n}));\\n\\n// Add staging folder\\nparentItems.push({\\n  parentName: folderConfig.staging,\\n  parentFolderId: rootFolderId,\\n  varPrefix: 'STAGING'\\n});\\n\\nreturn parentItems.map(item => ({ json: item }));\"\n        },\n        \"name\": \"Prepare Parent Folders\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          272,\n          720\n        ],\n        \"id\": \"853b0afc-5cd1-44fe-b35c-52d4bae15369\"\n      },\n      {\n        \"parameters\": {\n          \"options\": {}\n        },\n        \"name\": \"Loop Parents\",\n        \"type\": \"n8n-nodes-base.splitInBatches\",\n        \"typeVersion\": 3,\n        \"position\": [\n          496,\n          720\n        ],\n        \"id\": \"d1a114d4-648c-4a93-bd8a-1cf3ef1af770\"\n      },\n      {\n        \"parameters\": {\n          \"resource\": \"folder\",\n          \"name\": \"={{ $input.item.json.parentName }}\",\n          \"driveId\": {\n            \"__rl\": true,\n            \"mode\": \"list\",\n            \"value\": \"My Drive\"\n          },\n          \"folderId\": {\n            \"__rl\": true,\n            \"value\": \"={{ $input.item.json.parentFolderId }}\",\n            \"mode\": \"id\"\n          },\n          \"options\": {}\n        },\n        \"name\": \"Create Parent Folder\",\n        \"type\": \"n8n-nodes-base.googleDrive\",\n        \"typeVersion\": 3,\n        \"position\": [\n          720,\n          416\n        ],\n        \"id\": \"1af9f2cd-1dcc-4199-bad6-684fcaf3a39d\",\n        \"credentials\": {\n          \"googleDriveOAuth2Api\": {\n            \"id\": \"a4m50EefR3DJoU0R\",\n            \"name\": \"Google Drive account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// V4: Collect parent folder IDs and prepare subfolders\\n// FIXED: Use .first() instead of .item for nodes outside the loop context\\nconst folderConfig = $('Define Folder Structure').first().json.folderConfig;\\n\\n// CRITICAL FIX: Get parent folder IDs from INPUT (not from Create Parent Folder node)\\n// The input contains all parent folders that were created in the loop\\nconst parentItems = $input.all();\\nconst parentIds = {};\\nparentItems.forEach(item => {\\n  parentIds[item.json.name] = item.json.id;\\n});\\n\\nconsole.log('DEBUG: parentIds map:', JSON.stringify(parentIds));\\n\\n// Prepare subfolder items with their parent IDs\\nconst subfolderItems = folderConfig.subfolders.map(sf => {\\n  const result = {\\n    subfolderName: sf.name,\\n    parentFolderId: parentIds[sf.parent],\\n    parentName: sf.parent,\\n    varName: sf.varName\\n  };\\n  console.log('DEBUG: subfolder item:', JSON.stringify(result));\\n  return result;\\n});\\n\\nreturn subfolderItems.map(item => ({ json: item }));\"\n        },\n        \"name\": \"Prepare Subfolders\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          720,\n          816\n        ],\n        \"id\": \"9e95bf6f-93bb-4a8b-be93-aab4ca42929e\"\n      },\n      {\n        \"parameters\": {\n          \"options\": {\n            \"reset\": false\n          }\n        },\n        \"name\": \"Loop Subfolders\",\n        \"type\": \"n8n-nodes-base.splitInBatches\",\n        \"typeVersion\": 3,\n        \"position\": [\n          944,\n          816\n        ],\n        \"id\": \"0f0e5471-7503-4a28-be40-3c2f0a6b3f4a\"\n      },\n      {\n        \"parameters\": {\n          \"resource\": \"folder\",\n          \"name\": \"={{ $input.item.json.subfolderName }}\",\n          \"driveId\": {\n            \"__rl\": true,\n            \"value\": \"My Drive\",\n            \"mode\": \"list\"\n          },\n          \"folderId\": {\n            \"__rl\": true,\n            \"value\": \"={{ $input.item.json.parentFolderId }}\",\n            \"mode\": \"id\"\n          },\n          \"options\": {}\n        },\n        \"name\": \"Create Subfolder\",\n        \"type\": \"n8n-nodes-base.googleDrive\",\n        \"typeVersion\": 3,\n        \"position\": [\n          1168,\n          512\n        ],\n        \"id\": \"2fda7663-dc37-4754-b5dd-4a6a2942d0d0\",\n        \"credentials\": {\n          \"googleDriveOAuth2Api\": {\n            \"id\": \"a4m50EefR3DJoU0R\",\n            \"name\": \"Google Drive account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// V4: Collect all folder IDs from List All Folders output\\nconst allFolders = $input.all();\\n\\n// FIXED: Use .first() instead of .item for nodes outside the loop context\\nconst folderConfig = $('Define Folder Structure').first().json.folderConfig;\\n\\n// Create a map of folder name to folder ID\\nconst folderMap = {};\\nallFolders.forEach(item => {\\n  folderMap[item.json.name] = item.json.id;\\n});\\n\\nconst variables = [];\\n\\n// Root folder - use dynamic name from config\\nconst rootFolderName = folderConfig.root;\\nif (folderMap[rootFolderName]) {\\n  variables.push({\\n    Variable_Name: 'FOLDER_ROOT',\\n    Folder_ID: folderMap[rootFolderName],\\n    Updated: new Date().toISOString()\\n  });\\n}\\n\\n// Parent folders\\nconst parentMapping = {\\n  'OBJEKTUNTERLAGEN': 'FOLDER_OBJEKTUNTERLAGEN',\\n  'WIRTSCHAFTLICHE_UNTERLAGEN': 'FOLDER_WIRTSCHAFTLICHE_UNTERLAGEN',\\n  'RECHTLICHE_UNTERLAGEN': 'FOLDER_RECHTLICHE_UNTERLAGEN',\\n  'SONSTIGES': 'FOLDER_SONSTIGES',\\n  '_Staging': 'FOLDER_STAGING',\\n  // V8: Holding folders\\n  '_Holding_Property': 'FOLDER_HOLDING_PROPERTY',\\n  '_Holding_Financial': 'FOLDER_HOLDING_FINANCIAL',\\n  '_Holding_Legal': 'FOLDER_HOLDING_LEGAL',\\n  '_Holding_Misc': 'FOLDER_HOLDING_MISC'\\n};\\n\\nObject.keys(parentMapping).forEach(folderName => {\\n  if (folderMap[folderName]) {\\n    variables.push({\\n      Variable_Name: parentMapping[folderName],\\n      Folder_ID: folderMap[folderName],\\n      Updated: new Date().toISOString()\\n    });\\n  }\\n});\\n\\n// Subfolders\\nconst subfolderMapping = {\\n  '01_Projektbeschreibung': 'FOLDER_01_PROJEKTBESCHREIBUNG',\\n  '02_Kaufvertrag': 'FOLDER_02_KAUFVERTRAG',\\n  '03_Grundbuchauszug': 'FOLDER_03_GRUNDBUCHAUSZUG',\\n  '04_Eintragungsbewilligungen': 'FOLDER_04_EINTRAGUNGSBEWILLIGUNGEN',\\n  '05_Bodenrichtwert': 'FOLDER_05_BODENRICHTWERT',\\n  '06_Baulastenverzeichnis': 'FOLDER_06_BAULASTENVERZEICHNIS',\\n  '07_Altlastenkataster': 'FOLDER_07_ALTLASTENKATASTER',\\n  '08_Baugrundgutachten': 'FOLDER_08_BAUGRUNDGUTACHTEN',\\n  '09_Lageplan': 'FOLDER_09_LAGEPLAN',\\n  '10_Bautraegerkalkulation_DIN276': 'FOLDER_10_BAUTRAEGERKALKULATION',\\n  '15_Flaechenberechnung_DIN277': 'FOLDER_15_FLAECHENBERECHNUNG',\\n  '16_GU_Werkvertraege': 'FOLDER_16_GU_WERKVERTRAEGE',\\n  '17_Bauzeichnungen': 'FOLDER_17_BAUZEICHNUNGEN',\\n  '18_Baugenehmigung': 'FOLDER_18_BAUGENEHMIGUNG',\\n  '22_Gutachterauftrag': 'FOLDER_22_GUTACHTERAUFTRAG',\\n  '11_Verkaufspreise': 'FOLDER_11_VERKAUFSPREISE',\\n  '12_Bauzeitenplan_Liquiditaet': 'FOLDER_12_BAUZEITENPLAN',\\n  '13_Vertriebsweg': 'FOLDER_13_VERTRIEBSWEG',\\n  '14_Bau_Ausstattungsbeschreibung': 'FOLDER_14_AUSSTATTUNG',\\n  '19_Teilungserklaerung': 'FOLDER_19_TEILUNGSERKLAERUNG',\\n  '20_Versicherungen': 'FOLDER_20_VERSICHERUNGEN',\\n  '21_Muster_Verkaufsvertrag': 'FOLDER_21_MUSTER_VERKAUFSVERTRAG',\\n  '23_Umsatzsteuervoranmeldung': 'FOLDER_23_USTVA',\\n  '24_BWA': 'FOLDER_24_BWA',\\n  '25_Jahresabschluss': 'FOLDER_25_JAHRESABSCHLUSS',\\n  '26_Finanzierungsbestaetigung': 'FOLDER_26_FINANZIERUNGSBESTAETIGUNG',\\n  '27_Darlehensvertrag': 'FOLDER_27_DARLEHENSVERTRAG',\\n  '28_Gesellschaftsvertrag': 'FOLDER_28_GESELLSCHAFTSVERTRAG',\\n  '29_Handelsregisterauszug': 'FOLDER_29_HANDELSREGISTERAUSZUG',\\n  '30_Gewerbeanmeldung': 'FOLDER_30_GEWERBEANMELDUNG',\\n  '31_Steuer_ID': 'FOLDER_31_STEUER_ID',\\n  '32_Freistellungsbescheinigung': 'FOLDER_32_FREISTELLUNGSBESCHEINIGUNG',\\n  '33_Vollmachten': 'FOLDER_33_VOLLMACHTEN',\\n  '34_Korrespondenz': 'FOLDER_34_KORRESPONDENZ',\\n  '35_Sonstiges_Allgemein': 'FOLDER_35_SONSTIGES_ALLGEMEIN',\\n  '36_Exit_Strategie': 'FOLDER_36_EXIT_STRATEGIE',\\n  '37_Others': 'FOLDER_37_OTHERS',\\n  '38_Unknowns': 'FOLDER_38_UNKNOWNS',\\n  '_Archive': 'FOLDER_01_ARCHIVE'\\n};\\n\\nObject.keys(subfolderMapping).forEach(folderName => {\\n  if (folderMap[folderName]) {\\n    variables.push({\\n      Variable_Name: subfolderMapping[folderName],\\n      Folder_ID: folderMap[folderName],\\n      Updated: new Date().toISOString()\\n    });\\n  }\\n});\\n\\nconsole.log('Total variables collected:', variables.length);\\nreturn variables.map(v => ({ json: v }));\"\n        },\n        \"name\": \"Collect Folder IDs\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          1616,\n          864\n        ],\n        \"id\": \"fbf3dcc4-8162-419e-ba06-01063d458897\"\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"append\",\n          \"documentId\": {\n            \"__rl\": true,\n            \"mode\": \"id\",\n            \"value\": \"1-CPnCr3locAORVX5tUEoh6r0i-x3tQ_ROTN0VXatOAU\"\n          },\n          \"sheetName\": {\n            \"__rl\": true,\n            \"mode\": \"name\",\n            \"value\": \"AMA_Folder_IDs\"\n          },\n          \"range\": \"A:C\",\n          \"dataMode\": \"autoMapInputData\",\n          \"options\": {}\n        },\n        \"name\": \"Write Folder IDs to Sheet\",\n        \"type\": \"n8n-nodes-base.googleSheets\",\n        \"typeVersion\": 3,\n        \"position\": [\n          2064,\n          864\n        ],\n        \"id\": \"4584122e-32e1-4c8c-bb9f-5a42fe342121\",\n        \"credentials\": {\n          \"googleSheetsOAuth2Api\": {\n            \"id\": \"H7ewI1sOrDYabelt\",\n            \"name\": \"Google Sheets account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"resource\": \"fileFolder\",\n          \"searchMethod\": \"={{$('Create Root Folder').first().json.id}}\",\n          \"filter\": {},\n          \"options\": {}\n        },\n        \"id\": \"927f312e-0f98-4c6b-a769-6762ed70e2b5\",\n        \"name\": \"List All Folders\",\n        \"type\": \"n8n-nodes-base.googleDrive\",\n        \"typeVersion\": 3,\n        \"position\": [\n          1392,\n          864\n        ],\n        \"credentials\": {\n          \"googleDriveOAuth2Api\": {\n            \"id\": \"a4m50EefR3DJoU0R\",\n            \"name\": \"Google Drive account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"workflowInputs\": {\n            \"values\": [\n              {\n                \"name\": \"client_name\"\n              },\n              {\n                \"name\": \"client_normalized\"\n              },\n              {\n                \"name\": \"parent_folder_id\"\n              }\n            ]\n          }\n        },\n        \"id\": \"6be513df-15a5-4dbc-8c3d-c20597b4a222\",\n        \"name\": \"Execute Workflow Trigger\",\n        \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          -400,\n          720\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// Prepare data for Master Client Registry with EXACT field names matching sheet headers\\n// Get client info from the workflow trigger input\\nconst inputData = $('Execute Workflow Trigger').first().json;\\n\\n// FIX: Use the actual client_name from input (don't default to 'Unknown_Client')\\nconst clientNameRaw = inputData.client_name;\\nconst clientNormalized = inputData.client_normalized;\\n\\n// Get root folder ID from Create Root Folder node\\nconst rootFolderId = $('Create Root Folder').first().json.id || '';\\n\\n// Get staging folder ID from Collect Folder IDs output\\nconst allFolderData = $('Collect Folder IDs').all();\\nlet stagingFolderId = '';\\n\\nallFolderData.forEach(item => {\\n  if (item.json.Variable_Name === 'FOLDER_STAGING') {\\n    stagingFolderId = item.json.Folder_ID;\\n  }\\n});\\n\\n// Determine status based on client name pattern\\nconst isUnknownClient = clientNameRaw && clientNameRaw.startsWith('UNKNOWN_');\\nconst clientStatus = isUnknownClient ? 'PENDING_IDENTIFICATION' : 'ACTIVE';\\n\\n// CLEAN OUTPUT: Only fields that match Client_Registry columns\\nreturn [{\\n  json: {\\n    Client_Name: clientNameRaw,\\n    Client_Normalized: clientNormalized,\\n    Root_Folder_ID: rootFolderId,\\n    Staging_Folder_ID: stagingFolderId || rootFolderId,\\n    Date_Created: new Date().toISOString(),\\n    status: clientStatus\\n  }\\n}];\"\n        },\n        \"id\": \"fb80b9b6-cf54-472c-a30a-5c0d97bb0c91\",\n        \"name\": \"Prepare Registry Entry\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          2288,\n          864\n        ]\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"append\",\n          \"documentId\": {\n            \"__rl\": true,\n            \"mode\": \"id\",\n            \"value\": \"1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI\"\n          },\n          \"sheetName\": {\n            \"__rl\": true,\n            \"mode\": \"name\",\n            \"value\": \"Client_Registry\"\n          },\n          \"range\": \"A:F\",\n          \"fieldsUi\": {\n            \"fieldValues\": [\n              {\n                \"fieldId\": \"Client_Name\",\n                \"fieldValue\": \"={{ $json.Client_Name }}\"\n              },\n              {\n                \"fieldId\": \"Client_Normalized\",\n                \"fieldValue\": \"={{ $json.Client_Normalized }}\"\n              },\n              {\n                \"fieldId\": \"Root_Folder_ID\",\n                \"fieldValue\": \"={{ $json.Root_Folder_ID }}\"\n              },\n              {\n                \"fieldId\": \"Staging_Folder_ID\",\n                \"fieldValue\": \"={{ $json.Staging_Folder_ID }}\"\n              },\n              {\n                \"fieldId\": \"Date_Created\",\n                \"fieldValue\": \"={{ $json.Date_Created }}\"\n              },\n              {\n                \"fieldId\": \"status\",\n                \"fieldValue\": \"={{ $json.status }}\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"25a9641c-5278-4090-a4bf-a25883140e42\",\n        \"name\": \"Write to Client Registry\",\n        \"type\": \"n8n-nodes-base.googleSheets\",\n        \"typeVersion\": 3,\n        \"position\": [\n          2736,\n          864\n        ],\n        \"credentials\": {\n          \"googleSheetsOAuth2Api\": {\n            \"id\": \"H7ewI1sOrDYabelt\",\n            \"name\": \"Google Sheets account\"\n          }\n        }\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// CRITICAL FIX: Pass through items from Collect Folder IDs\\n// Use $input to ensure items actually flow through the connection\\n\\nconst items = $input.all();\\n\\nconsole.log('Transform for Sheet Write: Passing through', items.length, 'items');\\n\\n// Return items exactly as received from input\\nreturn items;\"\n        },\n        \"id\": \"transform-for-sheet-write\",\n        \"name\": \"Transform for Sheet Write\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          1840,\n          864\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// CRITICAL FIX: Pass through item from Prepare Registry Entry  \\n// Use $input to ensure item actually flows through the connection\\n\\nconst items = $input.all();\\n\\nconsole.log('Transform for Registry Write: Passing through', items.length, 'item(s)');\\n\\n// Return items exactly as received from input\\nreturn items;\"\n        },\n        \"id\": \"transform-for-registry-write\",\n        \"name\": \"Transform for Registry Write\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          2512,\n          864\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// CRITICAL FIX: Generate input item for List All Folders\\n// splitInBatches done signal has 0 items, but List All Folders needs folder ID to list\\n\\n// Get root folder ID from Create Root Folder node\\nconst rootFolderId = $('Create Root Folder').first().json.id;\\n\\nconsole.log('Prepare List All Input: Root folder ID:', rootFolderId);\\n\\n// Return single item with folder ID for List All Folders to use\\nreturn [{\\n  json: {\\n    folderId: rootFolderId\\n  }\\n}];\"\n        },\n        \"id\": \"prepare-list-all-input\",\n        \"name\": \"Prepare List All Input\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          1168,\n          864\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"// Final output: Add folderIDs array + Client_Registry data for return\\n// Now includes Client_Tracker write confirmation\\n\\n// Get the Write to Client_Tracker output (confirmation of tracker write)\\nconst trackerOutput = $input.first().json;\\n\\n// Get Client_Registry data from Write to Client Registry node\\nconst registryData = $('Write to Client Registry').first().json;\\n\\n// Get all folder IDs from Collect Folder IDs node\\nconst allFolderData = $('Collect Folder IDs').all();\\nconst folderIDs = allFolderData.map(item => ({\\n  Variable_Name: item.json.Variable_Name,\\n  Folder_ID: item.json.Folder_ID\\n}));\\n\\n// Return complete initialization result\\nreturn [{\\n  json: {\\n    // Registry data (for backward compatibility)\\n    Client_Name: registryData.Client_Name,\\n    Client_Normalized: registryData.Client_Normalized,\\n    Root_Folder_ID: registryData.Root_Folder_ID,\\n    Staging_Folder_ID: registryData.Staging_Folder_ID,\\n    Date_Created: registryData.Date_Created,\\n    status: registryData.status,\\n    // Folder IDs array (for UNKNOWN client path)\\n    folderIDs: folderIDs,\\n    // Tracker confirmation\\n    tracker_initialized: true,\\n    tracker_client_name: trackerOutput.Client_Name\\n  }\\n}];\\n\"\n        },\n        \"id\": \"add-folderids-return\",\n        \"name\": \"Add FolderIDs for Return\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          3136,\n          624\n        ],\n        \"notes\": \"Adds folderIDs array back after clean registry write. Prevents array corruption in Google Sheets while still providing folderIDs to calling workflow for UNKNOWN client path.\"\n      },\n      {\n        \"id\": \"prepare-client-tracker-row\",\n        \"name\": \"Prepare Client_Tracker Row\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          2960,\n          864\n        ],\n        \"parameters\": {\n          \"jsCode\": \"const folderIds = $input.first().json;\\nconst clientName = folderIds.Client_Name || '';\\nconst clientNormalized = clientName.toLowerCase().replace(/[^a-z0-9]/g, '_');\\n\\n// Map all 37 folder IDs to Client_Tracker columns\\nconst trackerRow = {\\n  Client_Name: clientName,\\n  '01_Expose': folderIds['01_Expose'] || '',\\n  '02_Grundbuch': folderIds['02_Grundbuch'] || '',\\n  '03_Calculation': folderIds['03_Calculation'] || '',\\n  '04_Exit_Strategy': folderIds['04_Exit_Strategy'] || '',\\n  '05_Offer': folderIds['05_Offer'] || '',\\n  '06_Acceptance': folderIds['06_Acceptance'] || '',\\n  '07_Notary_Contracts': folderIds['07_Notary_Contracts'] || '',\\n  '08_Financing': folderIds['08_Financing'] || '',\\n  '09_Due_Diligence': folderIds['09_Due_Diligence'] || '',\\n  '10_Technical_Due_Diligence': folderIds['10_Technical_Due_Diligence'] || '',\\n  '11_Legal_Due_Diligence': folderIds['11_Legal_Due_Diligence'] || '',\\n  '12_Completion': folderIds['12_Completion'] || '',\\n  '13_Handover': folderIds['13_Handover'] || '',\\n  '14_Backlog': folderIds['14_Backlog'] || '',\\n  '15_Scheduling': folderIds['15_Scheduling'] || '',\\n  '16_Project_Coordination': folderIds['16_Project_Coordination'] || '',\\n  '17_Accounting': folderIds['17_Accounting'] || '',\\n  '18_Communication_Client': folderIds['18_Communication_Client'] || '',\\n  '19_Permits': folderIds['19_Permits'] || '',\\n  '20_Budget_Tracking': folderIds['20_Budget_Tracking'] || '',\\n  '21_Progress_Photos': folderIds['21_Progress_Photos'] || '',\\n  '22_Quality_Control': folderIds['22_Quality_Control'] || '',\\n  '23_Marketing': folderIds['23_Marketing'] || '',\\n  '24_Tenant_Management': folderIds['24_Tenant_Management'] || '',\\n  '25_Property_Management': folderIds['25_Property_Management'] || '',\\n  '26_Sales_Preparation': folderIds['26_Sales_Preparation'] || '',\\n  '27_Sales_Coordination': folderIds['27_Sales_Coordination'] || '',\\n  '28_Exit_Docs': folderIds['28_Exit_Docs'] || '',\\n  '29_Archive': folderIds['29_Archive'] || '',\\n  '30_Meetings': folderIds['30_Meetings'] || '',\\n  '31_Reports': folderIds['31_Reports'] || '',\\n  '32_Contracts': folderIds['32_Contracts'] || '',\\n  '33_Invoices': folderIds['33_Invoices'] || '',\\n  '34_Correspondence': folderIds['34_Correspondence'] || '',\\n  '35_Risk_Management': folderIds['35_Risk_Management'] || '',\\n  '36_Insurance': folderIds['36_Insurance'] || '',\\n  '37_Others': folderIds['37_Others'] || '',\\n  Status_Expose: '',\\n  Status_Grundbuch: '',\\n  Status_Calculation: '',\\n  Status_Exit_Strategy: '',\\n  Last_Updated: new Date().toISOString()\\n};\\n\\nreturn {\\n  json: trackerRow\\n};\"\n        }\n      },\n      {\n        \"id\": \"write-to-client-tracker\",\n        \"name\": \"Write to Client_Tracker\",\n        \"type\": \"n8n-nodes-base.googleSheets\",\n        \"typeVersion\": 3,\n        \"position\": [\n          3184,\n          864\n        ],\n        \"parameters\": {\n          \"operation\": \"append\",\n          \"documentId\": {\n            \"__rl\": true,\n            \"mode\": \"id\",\n            \"value\": \"12N2C8iWeHkxJQ2qz7m3aTyZw3X1gXbyyyFa-rP0tD7I\"\n          },\n          \"sheetName\": {\n            \"__rl\": true,\n            \"mode\": \"name\",\n            \"value\": \"Client_Tracker\"\n          },\n          \"range\": \"A:AN\",\n          \"dataMode\": \"autoMapInputData\",\n          \"options\": {}\n        },\n        \"credentials\": {\n          \"googleSheetsOAuth2Api\": {\n            \"id\": \"H7ewI1sOrDYabelt\",\n            \"name\": \"Google Sheets account\"\n          }\n        }\n      }\n    ],\n    \"connections\": {\n      \"Define Folder Structure\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Create Root Folder\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Create Root Folder\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepare Parent Folders\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepare Parent Folders\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Loop Parents\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Loop Parents\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepare Subfolders\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Create Parent Folder\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Create Parent Folder\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Loop Parents\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepare Subfolders\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Loop Subfolders\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Loop Subfolders\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepare List All Input\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Create Subfolder\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Create Subfolder\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Loop Subfolders\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"List All Folders\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Collect Folder IDs\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Execute Workflow Trigger\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Define Folder Structure\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Write Folder IDs to Sheet\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepare Registry Entry\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Collect Folder IDs\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Transform for Sheet Write\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Transform for Sheet Write\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Write Folder IDs to Sheet\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepare Registry Entry\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Transform for Registry Write\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Transform for Registry Write\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Write to Client Registry\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepare List All Input\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"List All Folders\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Write to Client Registry\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Prepare Client_Tracker Row\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Prepare Client_Tracker Row\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Write to Client_Tracker\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Write to Client_Tracker\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Add FolderIDs for Return\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      }\n    },\n    \"settings\": {\n      \"executionOrder\": \"v1\",\n      \"callerPolicy\": \"workflowsFromSameOwner\",\n      \"availableInMCP\": false\n    },\n    \"staticData\": null,\n    \"meta\": null,\n    \"pinData\": {},\n    \"versionId\": \"5f0bf834-66ce-4d12-b4f1-b03b80c8cdbb\",\n    \"activeVersionId\": \"5f0bf834-66ce-4d12-b4f1-b03b80c8cdbb\",\n    \"versionCounter\": 141,\n    \"triggerCount\": 0,\n    \"shared\": [\n      {\n        \"updatedAt\": \"2026-01-02T14:40:24.891Z\",\n        \"createdAt\": \"2026-01-02T14:40:24.891Z\",\n        \"role\": \"workflow:owner\",\n        \"workflowId\": \"zbxHkXOoD1qaz6OS\",\n        \"projectId\": \"Rs8mhw052fnrzWZM\",\n        \"project\": {\n          \"updatedAt\": \"2025-12-31T15:54:29.115Z\",\n          \"createdAt\": \"2025-12-31T15:27:33.865Z\",\n          \"id\": \"Rs8mhw052fnrzWZM\",\n          \"name\": \"Sway Clarke <sway@oloxa.ai>\",\n          \"type\": \"personal\",\n          \"icon\": null,\n          \"description\": null,\n          \"creatorId\": \"e9bd9112-c2e3-4f67-873a-e1001baeafd8\",\n          \"projectRelations\": [\n            {\n              \"updatedAt\": \"2025-12-31T15:27:33.865Z\",\n              \"createdAt\": \"2025-12-31T15:27:33.865Z\",\n              \"userId\": \"e9bd9112-c2e3-4f67-873a-e1001baeafd8\",\n              \"projectId\": \"Rs8mhw052fnrzWZM\",\n              \"user\": {\n                \"updatedAt\": \"2026-01-17T09:34:36.055Z\",\n                \"createdAt\": \"2025-12-31T15:27:33.119Z\",\n                \"id\": \"e9bd9112-c2e3-4f67-873a-e1001baeafd8\",\n                \"email\": \"sway@oloxa.ai\",\n                \"firstName\": \"Sway\",\n                \"lastName\": \"Clarke\",\n                \"personalizationAnswers\": {\n                  \"version\": \"v4\",\n                  \"personalization_survey_submitted_at\": \"2025-12-31T15:54:37.562Z\",\n                  \"personalization_survey_n8n_version\": \"2.1.4\"\n                },\n                \"settings\": {\n                  \"userActivated\": true,\n                  \"easyAIWorkflowOnboarded\": true,\n                  \"firstSuccessfulWorkflowId\": \"zbxHkXOoD1qaz6OS\",\n                  \"userActivatedAt\": 1767398053308,\n                  \"npsSurvey\": {\n                    \"responded\": true,\n                    \"lastShownAt\": 1767684846804\n                  }\n                },\n                \"disabled\": false,\n                \"mfaEnabled\": false,\n                \"lastActiveAt\": \"2026-01-16\",\n                \"isPending\": false\n              }\n            }\n          ]\n        }\n      }\n    ],\n    \"tags\": [],\n    \"activeVersion\": {\n      \"updatedAt\": \"2026-01-12T19:19:59.062Z\",\n      \"createdAt\": \"2026-01-12T19:19:59.062Z\",\n      \"versionId\": \"5f0bf834-66ce-4d12-b4f1-b03b80c8cdbb\",\n      \"workflowId\": \"zbxHkXOoD1qaz6OS\",\n      \"nodes\": [\n        {\n          \"parameters\": {\n            \"jsCode\": \"// V4 REFACTORED: Accept client parameters from Pre-Chunk 0\\n// Input: client_name, client_normalized, parent_folder_id\\n\\nconst inputData = $input.first().json;\\nconst clientName = inputData.client_name || 'Unknown_Client';\\nconst clientNormalized = inputData.client_normalized || 'unknown_client';\\nconst parentFolderId = inputData.parent_folder_id || '1ikw3k-EgpVg_h2ySDdqdUFB7-FQyYDFm';\\n\\n// Dynamic root folder name based on client\\nconst rootFolderName = `${clientNormalized}_Documents`;\\n\\nconst folderConfig = {\\n  root: rootFolderName,\\n  clientName: clientName,\\n  clientNormalized: clientNormalized,\\n  parentFolderId: parentFolderId,\\n  staging: '_Staging',\\n  parents: [\\n    { name: 'OBJEKTUNTERLAGEN', varPrefix: 'OBJEKT' },\\n    { name: 'WIRTSCHAFTLICHE_UNTERLAGEN', varPrefix: 'WIRT' },\\n    { name: 'RECHTLICHE_UNTERLAGEN', varPrefix: 'RECHT' },\\n    { name: 'SONSTIGES', varPrefix: 'SONST' }\\n  ],\\n  subfolders: [\\n    // OBJEKTUNTERLAGEN\\n    { parent: 'OBJEKTUNTERLAGEN', name: '01_Projektbeschreibung', varName: 'FOLDER_01_PROJEKTBESCHREIBUNG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '02_Kaufvertrag', varName: 'FOLDER_02_KAUFVERTRAG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '03_Grundbuchauszug', varName: 'FOLDER_03_GRUNDBUCHAUSZUG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '04_Eintragungsbewilligungen', varName: 'FOLDER_04_EINTRAGUNGSBEWILLIGUNGEN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '05_Bodenrichtwert', varName: 'FOLDER_05_BODENRICHTWERT' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '06_Baulastenverzeichnis', varName: 'FOLDER_06_BAULASTENVERZEICHNIS' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '07_Altlastenkataster', varName: 'FOLDER_07_ALTLASTENKATASTER' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '08_Baugrundgutachten', varName: 'FOLDER_08_BAUGRUNDGUTACHTEN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '09_Lageplan', varName: 'FOLDER_09_LAGEPLAN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '10_Bautraegerkalkulation_DIN276', varName: 'FOLDER_10_BAUTRAEGERKALKULATION' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '15_Flaechenberechnung_DIN277', varName: 'FOLDER_15_FLAECHENBERECHNUNG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '16_GU_Werkvertraege', varName: 'FOLDER_16_GU_WERKVERTRAEGE' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '17_Bauzeichnungen', varName: 'FOLDER_17_BAUZEICHNUNGEN' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '18_Baugenehmigung', varName: 'FOLDER_18_BAUGENEHMIGUNG' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '22_Gutachterauftrag', varName: 'FOLDER_22_GUTACHTERAUFTRAG' },\\n    // WIRTSCHAFTLICHE_UNTERLAGEN\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '11_Verkaufspreise', varName: 'FOLDER_11_VERKAUFSPREISE' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '12_Bauzeitenplan_Liquiditaet', varName: 'FOLDER_12_BAUZEITENPLAN' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '13_Vertriebsweg', varName: 'FOLDER_13_VERTRIEBSWEG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '14_Bau_Ausstattungsbeschreibung', varName: 'FOLDER_14_AUSSTATTUNG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '19_Teilungserklaerung', varName: 'FOLDER_19_TEILUNGSERKLAERUNG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '20_Versicherungen', varName: 'FOLDER_20_VERSICHERUNGEN' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '21_Muster_Verkaufsvertrag', varName: 'FOLDER_21_MUSTER_VERKAUFSVERTRAG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '23_Umsatzsteuervoranmeldung', varName: 'FOLDER_23_USTVA' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '24_BWA', varName: 'FOLDER_24_BWA' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '25_Jahresabschluss', varName: 'FOLDER_25_JAHRESABSCHLUSS' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '26_Finanzierungsbestaetigung', varName: 'FOLDER_26_FINANZIERUNGSBESTAETIGUNG' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '27_Darlehensvertrag', varName: 'FOLDER_27_DARLEHENSVERTRAG' },\\n    // RECHTLICHE_UNTERLAGEN\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '28_Gesellschaftsvertrag', varName: 'FOLDER_28_GESELLSCHAFTSVERTRAG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '29_Handelsregisterauszug', varName: 'FOLDER_29_HANDELSREGISTERAUSZUG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '30_Gewerbeanmeldung', varName: 'FOLDER_30_GEWERBEANMELDUNG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '31_Steuer_ID', varName: 'FOLDER_31_STEUER_ID' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '32_Freistellungsbescheinigung', varName: 'FOLDER_32_FREISTELLUNGSBESCHEINIGUNG' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '33_Vollmachten', varName: 'FOLDER_33_VOLLMACHTEN' },\\n    // SONSTIGES\\n    { parent: 'SONSTIGES', name: '34_Korrespondenz', varName: 'FOLDER_34_KORRESPONDENZ' },\\n    { parent: 'SONSTIGES', name: '35_Sonstiges_Allgemein', varName: 'FOLDER_35_SONSTIGES_ALLGEMEIN' },\\n    { parent: 'SONSTIGES', name: '36_Exit_Strategie', varName: 'FOLDER_36_EXIT_STRATEGIE' },\\n    { parent: 'SONSTIGES', name: '37_Others', varName: 'FOLDER_37_OTHERS' },\\n    { parent: 'SONSTIGES', name: '38_Unknowns', varName: 'FOLDER_38_UNKNOWNS' },\\n    // V4: _Archive subfolders for document versioning\\n    { parent: 'OBJEKTUNTERLAGEN', name: '01_Projektbeschreibung/_Archive', varName: 'FOLDER_01_ARCHIVE' },\\n    { parent: 'OBJEKTUNTERLAGEN', name: '03_Grundbuchauszug/_Archive', varName: 'FOLDER_03_ARCHIVE' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '10_Bautraegerkalkulation_DIN276/_Archive', varName: 'FOLDER_10_ARCHIVE' },\\n    { parent: 'SONSTIGES', name: '36_Exit_Strategie/_Archive', varName: 'FOLDER_36_ARCHIVE' },\\n    // V8: Holding folders for SECONDARY document types (nested under categories)\\n    { parent: 'OBJEKTUNTERLAGEN', name: '_Holding_Property', varName: 'FOLDER_HOLDING_PROPERTY' },\\n    { parent: 'WIRTSCHAFTLICHE_UNTERLAGEN', name: '_Holding_Financial', varName: 'FOLDER_HOLDING_FINANCIAL' },\\n    { parent: 'RECHTLICHE_UNTERLAGEN', name: '_Holding_Legal', varName: 'FOLDER_HOLDING_LEGAL' },\\n    { parent: 'SONSTIGES', name: '_Holding_Misc', varName: 'FOLDER_HOLDING_MISC' }\\n  ]\\n};\\n\\nconst createdFolders = {\\n  root: null,\\n  staging: null,\\n  parents: {},\\n  subfolders: {}\\n};\\n\\nreturn [{ json: { folderConfig, createdFolders } }];\"\n          },\n          \"name\": \"Define Folder Structure\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            -176,\n            720\n          ],\n          \"id\": \"c8f728c0-0324-4c11-864b-04b43f17e4f2\"\n        },\n        {\n          \"parameters\": {\n            \"resource\": \"folder\",\n            \"name\": \"={{ $('Define Folder Structure').first().json.folderConfig.root }}\",\n            \"driveId\": {\n              \"__rl\": true,\n              \"mode\": \"list\",\n              \"value\": \"My Drive\"\n            },\n            \"folderId\": {\n              \"__rl\": true,\n              \"value\": \"={{ $('Define Folder Structure').first().json.folderConfig.parentFolderId }}\",\n              \"mode\": \"id\"\n            },\n            \"options\": {}\n          },\n          \"name\": \"Create Root Folder\",\n          \"type\": \"n8n-nodes-base.googleDrive\",\n          \"typeVersion\": 3,\n          \"position\": [\n            48,\n            720\n          ],\n          \"id\": \"11bf245e-6cfe-420c-b86f-d02f8e9b058e\",\n          \"credentials\": {\n            \"googleDriveOAuth2Api\": {\n              \"id\": \"a4m50EefR3DJoU0R\",\n              \"name\": \"Google Drive account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// V4: Prepare parent folders for batch creation\\n// FIXED: Use .first() instead of .item for consistency\\nconst folderConfig = $('Define Folder Structure').first().json.folderConfig;\\nconst rootFolderId = $input.first().json.id;\\n\\nconst parentItems = folderConfig.parents.map(p => ({\\n  parentName: p.name,\\n  parentFolderId: rootFolderId,\\n  varPrefix: p.varPrefix\\n}));\\n\\n// Add staging folder\\nparentItems.push({\\n  parentName: folderConfig.staging,\\n  parentFolderId: rootFolderId,\\n  varPrefix: 'STAGING'\\n});\\n\\nreturn parentItems.map(item => ({ json: item }));\"\n          },\n          \"name\": \"Prepare Parent Folders\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            272,\n            720\n          ],\n          \"id\": \"853b0afc-5cd1-44fe-b35c-52d4bae15369\"\n        },\n        {\n          \"parameters\": {\n            \"options\": {}\n          },\n          \"name\": \"Loop Parents\",\n          \"type\": \"n8n-nodes-base.splitInBatches\",\n          \"typeVersion\": 3,\n          \"position\": [\n            496,\n            720\n          ],\n          \"id\": \"d1a114d4-648c-4a93-bd8a-1cf3ef1af770\"\n        },\n        {\n          \"parameters\": {\n            \"resource\": \"folder\",\n            \"name\": \"={{ $input.item.json.parentName }}\",\n            \"driveId\": {\n              \"__rl\": true,\n              \"mode\": \"list\",\n              \"value\": \"My Drive\"\n            },\n            \"folderId\": {\n              \"__rl\": true,\n              \"value\": \"={{ $input.item.json.parentFolderId }}\",\n              \"mode\": \"id\"\n            },\n            \"options\": {}\n          },\n          \"name\": \"Create Parent Folder\",\n          \"type\": \"n8n-nodes-base.googleDrive\",\n          \"typeVersion\": 3,\n          \"position\": [\n            720,\n            416\n          ],\n          \"id\": \"1af9f2cd-1dcc-4199-bad6-684fcaf3a39d\",\n          \"credentials\": {\n            \"googleDriveOAuth2Api\": {\n              \"id\": \"a4m50EefR3DJoU0R\",\n              \"name\": \"Google Drive account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// V4: Collect parent folder IDs and prepare subfolders\\n// FIXED: Use .first() instead of .item for nodes outside the loop context\\nconst folderConfig = $('Define Folder Structure').first().json.folderConfig;\\n\\n// CRITICAL FIX: Get parent folder IDs from INPUT (not from Create Parent Folder node)\\n// The input contains all parent folders that were created in the loop\\nconst parentItems = $input.all();\\nconst parentIds = {};\\nparentItems.forEach(item => {\\n  parentIds[item.json.name] = item.json.id;\\n});\\n\\nconsole.log('DEBUG: parentIds map:', JSON.stringify(parentIds));\\n\\n// Prepare subfolder items with their parent IDs\\nconst subfolderItems = folderConfig.subfolders.map(sf => {\\n  const result = {\\n    subfolderName: sf.name,\\n    parentFolderId: parentIds[sf.parent],\\n    parentName: sf.parent,\\n    varName: sf.varName\\n  };\\n  console.log('DEBUG: subfolder item:', JSON.stringify(result));\\n  return result;\\n});\\n\\nreturn subfolderItems.map(item => ({ json: item }));\"\n          },\n          \"name\": \"Prepare Subfolders\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            720,\n            816\n          ],\n          \"id\": \"9e95bf6f-93bb-4a8b-be93-aab4ca42929e\"\n        },\n        {\n          \"parameters\": {\n            \"options\": {\n              \"reset\": false\n            }\n          },\n          \"name\": \"Loop Subfolders\",\n          \"type\": \"n8n-nodes-base.splitInBatches\",\n          \"typeVersion\": 3,\n          \"position\": [\n            944,\n            816\n          ],\n          \"id\": \"0f0e5471-7503-4a28-be40-3c2f0a6b3f4a\"\n        },\n        {\n          \"parameters\": {\n            \"resource\": \"folder\",\n            \"name\": \"={{ $input.item.json.subfolderName }}\",\n            \"driveId\": {\n              \"__rl\": true,\n              \"value\": \"My Drive\",\n              \"mode\": \"list\"\n            },\n            \"folderId\": {\n              \"__rl\": true,\n              \"value\": \"={{ $input.item.json.parentFolderId }}\",\n              \"mode\": \"id\"\n            },\n            \"options\": {}\n          },\n          \"name\": \"Create Subfolder\",\n          \"type\": \"n8n-nodes-base.googleDrive\",\n          \"typeVersion\": 3,\n          \"position\": [\n            1168,\n            512\n          ],\n          \"id\": \"2fda7663-dc37-4754-b5dd-4a6a2942d0d0\",\n          \"credentials\": {\n            \"googleDriveOAuth2Api\": {\n              \"id\": \"a4m50EefR3DJoU0R\",\n              \"name\": \"Google Drive account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// V4: Collect all folder IDs from List All Folders output\\nconst allFolders = $input.all();\\n\\n// FIXED: Use .first() instead of .item for nodes outside the loop context\\nconst folderConfig = $('Define Folder Structure').first().json.folderConfig;\\n\\n// Create a map of folder name to folder ID\\nconst folderMap = {};\\nallFolders.forEach(item => {\\n  folderMap[item.json.name] = item.json.id;\\n});\\n\\nconst variables = [];\\n\\n// Root folder - use dynamic name from config\\nconst rootFolderName = folderConfig.root;\\nif (folderMap[rootFolderName]) {\\n  variables.push({\\n    Variable_Name: 'FOLDER_ROOT',\\n    Folder_ID: folderMap[rootFolderName],\\n    Updated: new Date().toISOString()\\n  });\\n}\\n\\n// Parent folders\\nconst parentMapping = {\\n  'OBJEKTUNTERLAGEN': 'FOLDER_OBJEKTUNTERLAGEN',\\n  'WIRTSCHAFTLICHE_UNTERLAGEN': 'FOLDER_WIRTSCHAFTLICHE_UNTERLAGEN',\\n  'RECHTLICHE_UNTERLAGEN': 'FOLDER_RECHTLICHE_UNTERLAGEN',\\n  'SONSTIGES': 'FOLDER_SONSTIGES',\\n  '_Staging': 'FOLDER_STAGING',\\n  // V8: Holding folders\\n  '_Holding_Property': 'FOLDER_HOLDING_PROPERTY',\\n  '_Holding_Financial': 'FOLDER_HOLDING_FINANCIAL',\\n  '_Holding_Legal': 'FOLDER_HOLDING_LEGAL',\\n  '_Holding_Misc': 'FOLDER_HOLDING_MISC'\\n};\\n\\nObject.keys(parentMapping).forEach(folderName => {\\n  if (folderMap[folderName]) {\\n    variables.push({\\n      Variable_Name: parentMapping[folderName],\\n      Folder_ID: folderMap[folderName],\\n      Updated: new Date().toISOString()\\n    });\\n  }\\n});\\n\\n// Subfolders\\nconst subfolderMapping = {\\n  '01_Projektbeschreibung': 'FOLDER_01_PROJEKTBESCHREIBUNG',\\n  '02_Kaufvertrag': 'FOLDER_02_KAUFVERTRAG',\\n  '03_Grundbuchauszug': 'FOLDER_03_GRUNDBUCHAUSZUG',\\n  '04_Eintragungsbewilligungen': 'FOLDER_04_EINTRAGUNGSBEWILLIGUNGEN',\\n  '05_Bodenrichtwert': 'FOLDER_05_BODENRICHTWERT',\\n  '06_Baulastenverzeichnis': 'FOLDER_06_BAULASTENVERZEICHNIS',\\n  '07_Altlastenkataster': 'FOLDER_07_ALTLASTENKATASTER',\\n  '08_Baugrundgutachten': 'FOLDER_08_BAUGRUNDGUTACHTEN',\\n  '09_Lageplan': 'FOLDER_09_LAGEPLAN',\\n  '10_Bautraegerkalkulation_DIN276': 'FOLDER_10_BAUTRAEGERKALKULATION',\\n  '15_Flaechenberechnung_DIN277': 'FOLDER_15_FLAECHENBERECHNUNG',\\n  '16_GU_Werkvertraege': 'FOLDER_16_GU_WERKVERTRAEGE',\\n  '17_Bauzeichnungen': 'FOLDER_17_BAUZEICHNUNGEN',\\n  '18_Baugenehmigung': 'FOLDER_18_BAUGENEHMIGUNG',\\n  '22_Gutachterauftrag': 'FOLDER_22_GUTACHTERAUFTRAG',\\n  '11_Verkaufspreise': 'FOLDER_11_VERKAUFSPREISE',\\n  '12_Bauzeitenplan_Liquiditaet': 'FOLDER_12_BAUZEITENPLAN',\\n  '13_Vertriebsweg': 'FOLDER_13_VERTRIEBSWEG',\\n  '14_Bau_Ausstattungsbeschreibung': 'FOLDER_14_AUSSTATTUNG',\\n  '19_Teilungserklaerung': 'FOLDER_19_TEILUNGSERKLAERUNG',\\n  '20_Versicherungen': 'FOLDER_20_VERSICHERUNGEN',\\n  '21_Muster_Verkaufsvertrag': 'FOLDER_21_MUSTER_VERKAUFSVERTRAG',\\n  '23_Umsatzsteuervoranmeldung': 'FOLDER_23_USTVA',\\n  '24_BWA': 'FOLDER_24_BWA',\\n  '25_Jahresabschluss': 'FOLDER_25_JAHRESABSCHLUSS',\\n  '26_Finanzierungsbestaetigung': 'FOLDER_26_FINANZIERUNGSBESTAETIGUNG',\\n  '27_Darlehensvertrag': 'FOLDER_27_DARLEHENSVERTRAG',\\n  '28_Gesellschaftsvertrag': 'FOLDER_28_GESELLSCHAFTSVERTRAG',\\n  '29_Handelsregisterauszug': 'FOLDER_29_HANDELSREGISTERAUSZUG',\\n  '30_Gewerbeanmeldung': 'FOLDER_30_GEWERBEANMELDUNG',\\n  '31_Steuer_ID': 'FOLDER_31_STEUER_ID',\\n  '32_Freistellungsbescheinigung': 'FOLDER_32_FREISTELLUNGSBESCHEINIGUNG',\\n  '33_Vollmachten': 'FOLDER_33_VOLLMACHTEN',\\n  '34_Korrespondenz': 'FOLDER_34_KORRESPONDENZ',\\n  '35_Sonstiges_Allgemein': 'FOLDER_35_SONSTIGES_ALLGEMEIN',\\n  '36_Exit_Strategie': 'FOLDER_36_EXIT_STRATEGIE',\\n  '37_Others': 'FOLDER_37_OTHERS',\\n  '38_Unknowns': 'FOLDER_38_UNKNOWNS',\\n  '_Archive': 'FOLDER_01_ARCHIVE'\\n};\\n\\nObject.keys(subfolderMapping).forEach(folderName => {\\n  if (folderMap[folderName]) {\\n    variables.push({\\n      Variable_Name: subfolderMapping[folderName],\\n      Folder_ID: folderMap[folderName],\\n      Updated: new Date().toISOString()\\n    });\\n  }\\n});\\n\\nconsole.log('Total variables collected:', variables.length);\\nreturn variables.map(v => ({ json: v }));\"\n          },\n          \"name\": \"Collect Folder IDs\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            1616,\n            864\n          ],\n          \"id\": \"fbf3dcc4-8162-419e-ba06-01063d458897\"\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"append\",\n            \"documentId\": {\n              \"__rl\": true,\n              \"mode\": \"id\",\n              \"value\": \"1-CPnCr3locAORVX5tUEoh6r0i-x3tQ_ROTN0VXatOAU\"\n            },\n            \"sheetName\": {\n              \"__rl\": true,\n              \"mode\": \"name\",\n              \"value\": \"AMA_Folder_IDs\"\n            },\n            \"range\": \"A:C\",\n            \"dataMode\": \"autoMapInputData\",\n            \"options\": {}\n          },\n          \"name\": \"Write Folder IDs to Sheet\",\n          \"type\": \"n8n-nodes-base.googleSheets\",\n          \"typeVersion\": 3,\n          \"position\": [\n            2064,\n            864\n          ],\n          \"id\": \"4584122e-32e1-4c8c-bb9f-5a42fe342121\",\n          \"credentials\": {\n            \"googleSheetsOAuth2Api\": {\n              \"id\": \"H7ewI1sOrDYabelt\",\n              \"name\": \"Google Sheets account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"resource\": \"fileFolder\",\n            \"searchMethod\": \"={{$('Create Root Folder').first().json.id}}\",\n            \"filter\": {},\n            \"options\": {}\n          },\n          \"id\": \"927f312e-0f98-4c6b-a769-6762ed70e2b5\",\n          \"name\": \"List All Folders\",\n          \"type\": \"n8n-nodes-base.googleDrive\",\n          \"typeVersion\": 3,\n          \"position\": [\n            1392,\n            864\n          ],\n          \"credentials\": {\n            \"googleDriveOAuth2Api\": {\n              \"id\": \"a4m50EefR3DJoU0R\",\n              \"name\": \"Google Drive account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"workflowInputs\": {\n              \"values\": [\n                {\n                  \"name\": \"client_name\"\n                },\n                {\n                  \"name\": \"client_normalized\"\n                },\n                {\n                  \"name\": \"parent_folder_id\"\n                }\n              ]\n            }\n          },\n          \"id\": \"6be513df-15a5-4dbc-8c3d-c20597b4a222\",\n          \"name\": \"Execute Workflow Trigger\",\n          \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            -400,\n            720\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// Prepare data for Master Client Registry with EXACT field names matching sheet headers\\n// Get client info from the workflow trigger input\\nconst inputData = $('Execute Workflow Trigger').first().json;\\n\\n// FIX: Use the actual client_name from input (don't default to 'Unknown_Client')\\nconst clientNameRaw = inputData.client_name;\\nconst clientNormalized = inputData.client_normalized;\\n\\n// Get root folder ID from Create Root Folder node\\nconst rootFolderId = $('Create Root Folder').first().json.id || '';\\n\\n// Get staging folder ID from Collect Folder IDs output\\nconst allFolderData = $('Collect Folder IDs').all();\\nlet stagingFolderId = '';\\n\\nallFolderData.forEach(item => {\\n  if (item.json.Variable_Name === 'FOLDER_STAGING') {\\n    stagingFolderId = item.json.Folder_ID;\\n  }\\n});\\n\\n// Determine status based on client name pattern\\nconst isUnknownClient = clientNameRaw && clientNameRaw.startsWith('UNKNOWN_');\\nconst clientStatus = isUnknownClient ? 'PENDING_IDENTIFICATION' : 'ACTIVE';\\n\\n// CLEAN OUTPUT: Only fields that match Client_Registry columns\\nreturn [{\\n  json: {\\n    Client_Name: clientNameRaw,\\n    Client_Normalized: clientNormalized,\\n    Root_Folder_ID: rootFolderId,\\n    Staging_Folder_ID: stagingFolderId || rootFolderId,\\n    Date_Created: new Date().toISOString(),\\n    status: clientStatus\\n  }\\n}];\"\n          },\n          \"id\": \"fb80b9b6-cf54-472c-a30a-5c0d97bb0c91\",\n          \"name\": \"Prepare Registry Entry\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            2288,\n            864\n          ]\n        },\n        {\n          \"parameters\": {\n            \"operation\": \"append\",\n            \"documentId\": {\n              \"__rl\": true,\n              \"mode\": \"id\",\n              \"value\": \"1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI\"\n            },\n            \"sheetName\": {\n              \"__rl\": true,\n              \"mode\": \"name\",\n              \"value\": \"Client_Registry\"\n            },\n            \"range\": \"A:F\",\n            \"fieldsUi\": {\n              \"fieldValues\": [\n                {\n                  \"fieldId\": \"Client_Name\",\n                  \"fieldValue\": \"={{ $json.Client_Name }}\"\n                },\n                {\n                  \"fieldId\": \"Client_Normalized\",\n                  \"fieldValue\": \"={{ $json.Client_Normalized }}\"\n                },\n                {\n                  \"fieldId\": \"Root_Folder_ID\",\n                  \"fieldValue\": \"={{ $json.Root_Folder_ID }}\"\n                },\n                {\n                  \"fieldId\": \"Staging_Folder_ID\",\n                  \"fieldValue\": \"={{ $json.Staging_Folder_ID }}\"\n                },\n                {\n                  \"fieldId\": \"Date_Created\",\n                  \"fieldValue\": \"={{ $json.Date_Created }}\"\n                },\n                {\n                  \"fieldId\": \"status\",\n                  \"fieldValue\": \"={{ $json.status }}\"\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"25a9641c-5278-4090-a4bf-a25883140e42\",\n          \"name\": \"Write to Client Registry\",\n          \"type\": \"n8n-nodes-base.googleSheets\",\n          \"typeVersion\": 3,\n          \"position\": [\n            2736,\n            864\n          ],\n          \"credentials\": {\n            \"googleSheetsOAuth2Api\": {\n              \"id\": \"H7ewI1sOrDYabelt\",\n              \"name\": \"Google Sheets account\"\n            }\n          }\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// CRITICAL FIX: Pass through items from Collect Folder IDs\\n// Use $input to ensure items actually flow through the connection\\n\\nconst items = $input.all();\\n\\nconsole.log('Transform for Sheet Write: Passing through', items.length, 'items');\\n\\n// Return items exactly as received from input\\nreturn items;\"\n          },\n          \"id\": \"transform-for-sheet-write\",\n          \"name\": \"Transform for Sheet Write\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            1840,\n            864\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// CRITICAL FIX: Pass through item from Prepare Registry Entry  \\n// Use $input to ensure item actually flows through the connection\\n\\nconst items = $input.all();\\n\\nconsole.log('Transform for Registry Write: Passing through', items.length, 'item(s)');\\n\\n// Return items exactly as received from input\\nreturn items;\"\n          },\n          \"id\": \"transform-for-registry-write\",\n          \"name\": \"Transform for Registry Write\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            2512,\n            864\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// CRITICAL FIX: Generate input item for List All Folders\\n// splitInBatches done signal has 0 items, but List All Folders needs folder ID to list\\n\\n// Get root folder ID from Create Root Folder node\\nconst rootFolderId = $('Create Root Folder').first().json.id;\\n\\nconsole.log('Prepare List All Input: Root folder ID:', rootFolderId);\\n\\n// Return single item with folder ID for List All Folders to use\\nreturn [{\\n  json: {\\n    folderId: rootFolderId\\n  }\\n}];\"\n          },\n          \"id\": \"prepare-list-all-input\",\n          \"name\": \"Prepare List All Input\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            1168,\n            864\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"// Final output: Add folderIDs array + Client_Registry data for return\\n// Now includes Client_Tracker write confirmation\\n\\n// Get the Write to Client_Tracker output (confirmation of tracker write)\\nconst trackerOutput = $input.first().json;\\n\\n// Get Client_Registry data from Write to Client Registry node\\nconst registryData = $('Write to Client Registry').first().json;\\n\\n// Get all folder IDs from Collect Folder IDs node\\nconst allFolderData = $('Collect Folder IDs').all();\\nconst folderIDs = allFolderData.map(item => ({\\n  Variable_Name: item.json.Variable_Name,\\n  Folder_ID: item.json.Folder_ID\\n}));\\n\\n// Return complete initialization result\\nreturn [{\\n  json: {\\n    // Registry data (for backward compatibility)\\n    Client_Name: registryData.Client_Name,\\n    Client_Normalized: registryData.Client_Normalized,\\n    Root_Folder_ID: registryData.Root_Folder_ID,\\n    Staging_Folder_ID: registryData.Staging_Folder_ID,\\n    Date_Created: registryData.Date_Created,\\n    status: registryData.status,\\n    // Folder IDs array (for UNKNOWN client path)\\n    folderIDs: folderIDs,\\n    // Tracker confirmation\\n    tracker_initialized: true,\\n    tracker_client_name: trackerOutput.Client_Name\\n  }\\n}];\\n\"\n          },\n          \"id\": \"add-folderids-return\",\n          \"name\": \"Add FolderIDs for Return\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            3136,\n            624\n          ],\n          \"notes\": \"Adds folderIDs array back after clean registry write. Prevents array corruption in Google Sheets while still providing folderIDs to calling workflow for UNKNOWN client path.\"\n        },\n        {\n          \"id\": \"prepare-client-tracker-row\",\n          \"name\": \"Prepare Client_Tracker Row\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            2960,\n            864\n          ],\n          \"parameters\": {\n            \"jsCode\": \"const folderIds = $input.first().json;\\nconst clientName = folderIds.Client_Name || '';\\nconst clientNormalized = clientName.toLowerCase().replace(/[^a-z0-9]/g, '_');\\n\\n// Map all 37 folder IDs to Client_Tracker columns\\nconst trackerRow = {\\n  Client_Name: clientName,\\n  '01_Expose': folderIds['01_Expose'] || '',\\n  '02_Grundbuch': folderIds['02_Grundbuch'] || '',\\n  '03_Calculation': folderIds['03_Calculation'] || '',\\n  '04_Exit_Strategy': folderIds['04_Exit_Strategy'] || '',\\n  '05_Offer': folderIds['05_Offer'] || '',\\n  '06_Acceptance': folderIds['06_Acceptance'] || '',\\n  '07_Notary_Contracts': folderIds['07_Notary_Contracts'] || '',\\n  '08_Financing': folderIds['08_Financing'] || '',\\n  '09_Due_Diligence': folderIds['09_Due_Diligence'] || '',\\n  '10_Technical_Due_Diligence': folderIds['10_Technical_Due_Diligence'] || '',\\n  '11_Legal_Due_Diligence': folderIds['11_Legal_Due_Diligence'] || '',\\n  '12_Completion': folderIds['12_Completion'] || '',\\n  '13_Handover': folderIds['13_Handover'] || '',\\n  '14_Backlog': folderIds['14_Backlog'] || '',\\n  '15_Scheduling': folderIds['15_Scheduling'] || '',\\n  '16_Project_Coordination': folderIds['16_Project_Coordination'] || '',\\n  '17_Accounting': folderIds['17_Accounting'] || '',\\n  '18_Communication_Client': folderIds['18_Communication_Client'] || '',\\n  '19_Permits': folderIds['19_Permits'] || '',\\n  '20_Budget_Tracking': folderIds['20_Budget_Tracking'] || '',\\n  '21_Progress_Photos': folderIds['21_Progress_Photos'] || '',\\n  '22_Quality_Control': folderIds['22_Quality_Control'] || '',\\n  '23_Marketing': folderIds['23_Marketing'] || '',\\n  '24_Tenant_Management': folderIds['24_Tenant_Management'] || '',\\n  '25_Property_Management': folderIds['25_Property_Management'] || '',\\n  '26_Sales_Preparation': folderIds['26_Sales_Preparation'] || '',\\n  '27_Sales_Coordination': folderIds['27_Sales_Coordination'] || '',\\n  '28_Exit_Docs': folderIds['28_Exit_Docs'] || '',\\n  '29_Archive': folderIds['29_Archive'] || '',\\n  '30_Meetings': folderIds['30_Meetings'] || '',\\n  '31_Reports': folderIds['31_Reports'] || '',\\n  '32_Contracts': folderIds['32_Contracts'] || '',\\n  '33_Invoices': folderIds['33_Invoices'] || '',\\n  '34_Correspondence': folderIds['34_Correspondence'] || '',\\n  '35_Risk_Management': folderIds['35_Risk_Management'] || '',\\n  '36_Insurance': folderIds['36_Insurance'] || '',\\n  '37_Others': folderIds['37_Others'] || '',\\n  Status_Expose: '',\\n  Status_Grundbuch: '',\\n  Status_Calculation: '',\\n  Status_Exit_Strategy: '',\\n  Last_Updated: new Date().toISOString()\\n};\\n\\nreturn {\\n  json: trackerRow\\n};\"\n          }\n        },\n        {\n          \"id\": \"write-to-client-tracker\",\n          \"name\": \"Write to Client_Tracker\",\n          \"type\": \"n8n-nodes-base.googleSheets\",\n          \"typeVersion\": 3,\n          \"position\": [\n            3184,\n            864\n          ],\n          \"parameters\": {\n            \"operation\": \"append\",\n            \"documentId\": {\n              \"__rl\": true,\n              \"mode\": \"id\",\n              \"value\": \"12N2C8iWeHkxJQ2qz7m3aTyZw3X1gXbyyyFa-rP0tD7I\"\n            },\n            \"sheetName\": {\n              \"__rl\": true,\n              \"mode\": \"name\",\n              \"value\": \"Client_Tracker\"\n            },\n            \"range\": \"A:AN\",\n            \"dataMode\": \"autoMapInputData\",\n            \"options\": {}\n          },\n          \"credentials\": {\n            \"googleSheetsOAuth2Api\": {\n              \"id\": \"H7ewI1sOrDYabelt\",\n              \"name\": \"Google Sheets account\"\n            }\n          }\n        }\n      ],\n      \"connections\": {\n        \"Define Folder Structure\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Create Root Folder\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Create Root Folder\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepare Parent Folders\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepare Parent Folders\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Loop Parents\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Loop Parents\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepare Subfolders\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Create Parent Folder\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Create Parent Folder\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Loop Parents\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepare Subfolders\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Loop Subfolders\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Loop Subfolders\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepare List All Input\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Create Subfolder\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Create Subfolder\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Loop Subfolders\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"List All Folders\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Collect Folder IDs\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Execute Workflow Trigger\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Define Folder Structure\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Write Folder IDs to Sheet\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepare Registry Entry\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Collect Folder IDs\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Transform for Sheet Write\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Transform for Sheet Write\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Write Folder IDs to Sheet\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepare Registry Entry\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Transform for Registry Write\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Transform for Registry Write\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Write to Client Registry\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepare List All Input\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"List All Folders\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Write to Client Registry\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Prepare Client_Tracker Row\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Prepare Client_Tracker Row\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Write to Client_Tracker\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Write to Client_Tracker\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Add FolderIDs for Return\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        }\n      },\n      \"authors\": \"Sway Clarke\",\n      \"name\": null,\n      \"description\": null,\n      \"autosaved\": false,\n      \"workflowPublishHistory\": [\n        {\n          \"createdAt\": \"2026-01-12T19:19:59.246Z\",\n          \"id\": 710,\n          \"workflowId\": \"zbxHkXOoD1qaz6OS\",\n          \"versionId\": \"5f0bf834-66ce-4d12-b4f1-b03b80c8cdbb\",\n          \"event\": \"activated\",\n          \"userId\": \"e9bd9112-c2e3-4f67-873a-e1001baeafd8\"\n        }\n      ]\n    }\n  }\n}"
  }
]