{
  "success": true,
  "data": {
    "updatedAt": "2026-01-03T15:41:33.526Z",
    "createdAt": "2026-01-02T15:04:31.466Z",
    "id": "K1kYeyvokVHtOhoE",
    "name": "Autonomous Test Runner - Chunk Integration",
    "description": null,
    "active": true,
    "isArchived": false,
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "test-chunk-integration",
          "responseMode": "lastNode",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Test Webhook Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          240,
          400
        ],
        "webhookId": "8cd7fd4b-36b5-403a-9fea-8341196a8384"
      },
      {
        "parameters": {
          "jsCode": "// Comprehensive Test Data Generator with Edge Cases\nconst input = $input.first().json.body || $input.first().json;\n\nconst scenarios = {\n  'HP-01': { name: 'New Client Valid PDF', clientName: 'Test Corp Alpha ' + Date.now(), clientExists: false, simulateError: null },\n  'HP-02': { name: 'Existing Client', clientName: 'Eugene Wei', clientExists: true, simulateError: null },\n  'EC-01': { name: 'Corrupted PDF', clientName: null, simulateError: 'CORRUPTED_FILE', expectError: true },\n  'EC-02': { name: 'No Client Name', clientName: null, simulateError: 'MISSING_CLIENT_NAME', expectError: true },\n  'EC-08': { name: 'Special Characters', clientName: \"O'Brien Muller GmbH \" + Date.now(), clientExists: false, simulateError: null }\n};\n\n// Accept both scenarioId and testScenario for backward compatibility\nconst scenarioId = input.testScenario || input.scenarioId || 'HP-01';\nconst scenario = scenarios[scenarioId] || scenarios['HP-01'];\n\nreturn { json: {\n  testId: 'test_' + Date.now(),\n  scenarioId,\n  scenarioName: scenario.name,\n  clientName: scenario.clientName,\n  clientExists: scenario.clientExists || false,\n  simulateError: scenario.simulateError,\n  expectError: scenario.expectError || false,\n  parentFolderId: '1ikw3k-EgpVg_h2ySDdqdUFB7-FQyYDFm',\n  clientRegistrySheet: '1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI',\n  testStartTime: new Date().toISOString()\n}};"
        },
        "id": "prepare-test-data",
        "name": "Prepare Test Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          464,
          400
        ]
      },
      {
        "id": "8bc08c53-8d00-4572-b53d-4393ee4cb77b",
        "name": "Process Scenario",
        "type": "n8n-nodes-base.code",
        "typeVersion": 1,
        "position": [
          688,
          400
        ],
        "parameters": {
          "jsCode": "const data = $input.first().json;\n\n// For error simulation scenarios, add error handling metadata\nif (data.simulateError) {\n  const errorResponses = {\n    'CORRUPTED_FILE': { \n      handled: true, \n      action: 'quarantine', \n      message: 'Document quarantined - unreadable PDF' \n    },\n    'MISSING_CLIENT_NAME': { \n      handled: true, \n      action: 'manual_review', \n      message: 'Routed for manual review - no client name' \n    }\n  };\n  \n  data.errorHandling = errorResponses[data.simulateError] || { \n    handled: false, \n    action: 'unknown' \n  };\n  data.testPhase = 'error_simulation';\n} else {\n  data.testPhase = 'normal_execution';\n}\n\nreturn { json: data };"
        }
      },
      {
        "id": "conditional-route",
        "name": "Route to Chunk 0",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          912,
          400
        ],
        "parameters": {
          "jsCode": "// Pass data through only for normal scenarios\n// For error scenarios OR existing clients, skip Chunk 0\nconst data = $input.first().json;\n\nif (data.simulateError || data.clientExists) {\n  // Skip Chunk 0 for errors AND existing clients (idempotency)\n  return [];\n} else {\n  // Only run Chunk 0 for new clients\n  return { json: data };\n}"
        }
      },
      {
        "parameters": {
          "operation": "call_workflow",
          "source": "database",
          "workflowId": {
            "__rl": true,
            "value": "zbxHkXOoD1qaz6OS",
            "mode": "id"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "client_name": "={{ $json.clientName }}",
              "client_normalized": "={{ $json.clientName.toLowerCase().replace(/[^a-z0-9]/g, '_') }}",
              "parent_folder_id": "={{ $json.parentFolderId }}"
            }
          },
          "mode": "once",
          "options": {}
        },
        "id": "execute-chunk0",
        "name": "Execute Chunk 0",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.2,
        "position": [
          912,
          512
        ]
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "Client_Registry"
          },
          "operation": "read",
          "range": "A:Z",
          "options": {}
        },
        "id": "check-registry",
        "name": "Check Client Registry",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1120,
          512
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "H7ewI1sOrDYabelt",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "mode": "append",
          "options": {}
        },
        "id": "merge-results",
        "name": "Merge All Results",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3,
        "position": [
          1344,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Get merged data from Find Matching Client node\nconst data = $('Find Matching Client').first()?.json || {};\n\n// Extract test metadata\nconst testId = data.testId;\nconst scenarioId = data.scenarioId;\nconst scenarioName = data.scenarioName;\nconst clientName = data.clientName;\nconst testStartTime = data.testStartTime;\nconst executionPath = data.testPhase;\n\n// Check registry data (merged in by Find Matching Client)\nconst clientFound = !!data.Client_Name;\nconst registryClientName = data.Client_Name || null;\nconst rootFolderId = data.Root_Folder_ID || null;\n\n// Verification logic\nconst verifications = {\n  n8n: {\n    workflowExecuted: true,\n    chunk0Ran: !data.simulateError && !data.clientExists,\n    errorHandled: data.simulateError ? true : null\n  },\n  googleSheets: {\n    registryChecked: true,\n    clientFound: clientFound,\n    clientName: registryClientName\n  },\n  googleDrive: {\n    folderId: rootFolderId,\n    folderCreated: !!rootFolderId\n  }\n};\n\n// Determine overall status\nlet status = 'PASS';\nlet statusReason = 'All verifications passed';\n\nif (!data.simulateError && !data.clientExists) {\n  // New client path - should have registry + folder\n  if (!clientFound || !rootFolderId) {\n    status = 'FAIL';\n    statusReason = 'One or more verifications failed';\n  }\n} else if (data.clientExists) {\n  // Existing client path - should find in registry, no new folder\n  if (!clientFound) {\n    status = 'FAIL';\n    statusReason = 'Client should exist in registry but not found';\n  }\n} else if (data.simulateError) {\n  // Error path - shouldn't create anything\n  if (clientFound && rootFolderId) {\n    status = 'FAIL';\n    statusReason = 'Error case should not create client or folders';\n  }\n}\n\nreturn {\n  json: {\n    testId,\n    scenario: {\n      id: scenarioId,\n      name: scenarioName,\n      clientName\n    },\n    timing: {\n      start: testStartTime,\n      end: new Date().toISOString()\n    },\n    executionPath,\n    verifications,\n    errorHandling: data.simulateError ? { errorSimulated: true } : null,\n    status,\n    statusReason\n  }\n};"
        },
        "id": "verify-results",
        "name": "Verify Results",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1568,
          400
        ]
      },
      {
        "id": "199b49f9-acfd-46da-8220-c8142639fa82",
        "name": "Find Matching Client",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1400,
          400
        ],
        "parameters": {
          "jsCode": "// Filter the registry rows to find matching client\nconst allRows = $input.all();\nconst targetClientName = $('Prepare Test Data').first().json.clientName;\n\n// Find matching row (case-sensitive exact match)\nconst matchingRow = allRows.find(item => {\n  const row = item.json;\n  return row.Client_Name === targetClientName;\n});\n\n// Get test metadata from Process Scenario\nconst testMetadata = $('Process Scenario').first().json;\n\n// Merge test metadata with registry result\nconst result = {\n  ...testMetadata,\n  ...(matchingRow ? matchingRow.json : {})\n};\n\nreturn { json: result };"
        }
      }
    ],
    "connections": {
      "Test Webhook Trigger": {
        "main": [
          [
            {
              "node": "Prepare Test Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Test Data": {
        "main": [
          [
            {
              "node": "Process Scenario",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Scenario": {
        "main": [
          [
            {
              "node": "Route to Chunk 0",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check Client Registry",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route to Chunk 0": {
        "main": [
          [
            {
              "node": "Execute Chunk 0",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge All Results": {
        "main": [
          [
            {
              "node": "Verify Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Client Registry": {
        "main": [
          [
            {
              "node": "Find Matching Client",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Matching Client": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1",
      "callerPolicy": "workflowsFromSameOwner",
      "availableInMCP": false
    },
    "staticData": null,
    "meta": null,
    "pinData": null,
    "versionId": "f92d6685-98bb-404f-b462-ded9a891571d",
    "activeVersionId": "f92d6685-98bb-404f-b462-ded9a891571d",
    "versionCounter": 76,
    "triggerCount": 1,
    "shared": [
      {
        "updatedAt": "2026-01-02T15:04:31.466Z",
        "createdAt": "2026-01-02T15:04:31.466Z",
        "role": "workflow:owner",
        "workflowId": "K1kYeyvokVHtOhoE",
        "projectId": "Rs8mhw052fnrzWZM",
        "project": {
          "updatedAt": "2025-12-31T15:54:29.115Z",
          "createdAt": "2025-12-31T15:27:33.865Z",
          "id": "Rs8mhw052fnrzWZM",
          "name": "Sway Clarke <sway@oloxa.ai>",
          "type": "personal",
          "icon": null,
          "description": null,
          "creatorId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
          "projectRelations": [
            {
              "updatedAt": "2025-12-31T15:27:33.865Z",
              "createdAt": "2025-12-31T15:27:33.865Z",
              "userId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
              "projectId": "Rs8mhw052fnrzWZM",
              "user": {
                "updatedAt": "2026-01-04T23:00:49.437Z",
                "createdAt": "2025-12-31T15:27:33.119Z",
                "id": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
                "email": "sway@oloxa.ai",
                "firstName": "Sway",
                "lastName": "Clarke",
                "personalizationAnswers": {
                  "version": "v4",
                  "personalization_survey_submitted_at": "2025-12-31T15:54:37.562Z",
                  "personalization_survey_n8n_version": "2.1.4"
                },
                "settings": {
                  "userActivated": true,
                  "easyAIWorkflowOnboarded": true,
                  "firstSuccessfulWorkflowId": "zbxHkXOoD1qaz6OS",
                  "userActivatedAt": 1767398053308
                },
                "disabled": false,
                "mfaEnabled": false,
                "lastActiveAt": "2026-01-04",
                "isPending": false
              }
            }
          ]
        }
      }
    ],
    "tags": [],
    "activeVersion": {
      "updatedAt": "2026-01-03T15:41:33.529Z",
      "createdAt": "2026-01-03T15:41:33.529Z",
      "versionId": "f92d6685-98bb-404f-b462-ded9a891571d",
      "workflowId": "K1kYeyvokVHtOhoE",
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "test-chunk-integration",
            "responseMode": "lastNode",
            "options": {}
          },
          "id": "webhook-trigger",
          "name": "Test Webhook Trigger",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            240,
            400
          ],
          "webhookId": "8cd7fd4b-36b5-403a-9fea-8341196a8384"
        },
        {
          "parameters": {
            "jsCode": "// Comprehensive Test Data Generator with Edge Cases\nconst input = $input.first().json.body || $input.first().json;\n\nconst scenarios = {\n  'HP-01': { name: 'New Client Valid PDF', clientName: 'Test Corp Alpha ' + Date.now(), clientExists: false, simulateError: null },\n  'HP-02': { name: 'Existing Client', clientName: 'Eugene Wei', clientExists: true, simulateError: null },\n  'EC-01': { name: 'Corrupted PDF', clientName: null, simulateError: 'CORRUPTED_FILE', expectError: true },\n  'EC-02': { name: 'No Client Name', clientName: null, simulateError: 'MISSING_CLIENT_NAME', expectError: true },\n  'EC-08': { name: 'Special Characters', clientName: \"O'Brien Muller GmbH \" + Date.now(), clientExists: false, simulateError: null }\n};\n\n// Accept both scenarioId and testScenario for backward compatibility\nconst scenarioId = input.testScenario || input.scenarioId || 'HP-01';\nconst scenario = scenarios[scenarioId] || scenarios['HP-01'];\n\nreturn { json: {\n  testId: 'test_' + Date.now(),\n  scenarioId,\n  scenarioName: scenario.name,\n  clientName: scenario.clientName,\n  clientExists: scenario.clientExists || false,\n  simulateError: scenario.simulateError,\n  expectError: scenario.expectError || false,\n  parentFolderId: '1ikw3k-EgpVg_h2ySDdqdUFB7-FQyYDFm',\n  clientRegistrySheet: '1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI',\n  testStartTime: new Date().toISOString()\n}};"
          },
          "id": "prepare-test-data",
          "name": "Prepare Test Data",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            464,
            400
          ]
        },
        {
          "id": "8bc08c53-8d00-4572-b53d-4393ee4cb77b",
          "name": "Process Scenario",
          "type": "n8n-nodes-base.code",
          "typeVersion": 1,
          "position": [
            688,
            400
          ],
          "parameters": {
            "jsCode": "const data = $input.first().json;\n\n// For error simulation scenarios, add error handling metadata\nif (data.simulateError) {\n  const errorResponses = {\n    'CORRUPTED_FILE': { \n      handled: true, \n      action: 'quarantine', \n      message: 'Document quarantined - unreadable PDF' \n    },\n    'MISSING_CLIENT_NAME': { \n      handled: true, \n      action: 'manual_review', \n      message: 'Routed for manual review - no client name' \n    }\n  };\n  \n  data.errorHandling = errorResponses[data.simulateError] || { \n    handled: false, \n    action: 'unknown' \n  };\n  data.testPhase = 'error_simulation';\n} else {\n  data.testPhase = 'normal_execution';\n}\n\nreturn { json: data };"
          }
        },
        {
          "id": "conditional-route",
          "name": "Route to Chunk 0",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            912,
            400
          ],
          "parameters": {
            "jsCode": "// Pass data through only for normal scenarios\n// For error scenarios OR existing clients, skip Chunk 0\nconst data = $input.first().json;\n\nif (data.simulateError || data.clientExists) {\n  // Skip Chunk 0 for errors AND existing clients (idempotency)\n  return [];\n} else {\n  // Only run Chunk 0 for new clients\n  return { json: data };\n}"
          }
        },
        {
          "parameters": {
            "operation": "call_workflow",
            "source": "database",
            "workflowId": {
              "__rl": true,
              "value": "zbxHkXOoD1qaz6OS",
              "mode": "id"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "client_name": "={{ $json.clientName }}",
                "client_normalized": "={{ $json.clientName.toLowerCase().replace(/[^a-z0-9]/g, '_') }}",
                "parent_folder_id": "={{ $json.parentFolderId }}"
              }
            },
            "mode": "once",
            "options": {}
          },
          "id": "execute-chunk0",
          "name": "Execute Chunk 0",
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            912,
            512
          ]
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "mode": "list",
              "value": "1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI"
            },
            "sheetName": {
              "__rl": true,
              "mode": "name",
              "value": "Client_Registry"
            },
            "operation": "read",
            "range": "A:Z",
            "options": {}
          },
          "id": "check-registry",
          "name": "Check Client Registry",
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1120,
            512
          ],
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "H7ewI1sOrDYabelt",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "mode": "append",
            "options": {}
          },
          "id": "merge-results",
          "name": "Merge All Results",
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            1344,
            400
          ]
        },
        {
          "parameters": {
            "jsCode": "// Get merged data from Find Matching Client node\nconst data = $('Find Matching Client').first()?.json || {};\n\n// Extract test metadata\nconst testId = data.testId;\nconst scenarioId = data.scenarioId;\nconst scenarioName = data.scenarioName;\nconst clientName = data.clientName;\nconst testStartTime = data.testStartTime;\nconst executionPath = data.testPhase;\n\n// Check registry data (merged in by Find Matching Client)\nconst clientFound = !!data.Client_Name;\nconst registryClientName = data.Client_Name || null;\nconst rootFolderId = data.Root_Folder_ID || null;\n\n// Verification logic\nconst verifications = {\n  n8n: {\n    workflowExecuted: true,\n    chunk0Ran: !data.simulateError && !data.clientExists,\n    errorHandled: data.simulateError ? true : null\n  },\n  googleSheets: {\n    registryChecked: true,\n    clientFound: clientFound,\n    clientName: registryClientName\n  },\n  googleDrive: {\n    folderId: rootFolderId,\n    folderCreated: !!rootFolderId\n  }\n};\n\n// Determine overall status\nlet status = 'PASS';\nlet statusReason = 'All verifications passed';\n\nif (!data.simulateError && !data.clientExists) {\n  // New client path - should have registry + folder\n  if (!clientFound || !rootFolderId) {\n    status = 'FAIL';\n    statusReason = 'One or more verifications failed';\n  }\n} else if (data.clientExists) {\n  // Existing client path - should find in registry, no new folder\n  if (!clientFound) {\n    status = 'FAIL';\n    statusReason = 'Client should exist in registry but not found';\n  }\n} else if (data.simulateError) {\n  // Error path - shouldn't create anything\n  if (clientFound && rootFolderId) {\n    status = 'FAIL';\n    statusReason = 'Error case should not create client or folders';\n  }\n}\n\nreturn {\n  json: {\n    testId,\n    scenario: {\n      id: scenarioId,\n      name: scenarioName,\n      clientName\n    },\n    timing: {\n      start: testStartTime,\n      end: new Date().toISOString()\n    },\n    executionPath,\n    verifications,\n    errorHandling: data.simulateError ? { errorSimulated: true } : null,\n    status,\n    statusReason\n  }\n};"
          },
          "id": "verify-results",
          "name": "Verify Results",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1568,
            400
          ]
        },
        {
          "id": "199b49f9-acfd-46da-8220-c8142639fa82",
          "name": "Find Matching Client",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1400,
            400
          ],
          "parameters": {
            "jsCode": "// Filter the registry rows to find matching client\nconst allRows = $input.all();\nconst targetClientName = $('Prepare Test Data').first().json.clientName;\n\n// Find matching row (case-sensitive exact match)\nconst matchingRow = allRows.find(item => {\n  const row = item.json;\n  return row.Client_Name === targetClientName;\n});\n\n// Get test metadata from Process Scenario\nconst testMetadata = $('Process Scenario').first().json;\n\n// Merge test metadata with registry result\nconst result = {\n  ...testMetadata,\n  ...(matchingRow ? matchingRow.json : {})\n};\n\nreturn { json: result };"
          }
        }
      ],
      "connections": {
        "Test Webhook Trigger": {
          "main": [
            [
              {
                "node": "Prepare Test Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare Test Data": {
          "main": [
            [
              {
                "node": "Process Scenario",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Process Scenario": {
          "main": [
            [
              {
                "node": "Route to Chunk 0",
                "type": "main",
                "index": 0
              },
              {
                "node": "Check Client Registry",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Route to Chunk 0": {
          "main": [
            [
              {
                "node": "Execute Chunk 0",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge All Results": {
          "main": [
            [
              {
                "node": "Verify Results",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check Client Registry": {
          "main": [
            [
              {
                "node": "Find Matching Client",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find Matching Client": {
          "main": [
            [
              {
                "node": "Merge All Results",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "authors": "Sway Clarke",
      "name": null,
      "description": null,
      "autosaved": false,
      "workflowPublishHistory": [
        {
          "createdAt": "2026-01-03T15:41:33.687Z",
          "id": 68,
          "workflowId": "K1kYeyvokVHtOhoE",
          "versionId": "f92d6685-98bb-404f-b462-ded9a891571d",
          "event": "activated",
          "userId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8"
        }
      ]
    }
  }
}
