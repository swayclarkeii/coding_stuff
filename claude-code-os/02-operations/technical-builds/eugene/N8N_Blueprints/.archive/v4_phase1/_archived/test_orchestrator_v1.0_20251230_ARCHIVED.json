{
  "name": "Autonomous Test Runner - Chunk Integration",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "test-chunk-integration",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Test Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 400],
      "webhookId": "8cd7fd4b-36b5-403a-9fea-8341196a8384"
    },
    {
      "parameters": {
        "jsCode": "// Comprehensive Test Data Generator with Edge Cases\nconst input = $input.first().json.body || $input.first().json;\n\nconst scenarios = {\n  'HP-01': { name: 'New Client Valid PDF', clientName: 'Test Corp Alpha ' + Date.now(), clientExists: false, simulateError: null },\n  'HP-02': { name: 'Existing Client', clientName: 'Eugene Wei', clientExists: true, simulateError: null },\n  'EC-01': { name: 'Corrupted PDF', clientName: null, simulateError: 'CORRUPTED_FILE', expectError: true },\n  'EC-02': { name: 'No Client Name', clientName: null, simulateError: 'MISSING_CLIENT_NAME', expectError: true },\n  'EC-08': { name: 'Special Characters', clientName: \"O'Brien Muller GmbH \" + Date.now(), clientExists: false, simulateError: null }\n};\n\nconst scenarioId = input.scenarioId || 'HP-01';\nconst scenario = scenarios[scenarioId] || scenarios['HP-01'];\n\nreturn { json: {\n  testId: 'test_' + Date.now(),\n  scenarioId,\n  scenarioName: scenario.name,\n  clientName: scenario.clientName,\n  clientExists: scenario.clientExists || false,\n  simulateError: scenario.simulateError,\n  expectError: scenario.expectError || false,\n  parentFolderId: '1ikw3k-EgpVg_h2ySDdqdUFB7-FQyYDFm',\n  clientRegistrySheet: '1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI',\n  testStartTime: new Date().toISOString()\n}};"
      },
      "id": "prepare-test-data",
      "name": "Prepare Test Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [464, 400]
    },
    {
      "id": "8bc08c53-8d00-4572-b53d-4393ee4cb77b",
      "name": "Process Scenario",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [688, 400],
      "parameters": {
        "jsCode": "const data = $input.first().json;\nif (data.simulateError) {\n  data._skipExecution = true;\n  const errorResponses = {\n    'CORRUPTED_FILE': { handled: true, action: 'quarantine', message: 'Document quarantined - unreadable PDF' },\n    'MISSING_CLIENT_NAME': { handled: true, action: 'manual_review', message: 'Routed for manual review - no client name' }\n  };\n  data.errorHandling = errorResponses[data.simulateError] || { handled: false, action: 'unknown' };\n  data.chunk0Skipped = true;\n  data.testPhase = 'error_simulation';\n}\nreturn { json: data };"
      }
    },
    {
      "parameters": {
        "source": "database",
        "workflowId": {"__rl": true, "value": "Ui2rQFpMu9G1RTE1", "mode": "id"},
        "mode": "once",
        "options": {"waitForSubWorkflow": true}
      },
      "id": "execute-chunk0",
      "name": "Execute Chunk 0",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [912, 512]
    },
    {
      "parameters": {
        "documentId": {"__rl": true, "mode": "list", "value": "1T-jL-cLgplVeZ3EMroQxvGEqI5G7t81jRZ2qINDvXNI"},
        "sheetName": {"__rl": true, "mode": "list", "value": "gid=0"},
        "filtersUI": {
          "values": [
            {"lookupColumn": "Client Name", "lookupValue": "={{ $('Prepare Test Data').first().json.clientName }}"}
          ]
        },
        "options": {}
      },
      "id": "check-registry",
      "name": "Check Client Registry",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1120, 512],
      "credentials": {"googleSheetsOAuth2Api": {"id": "3AIbwgVoWqlgyVKF", "name": "Google Sheets account"}}
    },
    {
      "parameters": {"mode": "append", "options": {}},
      "id": "merge-results",
      "name": "Merge All Results",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [1344, 400]
    },
    {
      "parameters": {
        "jsCode": "// Comprehensive Cross-Platform Verification\nconst allInputs = $input.all();\nconst startData = $('Prepare Test Data').first().json;\n\n// Get data from different paths\nlet chunk0Data = null;\nlet registryData = null;\nlet errorData = null;\n\nfor (const item of allInputs) {\n  if (item.json.errorHandling) {\n    errorData = item.json;\n  } else if (item.json['Client Name'] || item.json.clientName) {\n    registryData = item.json;\n  } else if (item.json.rootFolderId || item.json.id) {\n    chunk0Data = item.json;\n  }\n}\n\nconst errorSimulated = !!errorData;\nconst expectedError = startData.expectError === true;\n\n// Build comprehensive report\nconst report = {\n  testId: startData.testId,\n  scenario: {\n    id: startData.scenarioId,\n    name: startData.scenarioName,\n    clientName: startData.clientName\n  },\n  timing: {\n    start: startData.testStartTime,\n    end: new Date().toISOString()\n  },\n  \n  // Execution path\n  executionPath: errorSimulated ? 'error_simulation' : 'normal_execution',\n  \n  // Platform verifications\n  verifications: {\n    n8n: {\n      workflowExecuted: true,\n      chunk0Ran: !errorSimulated,\n      errorHandled: errorSimulated ? errorData.errorHandling?.handled : null\n    },\n    googleSheets: {\n      registryChecked: !errorSimulated,\n      clientFound: registryData ? true : false,\n      clientName: registryData?.['Client Name'] || null\n    },\n    googleDrive: {\n      folderId: chunk0Data?.rootFolderId || chunk0Data?.id || null,\n      folderCreated: !!(chunk0Data?.rootFolderId || chunk0Data?.id)\n    }\n  },\n  \n  // Error handling (if applicable)\n  errorHandling: errorData ? {\n    type: startData.simulateError,\n    handled: errorData.errorHandling?.handled,\n    action: errorData.errorHandling?.action,\n    message: errorData.errorHandling?.message\n  } : null\n};\n\n// Calculate status\nif (expectedError) {\n  report.status = errorData?.errorHandling?.handled ? 'PASS' : 'FAIL';\n  report.statusReason = report.status === 'PASS' \n    ? 'Error correctly handled as expected' \n    : 'Error was not handled properly';\n} else {\n  const checks = [\n    report.verifications.n8n.chunk0Ran,\n    report.verifications.googleDrive.folderCreated\n  ];\n  report.status = checks.every(c => c) ? 'PASS' : 'FAIL';\n  report.statusReason = report.status === 'PASS'\n    ? 'All verifications passed'\n    : 'One or more verifications failed';\n}\n\nreturn { json: report };"
      },
      "id": "verify-results",
      "name": "Verify Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1568, 400]
    }
  ],
  "connections": {
    "Test Webhook Trigger": {"main": [[{"node": "Prepare Test Data", "type": "main", "index": 0}]]},
    "Prepare Test Data": {"main": [[{"node": "Process Scenario", "type": "main", "index": 0}]]},
    "Process Scenario": {"main": [[{"node": "Execute Chunk 0", "type": "main", "index": 0}]]},
    "Execute Chunk 0": {"main": [[{"node": "Check Client Registry", "type": "main", "index": 0}]]},
    "Check Client Registry": {"main": [[{"node": "Merge All Results", "type": "main", "index": 0}]]},
    "Merge All Results": {"main": [[{"node": "Verify Results", "type": "main", "index": 0}]]}
  },
  "settings": {"executionOrder": "v1", "callerPolicy": "workflowsFromSameOwner"},
  "meta": {
    "version": "1.0",
    "exported": "2025-12-30T09:41:50.000Z",
    "description": "Autonomous testing infrastructure with linear execution flow (fixed IF branching issue)",
    "workflowId": "EzPj1xtEZOy2UY3V",
    "breakthrough": "Replaced IF node branching with Code node linear flow to prevent premature webhook execution termination"
  }
}
