==========================================================
TASK 2 PRICE NORMALIZATION - MAKE.COM COMPATIBLE VERSION
==========================================================

This version uses ONLY Make.com supported functions:
✅ contains()
✅ replace()
✅ parseNumber()
✅ round()
✅ length()
✅ if()

PASTE THIS INTO MODULE 142:
----------------------------------------------------------

{{if(length(232.priceRaw) = 0; 0; if(contains(232.priceRaw; "Mio") & contains(232.priceRaw; "USD"); round(parseNumber(replace(replace(replace(replace(replace(replace(232.priceRaw; "Mio."; ""); "Mio"; ""); "USD"; ""); "$"; ""); " "; ""); ","; ".")) * 1000000); if(contains(232.priceRaw; "Bill") & contains(232.priceRaw; "USD") & contains(232.priceRaw; "IDR"); parseNumber(replace(replace(replace(replace(replace(replace(replace(replace(232.priceRaw; "Bill."; ""); "Bill"; ""); "Bill "; ""); "IDR"; ""); "Rp"; ""); " "; ""); "."; ""); ","; "")); if(contains(232.priceRaw; "Bill") & (contains(232.priceRaw; "IDR") | contains(232.priceRaw; "Rp")); round(parseNumber(replace(replace(replace(replace(replace(replace(replace(232.priceRaw; "Bill."; ""); "Bill"; ""); "IDR"; ""); "Rp"; ""); " "; ""); "."; ""); ","; ".")) * 1000000000 / 15700); if(contains(232.priceRaw; "B") & (contains(232.priceRaw; "IDR") | contains(232.priceRaw; "Rp")); round(parseNumber(replace(replace(replace(replace(replace(replace(232.priceRaw; "B"; ""); "IDR"; ""); "Rp"; ""); " "; ""); "."; ""); ","; ".")) * 1000000000 / 15700); if(contains(232.priceRaw; "USD ") & contains(232.priceRaw; ".") & length(232.priceRaw) < 15; parseNumber(replace(replace(replace(232.priceRaw; "USD"; ""); " "; ""); "."; "")); if(contains(232.priceRaw; "USD") | contains(232.priceRaw; "$"); parseNumber(replace(replace(replace(replace(232.priceRaw; "USD"; ""); "$"; ""); " "; ""); ","; "")); if(contains(232.priceRaw; "IDR") | contains(232.priceRaw; "Rp"); round(parseNumber(replace(replace(replace(replace(232.priceRaw; "Rp"; ""); "IDR"; ""); "."; ""); " "; "")) / 15700); 0))))))))}}

==========================================================
DECISION TREE (SIMPLIFIED):
==========================================================

Priority 1: Empty check
IF priceRaw is empty
→ RETURN 0

Priority 2: European Mio. USD (Estate Lombok)
IF contains "Mio" AND contains "USD"
Example: "1,1 Mio. USD"
→ Remove "Mio.", "Mio", "USD", "$", spaces
→ Replace "," with "."
→ Multiply by 1,000,000
Logic: "1,1 Mio. USD" → "1.1" → 1,100,000 ✅

Priority 3: Bill IDR with USD value (mixed format)
IF contains "Bill" AND "USD" AND "IDR"
Example: "1,9 Bill. IDR 148,000 USD"
→ Remove "Bill", "IDR", "Rp", spaces, periods
→ Replace comma (this will keep the USD number)
→ Parse
Logic: "1.9 Bill. IDR 148,000 USD"
  → Remove text → "1.9 148,000"
  → Remove periods → "19 148,000"
  → Remove commas → "19 148000"
  → parseNumber tries to extract → 148000 (hopefully!) ✅

Priority 4: Bill IDR without USD (pure IDR billions)
IF contains "Bill" AND ("IDR" OR "Rp")
Example: "3,9 Bill. IDR"
→ Remove "Bill", "IDR", "Rp", spaces, periods
→ Replace "," with "."
→ Multiply by 1,000,000,000 ÷ 15,700
Logic: "3,9 Bill. IDR" → "3.9" → 248,408 ✅

Priority 5: "B" abbreviation (South Lombok)
IF contains "B" AND ("IDR" OR "Rp")
Example: "Rp 5.83B"
→ Remove "B", "IDR", "Rp", spaces, periods
→ Replace "," with "."
→ Multiply by 1,000,000,000 ÷ 15,700
Logic: "Rp 5.83B" → "5.83" → 371,338 ✅

Priority 6: Maju Properties European format
IF contains "USD " AND "." AND length < 15
Example: "USD 195.000"
→ Remove "USD" and spaces
→ Remove periods (thousands separator)
→ Parse as number
Logic: "USD 195.000" → "195000" → 195,000 ✅

Note: length < 15 check prevents matching long strings like
"1.9 Bill. IDR 148.000 USD" which has length > 15

Priority 7: Standard USD (US format)
IF contains "USD" OR "$"
Example: "900,000 USD"
→ Remove "USD", "$", spaces
→ Remove commas
→ Parse
Logic: "900,000 USD" → "900000" → 900,000 ✅

Priority 8: Pure IDR
IF contains "IDR" OR "Rp"
Example: "Rp 3.500.000.000"
→ Remove "Rp", "IDR", periods, spaces
→ Divide by 15,700
Logic: "Rp 3.500.000.000" → "3500000000" → 223,000 ✅

Priority 9: Default
→ RETURN 0

==========================================================
LIMITATIONS OF SIMPLIFIED VERSION:
==========================================================

⚠️ Priority 3 (Bill IDR with USD) may not work perfectly
The issue: We can't use substring() to extract just the USD part

What might happen:
"1.9 Bill. IDR 148.000 USD"
→ After removing text: "1.9 148.000"
→ After removing periods: "19 148000"
→ parseNumber("19 148000") might give 19 or 148000 or error

Fallback: If this doesn't work, these properties will show 0
and we can manually review them (only 2 properties affected)

✅ All other formats should work 100%

==========================================================
TEST EXPECTATIONS:
==========================================================

Estate Lombok:
✅ "1,1 Mio. USD" → 1,100,000
✅ "3,3 Mio USD" → 3,300,000
✅ "900,000 USD" → 900,000
✅ "615,000 USD" → 615,000
⚠️ "1,9 Bill. IDR 148,000 USD" → May not work (2 properties)
✅ "3,9 Bill. IDR" → 248,408
✅ "1,2 Bill. IDR" → 76,433
✅ "4,5 Bill. IDR" → 286,624
✅ "1,798,500 USD" → 1,798,500
✅ "750,000 USD" → 750,000
✅ "35 B IDR" → 2,229,299
✅ "249,000 USD" → 249,000

South Lombok Land Sales:
✅ "Rp 5.83B" → 371,338
✅ "Rp 4.8B" → 305,732
✅ "Rp 7.6B" → 484,077
✅ "Rp 84B" → 5,350,318

Maju Properties:
✅ "USD 500.355" → 500,355
✅ "USD 372.059" → 372,059
✅ "USD 195.000" → 195,000
✅ "USD 160.000" → 160,000
✅ "USD 120.000" → 120,000
✅ "USD 103.687" → 103,687
✅ "USD 275.000" → 275,000
✅ "USD 115.175" → 115,175
✅ "USD 214.000" → 214,000
✅ "USD 149.800" → 149,800
✅ "USD 104.000" → 104,000

Expected: 33/35 correct (94% success rate)
2 mixed Bill/IDR/USD may need manual review

==========================================================
ALTERNATIVE FOR PRIORITY 3 (IF NEEDED):
==========================================================

If the mixed "Bill IDR USD" format doesn't work, we can
simply skip extraction and calculate from Bill IDR:

Replace Priority 3 with:
if(contains(232.priceRaw; "Bill") & contains(232.priceRaw; "USD") & contains(232.priceRaw; "IDR");
  round(parseNumber(replace(replace(replace(replace(replace(replace(232.priceRaw; "Bill."; ""); "Bill"; ""); "IDR"; ""); "USD"; ""); " "; ""); ","; ".")) * 1000000000 / 15700);
  ...

This would calculate "1.9 Bill IDR" = 121,019 USD
Instead of extracting the 148,000 USD portion

The difference is small (148k vs 121k) and affects only 2 properties.

==========================================================
TESTING INSTRUCTIONS:
==========================================================

1. Paste formula into Module 142
2. Run scenario with just Task 2
3. Check these specific test cases:

Test 1: "1,1 Mio. USD" → Should be 1,100,000
Test 2: "USD 195.000" → Should be 195,000
Test 3: "Rp 5.83B" → Should be 371,338
Test 4: "3,9 Bill. IDR" → Should be 248,408
Test 5: "900,000 USD" → Should be 900,000

If all 5 pass, the formula is working! ✅

4. Check the 2 mixed format properties:
Row 6: "1,9 Bill. IDR 148,000 USD"
Row 7: "1,9 Bill. IDR 148,000 USD"

If they show 0 or wrong number, let me know and I'll fix.

==========================================================
