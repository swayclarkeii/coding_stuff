{"browserLog":false,"closeCookieModals":false,"debugLog":true,"downloadCss":true,"downloadMedia":true,"globs":["https://reefpropertylombok.com/**","https://islandpropertylombok.com/**","https://discoverlombokproperty.com/**","https://www.nourestates.com/**"],"headless":true,"ignoreCorsAndCsp":false,"ignoreSslErrors":false,"injectJQuery":true,"keepUrlFragments":false,"linkSelector":"a[href*=\"/property/\"], a[href*=\"/projects/\"]","maxConcurrency":1,"maxCrawlingDepth":2,"maxRequestsPerCrawl":100,"minConcurrency":1,"pageFunction":"async function pageFunction(context) {\n    const { request, log } = context;\n\n    const isPropertyPage = request.url.includes('/property/') || (request.url.includes('/projects/') && request.url !== 'https://reefpropertylombok.com/projects/');\n    const isListingPage = request.url.includes('/city/') || request.url.includes('/search-results/') || request.url === 'https://reefpropertylombok.com/projects/' || request.url === 'https://www.nourestates.com/property-for-sale-kuta-lombok';\n\n    if (!isPropertyPage || isListingPage) {\n        log.info('Skipping non-property page:', request.url);\n        return null;\n    }\n\n    const bodyText = document.body.innerText;\n    const titleElement = document.querySelector('h1');\n    const title = titleElement ? titleElement.innerText.trim() : '';\n\n    let priceRaw = '';\n    const pricePatterns = [/\\$\\s*[\\d,]+K?/gi, /USD\\s*[\\d,]+K?/gi, /Rp\\s*[\\d.,]+\\s*(billion|million|B|M|juta|miliar)?/gi, /IDR\\s*[\\d.,]+/gi];\n    for (const pattern of pricePatterns) {\n        const matches = bodyText.match(pattern);\n        if (matches && matches.length > 0) {\n            priceRaw = matches[0];\n            break;\n        }\n    }\n\n    let ownership = '';\n    if (bodyText.match(/Freehold\\/HGB/i)) ownership = 'Freehold';\n    else if (bodyText.match(/Freehold/i)) ownership = 'Freehold';\n    else if (bodyText.match(/Leasehold/i)) ownership = 'Leasehold';\n    else if (bodyText.match(/HGB/i)) ownership = 'HGB';\n\n    let status = '';\n    if (bodyText.match(/For Sale/i)) status = 'For Sale';\n    else if (bodyText.match(/Sold/i)) status = 'Sold';\n    else if (bodyText.match(/For Rent/i)) status = 'For Rent';\n\n    let propertyType = 'Unknown';\n    if (bodyText.match(/\\bvilla\\b/i)) propertyType = 'Villa';\n    else if (bodyText.match(/\\bland\\b/i) || bodyText.match(/\\blot\\b/i) || bodyText.match(/\\bplot\\b/i)) propertyType = 'Land';\n    else if (bodyText.match(/\\bhouse\\b/i)) propertyType = 'House';\n\n    // v3 Enhancement #2: Add 'renovated' to Completed detection\n    let constructionStatus = 'Unknown';\n    if (bodyText.match(/\\bbuilt\\b/i) ||\n        bodyText.match(/\\bcompleted\\b/i) ||\n        bodyText.match(/\\bready to move\\b/i) ||\n        bodyText.match(/\\bmove-in ready\\b/i) ||\n        bodyText.match(/\\brenovated\\b/i)) {\n        constructionStatus = 'Completed';\n    }\n    else if (bodyText.match(/\\boff[\\s-]?plan\\b/i) ||\n             bodyText.match(/\\bpre-construction\\b/i)) {\n        constructionStatus = 'Off-Plan';\n    }\n    // v3 Enhancement #1: Add 'completion', 'available from', 'delivery', 'handover'\n    else if (bodyText.match(/\\bunder construction\\b/i) ||\n             bodyText.match(/\\bin construction\\b/i) ||\n             bodyText.match(/\\bin progress\\b/i) ||\n             bodyText.match(/\\bbeing built\\b/i) ||\n             bodyText.match(/\\bcompletion\\b/i) ||\n             bodyText.match(/\\bavailable from\\b/i) ||\n             bodyText.match(/\\bdelivery\\b/i) ||\n             bodyText.match(/\\bhandover\\b/i)) {\n        constructionStatus = 'Under Construction';\n    }\n\n    // v3 Enhancement #3: Flexible year detection (handles 'Month YYYY' format)\n    let yearBuilt = '';\n\n    // Pattern 1: Standard format (year built: 2025, construction: 2026, completion: 2026)\n    const yearMatch1 = bodyText.match(/(?:year\\s+built|built|construction|completion)\\s*:?\\s*(20\\d{2})/i);\n    if (yearMatch1) {\n        yearBuilt = yearMatch1[1];\n    }\n\n    // Pattern 2: Month + Year format (December 2026, January 2026)\n    if (!yearBuilt) {\n        const yearMatch2 = bodyText.match(/(?:january|february|march|april|may|june|july|august|september|october|november|december)\\s+(20\\d{2})/i);\n        if (yearMatch2) {\n            yearBuilt = yearMatch2[1];\n        }\n    }\n\n    // Pattern 3: Context-based (find year near completion/construction/available/delivery)\n    if (!yearBuilt) {\n        const yearMatch3 = bodyText.match(/(?:completion|construction|available|delivery|handover)[^.]*?(20\\d{2})/i);\n        if (yearMatch3) {\n            yearBuilt = yearMatch3[1];\n        }\n    }\n\n    // v3 Enhancement #4: Future year validation\n    if (yearBuilt) {\n        const currentYear = new Date().getFullYear();\n        const propYear = parseInt(yearBuilt, 10);\n\n        // Future year = likely under construction/off-plan\n        if (propYear > currentYear && constructionStatus === 'Unknown') {\n            constructionStatus = 'Under Construction';\n        }\n    }\n\n    // Location Detection - extract from title and specific selectors only to avoid false positives\n    let locationText = title.toLowerCase();\n    const locationSelectors = ['.property-location', '.location', 'address', '.property-address'];\n    for (const selector of locationSelectors) {\n        const elem = document.querySelector(selector);\n        if (elem && elem.innerText.trim()) {\n            locationText += ' ' + elem.innerText.toLowerCase();\n        }\n    }\n\n    const hasKuta = locationText.includes('kuta');\n    const hasSelong = locationText.includes('selong');\n    const hasFreehold = bodyText.toLowerCase().includes('freehold');\n    const hasLeasehold = bodyText.toLowerCase().includes('leasehold');\n\n    let source = 'Unknown';\n    if (request.url.includes('reefpropertylombok.com')) source = 'Reef Property Lombok';\n    else if (request.url.includes('islandpropertylombok.com')) source = 'Island Properties Lombok';\n    else if (request.url.includes('discoverlombokproperty.com')) source = 'Discover Lombok Property';\n    else if (request.url.includes('nourestates.com')) source = 'Nour Estates';\n\n    log.info('Extracted:', title, '| Price:', priceRaw, '| Construction:', constructionStatus, '| Year:', yearBuilt, '| Source:', source);\n\n    return { url: request.url, title, priceRaw, ownership, status, constructionStatus, yearBuilt, propertyType, source, hasKuta, hasSelong, hasFreehold, hasLeasehold, scrapedAt: new Date().toISOString() };\n}","pageLoadTimeoutSecs":60,"respectRobotsTxtFile":false,"startUrls":[{"url":"https://reefpropertylombok.com/projects/"},{"url":"https://islandpropertylombok.com/city/kuta/"},{"url":"https://discoverlombokproperty.com/search-results/?keyword=&location%5B%5D=kuta-mandalika"},{"url":"https://www.nourestates.com/property-for-sale-kuta-lombok"}],"useChrome":false,"runMode":"PRODUCTION","pseudoUrls":[],"excludes":[],"proxyConfiguration":{"useApifyProxy":true},"proxyRotation":"RECOMMENDED","initialCookies":[],"maxRequestRetries":3,"maxPagesPerCrawl":0,"maxResultsPerCrawl":0,"pageFunctionTimeoutSecs":60,"waitUntil":["networkidle2"],"breakpointLocation":"NONE","maxScrollHeightPixels":5000,"customData":{}}