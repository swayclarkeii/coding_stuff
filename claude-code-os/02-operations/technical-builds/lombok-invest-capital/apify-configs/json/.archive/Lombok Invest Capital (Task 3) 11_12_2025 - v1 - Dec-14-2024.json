{"browserLog":false,"closeCookieModals":true,"debugLog":true,"downloadCss":true,"downloadMedia":true,"globs":["https://www.bali-home-immo.com/**","https://www.invest-lombok.com/**"],"headless":true,"ignoreCorsAndCsp":false,"ignoreSslErrors":false,"injectJQuery":true,"keepUrlFragments":false,"linkSelector":"a[href*=\"/realestate-property/for-sale/\"], a[href*=\"/property/\"]","maxConcurrency":1,"maxCrawlingDepth":2,"maxInfiniteScrollHeight":5000,"maxPagesPerCrawl":100,"maxRequestRetries":3,"maxResultsPerCrawl":0,"maxScrollHeightPixels":5000,"pageFunction":"async function pageFunction(context) {\n    const { request, log } = context;\n    const url = request.url;\n\n    // === PROPERTY PAGE DETECTION ===\n    const isPropertyPage = \n        // Bali Home Immo: /realestate-property/for-sale/[type]/[ownership]/[location]/[slug]\n        (url.includes('bali-home-immo.com') && \n         url.includes('/realestate-property/for-sale/') && \n         url.split('/realestate-property/for-sale/')[1] && \n         url.split('/realestate-property/for-sale/')[1].split('/').length >= 3) ||\n        // Invest Lombok: /property/[slug]/ (not the listing page)\n        (url.includes('invest-lombok.com') && \n         url.includes('/property/') && \n         url !== 'https://www.invest-lombok.com/property/' &&\n         !url.endsWith('/property/'));\n\n    // === LISTING PAGES TO SKIP ===\n    const isListingPage = \n        // Bali Home Immo search/listing pages\n        url.includes('bali-home-immo.com/realestate-property?') ||\n        url === 'https://www.bali-home-immo.com/realestate-property' ||\n        // Invest Lombok listing page\n        url === 'https://www.invest-lombok.com/property/' ||\n        url === 'https://www.invest-lombok.com/' ||\n        url.includes('invest-lombok.com/property-type/');\n\n    // === SKIP NON-LOMBOK REGIONS ===\n    const bodyText = document.body.innerText.toLowerCase();\n    const isNonLombok = \n        // Bali Home Immo: Check Sub Area field or URL\n        (url.includes('bali-home-immo.com') && \n         !url.toLowerCase().includes('lombok') && \n         !bodyText.includes('sub area') && \n         !bodyText.includes('lombok')) ||\n        // Invest Lombok: Skip Sumbawa properties\n        (url.includes('invest-lombok.com') && \n         (url.toLowerCase().includes('sumbawa') || \n          bodyText.includes('sumbawa') || \n          bodyText.includes('sekongkang')));\n\n    if (isNonLombok) {\n        log.info('SKIPPED (Non-Lombok region):', url);\n        return null;\n    }\n\n    if (!isPropertyPage || isListingPage) {\n        log.info('SKIPPED (listing/non-property):', url);\n        return null;\n    }\n\n    // === EXTRACT DATA ===\n    const fullBodyText = document.body.innerText;\n    const titleElement = document.querySelector('h1');\n    const title = titleElement ? titleElement.innerText.trim() : '';\n\n    // === PRICE EXTRACTION (Multi-format) ===\n    let priceRaw = '';\n    const pricePatterns = [\n        /\\$[\\d,]+\\.?\\d*/gi,                                     // USD: $690,000.00\n        /USD\\s*[\\d,.]+/gi,                                       // USD 690,000\n        /IDR\\s*[\\d.,]+/gi,                                       // IDR 4.948.000.000\n        /Rp\\.?\\s*[\\d.,]+\\s*(B|Billion|M|Million|Miliar|Juta)?/gi, // Rp 4.948.000.000\n        /[\\d.,]+\\s*(IDR|Rupiah)/gi                               // 4.948.000.000 IDR\n    ];\n    for (const pattern of pricePatterns) {\n        const matches = fullBodyText.match(pattern);\n        if (matches && matches.length > 0) {\n            priceRaw = matches[0];\n            break;\n        }\n    }\n\n    // === OWNERSHIP EXTRACTION ===\n    let ownership = '';\n    if (fullBodyText.match(/\\bHGB\\b/i)) ownership = 'HGB';\n    else if (fullBodyText.match(/\\bFreehold\\b/i)) ownership = 'Freehold';\n    else if (fullBodyText.match(/\\bLeasehold\\b/i)) ownership = 'Leasehold';\n\n    // === STATUS EXTRACTION ===\n    let status = '';\n    if (fullBodyText.match(/\\bFor Sale\\b/i) || fullBodyText.match(/\\bSale\\b/i)) status = 'For Sale';\n    else if (fullBodyText.match(/\\bSold\\b/i)) status = 'Sold';\n    else if (fullBodyText.match(/\\bFor Rent\\b/i) || fullBodyText.match(/\\bLease\\b/i)) status = 'For Rent/Lease';\n\n    // === PROPERTY TYPE ===\n    let propertyType = 'Unknown';\n    if (fullBodyText.match(/\\bvilla\\b/i)) propertyType = 'Villa';\n    else if (fullBodyText.match(/\\bbungalow\\b/i)) propertyType = 'Villa';\n    else if (fullBodyText.match(/\\bresort\\b/i)) propertyType = 'Resort';\n    else if (fullBodyText.match(/\\bland\\b/i) || fullBodyText.match(/\\blot\\b/i)) propertyType = 'Land';\n    else if (fullBodyText.match(/\\bhouse\\b/i)) propertyType = 'House';\n\n    // === CONSTRUCTION STATUS DETECTION (Task 1 v4 logic) ===\n    let constructionStatus = 'Unknown';\n    if (fullBodyText.match(/\\bbuilt\\b/i) ||\n        fullBodyText.match(/\\bcompleted\\b/i) ||\n        fullBodyText.match(/\\bready to move\\b/i) ||\n        fullBodyText.match(/\\bmove-in ready\\b/i) ||\n        fullBodyText.match(/\\bbrand new\\b/i) ||\n        fullBodyText.match(/\\brenovated\\b/i)) {\n        constructionStatus = 'Completed';\n    }\n    else if (fullBodyText.match(/\\boff[\\s-]?plan\\b/i) ||\n             fullBodyText.match(/\\bpre-construction\\b/i)) {\n        constructionStatus = 'Off-Plan';\n    }\n    else if (fullBodyText.match(/\\bunder construction\\b/i) ||\n             fullBodyText.match(/\\bin construction\\b/i) ||\n             fullBodyText.match(/\\bin progress\\b/i) ||\n             fullBodyText.match(/\\bbeing built\\b/i) ||\n             fullBodyText.match(/\\bcompletion\\b/i) ||\n             fullBodyText.match(/\\bavailable from\\b/i) ||\n             fullBodyText.match(/\\bdelivery\\b/i) ||\n             fullBodyText.match(/\\bhandover\\b/i)) {\n        constructionStatus = 'Under Construction';\n    }\n\n    // === YEAR BUILT DETECTION (Bali Home Immo only) ===\n    let yearBuilt = '';\n    if (url.includes('bali-home-immo.com')) {\n        // Pattern 1: Standard format (year built: 2025, construction: 2026)\n        const yearMatch1 = fullBodyText.match(/(?:year\\s+built|built|construction|completion)\\s*:?\\s*(20\\d{2})/i);\n        if (yearMatch1) {\n            yearBuilt = yearMatch1[1];\n        }\n\n        // Pattern 2: Month + Year format\n        if (!yearBuilt) {\n            const yearMatch2 = fullBodyText.match(/(?:january|february|march|april|may|june|july|august|september|october|november|december)\\s+(20\\d{2})/i);\n            if (yearMatch2) {\n                yearBuilt = yearMatch2[1];\n            }\n        }\n\n        // Pattern 3: Context-based\n        if (!yearBuilt) {\n            const yearMatch3 = fullBodyText.match(/(?:completion|construction|available|delivery|handover)[^.]*?(20\\d{2})/i);\n            if (yearMatch3) {\n                yearBuilt = yearMatch3[1];\n            }\n        }\n\n        // === FUTURE YEAR VALIDATION ===\n        if (yearBuilt) {\n            const currentYear = new Date().getFullYear();\n            const propYear = parseInt(yearBuilt, 10);\n\n            if (propYear > currentYear) {\n                constructionStatus = 'Under Construction';\n            }\n        }\n    }\n\n    // === LOCATION FLAGS ===\n    const hasKuta = fullBodyText.toLowerCase().includes('kuta');\n    const hasSelong = fullBodyText.toLowerCase().includes('selong');\n    const hasAreGuling = fullBodyText.toLowerCase().includes('are guling');\n    const hasSenggigi = fullBodyText.toLowerCase().includes('senggigi');\n    const hasGili = fullBodyText.toLowerCase().includes('gili');\n    const hasFreehold = fullBodyText.toLowerCase().includes('freehold');\n    const hasLeasehold = fullBodyText.toLowerCase().includes('leasehold');\n\n    // === SOURCE DETECTION ===\n    let source = 'Unknown';\n    if (url.includes('bali-home-immo.com')) source = 'Bali Home Immo';\n    else if (url.includes('invest-lombok.com')) source = 'Invest Lombok';\n\n    log.info('EXTRACTED:', title, '| Price:', priceRaw, '| Construction:', constructionStatus, '| Year:', yearBuilt, '| Type:', propertyType, '| Source:', source);\n\n    return {\n        url: url,\n        title: title,\n        priceRaw: priceRaw,\n        ownership: ownership,\n        status: status,\n        constructionStatus: constructionStatus,\n        yearBuilt: yearBuilt,\n        propertyType: propertyType,\n        source: source,\n        hasKuta: hasKuta,\n        hasSelong: hasSelong,\n        hasAreGuling: hasAreGuling,\n        hasSenggigi: hasSenggigi,\n        hasGili: hasGili,\n        hasFreehold: hasFreehold,\n        hasLeasehold: hasLeasehold,\n        scrapedAt: new Date().toISOString()\n    };\n}","pageFunctionTimeoutSecs":90,"pageLoadTimeoutSecs":90,"respectRobotsTxtFile":false,"startUrls":[{"url":"https://www.bali-home-immo.com/realestate-property?keyword=Lombok"},{"url":"https://www.invest-lombok.com/property/"}],"useChrome":false,"waitUntil":["load"],"runMode":"PRODUCTION","pseudoUrls":[],"excludes":[],"proxyConfiguration":{"useApifyProxy":true},"proxyRotation":"RECOMMENDED","initialCookies":[],"breakpointLocation":"NONE","customData":{}}