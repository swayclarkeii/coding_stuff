{
  "breakpointLocation": "NONE",
  "browserLog": false,
  "closeCookieModals": true,
  "debugLog": true,
  "downloadCss": true,
  "downloadMedia": true,
  "globs": [
    "https://reefpropertylombok.com/**",
    "https://islandpropertylombok.com/**",
    "https://discoverlombokproperty.com/**",
    "https://www.nourestates.com/**",
    "https://baliexception.com/**",
    "https://www.estate-lombok.com/**",
    "https://www.majuproperties.com/**",
    "https://www.bali-home-immo.com/**",
    "https://www.invest-lombok.com/**"
  ],
  "headless": true,
  "ignoreCorsAndCsp": false,
  "ignoreSslErrors": false,
  "injectJQuery": true,
  "keepUrlFragments": false,
  "linkSelector": "a[href*=\"/property/\"], a[href*=\"/properties/\"], a[href*=\"/projects/\"], a[href*=\"/villas-for-sale\"], a[href*=\"/villa/\"], a.property-card, a.listing-item, a[href*=\"/realestate-property/for-sale/\"]",
  "maxConcurrency": 1,
  "maxCrawlingDepth": 2,
  "maxPagesPerCrawl": 200,
  "maxRequestRetries": 3,
  "maxResultsPerCrawl": 0,
  "pageFunction": "async function pageFunction(context) {\n    const { request, log } = context;\n    const url = request.url;\n\n    // ========================================\n    // REGION FILTERING - REJECT NON-LOMBOK\n    // ========================================\n    \n    // BALI EXCEPTION: Skip Bali regions, require /lombok/ in URL\n    if (url.includes('baliexception.com')) {\n        const baliRegions = ['/uluwatu/', '/legian/', '/canggu/', '/ubud/', \n                             '/seminyak/', '/karangasem/', '/tabanan/', '/bingin/', \n                             '/pererenan/', '/sanur/', '/denpasar/', '/jimbaran/',\n                             '/nusa-dua/', '/kerobokan/', '/berawa/', '/echo-beach/'];\n        for (const region of baliRegions) {\n            if (url.toLowerCase().includes(region)) {\n                log.info('SKIPPED (Bali region):', url);\n                return null;\n            }\n        }\n        if (!url.toLowerCase().includes('/lombok/') && !url.toLowerCase().includes('lombok')) {\n            log.info('SKIPPED (Not Lombok):', url);\n            return null;\n        }\n    }\n\n    // INVEST LOMBOK: Skip Sumbawa properties\n    if (url.includes('invest-lombok.com')) {\n        const bodyText = document.body.innerText.toLowerCase();\n        if (url.toLowerCase().includes('sumbawa') || \n            bodyText.includes('sumbawa') || \n            bodyText.includes('sekongkang')) {\n            log.info('SKIPPED (Sumbawa region):', url);\n            return null;\n        }\n    }\n\n    // BALI HOME IMMO: Ensure Lombok properties only\n    if (url.includes('bali-home-immo.com')) {\n        if (!url.toLowerCase().includes('lombok')) {\n            const bodyText = document.body.innerText.toLowerCase();\n            if (!bodyText.includes('lombok')) {\n                log.info('SKIPPED (Non-Lombok):', url);\n                return null;\n            }\n        }\n    }\n\n    // ========================================\n    // PROPERTY PAGE DETECTION\n    // ========================================\n    \n    const isPropertyPage = \n        // TASK 1 SITES\n        (url.includes('reefpropertylombok.com') && \n         (url.includes('/property/') || url.includes('/projects/')) &&\n         url !== 'https://reefpropertylombok.com/projects/') ||\n        (url.includes('islandpropertylombok.com') && url.includes('/property/')) ||\n        (url.includes('discoverlombokproperty.com') && url.includes('/listing/')) ||\n        (url.includes('nourestates.com') && url.includes('/property/')) ||\n        \n        // TASK 2 SITES (excluding South Lombok Land Sales)\n        (url.includes('baliexception.com') && \n         (url.includes('/properties/for-sale/') || url.includes('/property/')) &&\n         url.toLowerCase().includes('/lombok/')) ||\n        (url.includes('estate-lombok.com') && \n         (url.includes('/villas-for-sale-lombok/') || url.includes('/en/villa/'))) ||\n        (url.includes('majuproperties.com') && \n         (url.includes('/property/') || url.includes('/properties/')) &&\n         url !== 'https://www.majuproperties.com/properties' &&\n         !url.includes('?type=')) ||\n        \n        // TASK 3 SITES\n        (url.includes('bali-home-immo.com') && \n         url.includes('/realestate-property/for-sale/') && \n         url.split('/realestate-property/for-sale/')[1] && \n         url.split('/realestate-property/for-sale/')[1].split('/').length >= 3) ||\n        (url.includes('invest-lombok.com') && \n         url.includes('/property/') && \n         url !== 'https://www.invest-lombok.com/property/' &&\n         !url.endsWith('/property/'));\n\n    // Skip listing pages\n    const isListingPage = \n        url.includes('/city/') || \n        url.includes('/search-results/') || \n        url === 'https://reefpropertylombok.com/projects/' ||\n        url.includes('baliexception.com/area/lombok/jsf/') ||\n        url.match(/estate-lombok\\.com\\/en\\/villas-for-sale-lombok\\/?$/) ||\n        url.includes('majuproperties.com/properties?') ||\n        url.includes('bali-home-immo.com/realestate-property?') ||\n        url === 'https://www.bali-home-immo.com/realestate-property' ||\n        url === 'https://www.invest-lombok.com/property/' ||\n        url.includes('invest-lombok.com/property-type/');\n\n    if (!isPropertyPage || isListingPage) {\n        log.info('SKIPPED (listing/non-property):', url);\n        return null;\n    }\n\n    // ========================================\n    // DATA EXTRACTION\n    // ========================================\n    \n    const bodyText = document.body.innerText;\n    \n    // TITLE EXTRACTION - Multiple selectors for better coverage\n    let title = '';\n    const titleSelectors = [\n        'h1.property-title',\n        'h1.entry-title', \n        '.property-header h1',\n        'h1.title',\n        '.listing-title h1',\n        '.property-name',\n        'h1'\n    ];\n    for (const selector of titleSelectors) {\n        const elem = document.querySelector(selector);\n        if (elem && elem.innerText.trim()) {\n            title = elem.innerText.trim();\n            break;\n        }\n    }\n\n    // PROPERTY TYPE DETECTION - Land detection FIRST (critical fix)\n    let propertyType = 'Unknown';\n    \n    // Check for LAND first (before other types)\n    if (bodyText.match(/\\bland\\b/i) || \n        bodyText.match(/\\blot\\b/i) || \n        bodyText.match(/\\bplot\\b/i) ||\n        title.toLowerCase().includes('land') ||\n        bodyText.match(/\\bacre\\b/i) ||\n        bodyText.match(/\\bhectare\\b/i)) {\n        propertyType = 'Land';\n    } else if (bodyText.match(/\\bvilla\\b/i)) {\n        propertyType = 'Villa';\n    } else if (bodyText.match(/\\bapartment\\b/i)) {\n        propertyType = 'Apartment';\n    } else if (bodyText.match(/\\bhouse\\b/i)) {\n        propertyType = 'House';\n    } else if (bodyText.match(/\\bresort\\b/i)) {\n        propertyType = 'Resort';\n    } else if (bodyText.match(/\\bbungalow\\b/i)) {\n        propertyType = 'Bungalow';\n    }\n\n    // SKIP LAND PROPERTIES (user doesn't want them)\n    if (propertyType === 'Land') {\n        log.info('SKIPPED (Land property):', url, '- User only wants villas/apartments/houses');\n        return null;\n    }\n\n    // PRICE EXTRACTION - CSS selectors first, then regex fallback\n    let priceRaw = '';\n    \n    // Try CSS selectors first\n    const priceSelectors = [\n        '.property-price',\n        '.price',\n        'span.price',\n        'div.price',\n        '.listing-price',\n        '.property-meta-price',\n        '.property-info .price'\n    ];\n    for (const selector of priceSelectors) {\n        const elem = document.querySelector(selector);\n        if (elem && elem.innerText.trim()) {\n            priceRaw = elem.innerText.trim();\n            break;\n        }\n    }\n    \n    // Fallback to regex if CSS selectors fail\n    if (!priceRaw) {\n        const pricePatterns = [\n            /\\$[\\d,]+\\.?\\d*K?/gi,                                   // $285,000 or $285K\n            /USD\\s*[\\d,.]+/gi,                                       // USD 285000\n            /Rp\\.?\\s*[\\d.,]+\\s*(B|Billion|M|Million|Miliar|Juta)?/gi, // Rp 3.60 Billion\n            /IDR\\s*[\\d.,]+/gi,                                       // IDR 4948000000\n            /€\\s*[\\d,.]+/gi,                                         // €285,000\n            /EUR\\s*[\\d,.]+/gi,                                       // EUR 285000\n            /[\\d.,]+\\s*(IDR|Rupiah|Mio\\.|Billion)/gi                 // 1,1 Mio. USD\n        ];\n        for (const pattern of pricePatterns) {\n            const matches = bodyText.match(pattern);\n            if (matches && matches.length > 0) {\n                priceRaw = matches[0];\n                break;\n            }\n        }\n    }\n\n    // LOCATION EXTRACTION (optional field)\n    let location = '';\n    const locationMatch = bodyText.match(/Location[:\\s]+([^\\n]{5,50})/i);\n    if (locationMatch) {\n        location = locationMatch[1].trim();\n    }\n\n    // OWNERSHIP EXTRACTION\n    let ownership = '';\n    if (bodyText.match(/\\bHGB\\b/i)) {\n        ownership = 'HGB';\n    } else if (bodyText.match(/\\bFreehold\\b/i)) {\n        ownership = 'Freehold';\n    } else if (bodyText.match(/\\bLeasehold\\b/i)) {\n        ownership = 'Leasehold';\n    }\n\n    // STATUS EXTRACTION\n    let status = '';\n    if (bodyText.match(/\\bFor Sale\\b/i) || bodyText.match(/\\bSale\\b/i)) {\n        status = 'For Sale';\n    } else if (bodyText.match(/\\bSold\\b/i)) {\n        status = 'Sold';\n    } else if (bodyText.match(/\\bFor Rent\\b/i) || bodyText.match(/\\bLease\\b/i)) {\n        status = 'For Rent';\n    }\n\n    // UNIFIED LOCATION FLAGS\n    const bodyLower = bodyText.toLowerCase();\n    const hasKuta = bodyLower.includes('kuta');\n    const hasSelong = bodyLower.includes('selong');\n    const hasMandalika = bodyLower.includes('mandalika');\n    const hasAreGuling = bodyLower.includes('are guling') || bodyLower.includes('areguling');\n    const hasSenggigi = bodyLower.includes('senggigi');\n    const hasGili = bodyLower.includes('gili');\n    const hasFreehold = bodyLower.includes('freehold');\n    const hasLeasehold = bodyLower.includes('leasehold');\n\n    // SOURCE DETECTION (9 sources)\n    let source = 'Unknown';\n    if (url.includes('reefpropertylombok.com')) source = 'Reef Property Lombok';\n    else if (url.includes('islandpropertylombok.com')) source = 'Island Properties Lombok';\n    else if (url.includes('discoverlombokproperty.com')) source = 'Discover Lombok Property';\n    else if (url.includes('nourestates.com')) source = 'Nour Estates';\n    else if (url.includes('baliexception.com')) source = 'Bali Exception';\n    else if (url.includes('estate-lombok.com')) source = 'Estate Lombok';\n    else if (url.includes('majuproperties.com')) source = 'Maju Properties';\n    else if (url.includes('bali-home-immo.com')) source = 'Bali Home Immo';\n    else if (url.includes('invest-lombok.com')) source = 'Invest Lombok';\n\n    log.info('EXTRACTED:', title || '(no title)', '| Price:', priceRaw || '(no price)', '| Type:', propertyType, '| Source:', source);\n\n    return {\n        url: url,\n        title: title,\n        priceRaw: priceRaw,\n        location: location,\n        ownership: ownership,\n        status: status,\n        propertyType: propertyType,\n        source: source,\n        hasKuta: hasKuta,\n        hasSelong: hasSelong,\n        hasMandalika: hasMandalika,\n        hasAreGuling: hasAreGuling,\n        hasSenggigi: hasSenggigi,\n        hasGili: hasGili,\n        hasFreehold: hasFreehold,\n        hasLeasehold: hasLeasehold,\n        scrapedAt: new Date().toISOString()\n    };\n}",
  "pageLoadTimeoutSecs": 90,
  "pageFunctionTimeoutSecs": 90,
  "proxyConfiguration": {
    "useApifyProxy": true
  },
  "proxyRotation": "RECOMMENDED",
  "respectRobotsTxtFile": false,
  "startUrls": [
    {"url": "https://reefpropertylombok.com/projects/"},
    {"url": "https://islandpropertylombok.com/city/kuta/"},
    {"url": "https://discoverlombokproperty.com/search-results/?keyword=&location%5B%5D=kuta-mandalika"},
    {"url": "https://www.nourestates.com/property-for-sale-kuta-lombok"},
    {"url": "https://baliexception.com/area/lombok/jsf/jet-engine/tax/property_type:villa,apartment/meta/property-price!compare-less:300000/"},
    {"url": "https://www.estate-lombok.com/en/villas-for-sale-lombok"},
    {"url": "https://www.majuproperties.com/properties?type=villa&location=kuta"},
    {"url": "https://www.bali-home-immo.com/realestate-property?keyword=Lombok"},
    {"url": "https://www.invest-lombok.com/property/"}
  ],
  "useChrome": false,
  "waitUntil": ["networkidle2"],
  "runMode": "PRODUCTION",
  "pseudoUrls": [],
  "excludes": [],
  "initialCookies": [],
  "customData": {}
}
