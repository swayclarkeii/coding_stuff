{
  "id": "JNhSWvFLDNlzzsvm",
  "name": "Expense System - Workflow 8: G Drive Invoice Collector",
  "active": true,
  "createdAt": "2026-01-11T00:11:58.518Z",
  "updatedAt": "2026-01-11T22:51:24.075Z",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {"item": [{"mode": "everyMinute"}]},
        "triggerOn": "specificFolder",
        "folderToWatch": {"mode": "id", "value": "1_zVNS3JHS15pUjvfEJMh9nzYWn6TltbS"},
        "event": "fileCreated",
        "options": {}
      },
      "id": "trigger-gdrive",
      "name": "Google Drive Trigger",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [240, 304],
      "credentials": {"googleDriveOAuth2Api": {"id": "a4m50EefR3DJoU0R", "name": "Google Drive account"}}
    },
    {
      "parameters": {
        "conditions": {
          "options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"},
          "combinator": "and",
          "conditions": [
            {"id": "condition-1", "leftValue": "={{ $json.name }}", "rightValue": ".pdf", "operator": {"type": "string", "operation": "endsWith"}},
            {"id": "condition-2", "leftValue": "={{ $json.name }}", "rightValue": "SC - ", "operator": {"type": "string", "operation": "startsWith"}},
            {"id": "condition-3", "leftValue": "={{ $json.size }}", "rightValue": 10485760, "operator": {"type": "number", "operation": "lt"}}
          ]
        },
        "options": {}
      },
      "id": "filter-valid-files",
      "name": "Filter Valid Files",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [464, 304]
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "='1V7UmNvDP3a2t6IIbJJI7y8YXz6_X7F6l' in parents",
        "filter": {},
        "options": {}
      },
      "id": "list-pool-files",
      "name": "List Invoice Pool Files",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [688, 304],
      "credentials": {"googleDriveOAuth2Api": {"id": "a4m50EefR3DJoU0R", "name": "Google Drive account"}}
    },
    {
      "parameters": {
        "jsCode": "// Get the new invoice filename from trigger\nconst newFile = $('Google Drive Trigger').first().json;\nconst newFileName = newFile.name;\n\n// Get list of existing files in Invoice Pool\nconst poolFiles = $('List Invoice Pool Files').all();\n\n// Check if file already exists in pool\nconst isDuplicate = poolFiles.some(item => item.json.name === newFileName);\n\nif (isDuplicate) {\n  // Skip processing - file already in pool\n  return [];\n}\n\n// Not a duplicate - continue processing\nreturn [{\n  json: {\n    ...newFile,\n    isDuplicate: false,\n    processedAt: new Date().toISOString()\n  }\n}];"
      },
      "id": "check-duplicates",
      "name": "Check for Duplicates",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [912, 304]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {"mode": "id", "value": "={{ $json.id }}"},
        "options": {}
      },
      "id": "download-invoice",
      "name": "Download Invoice",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [1120, 304],
      "credentials": {"googleDriveOAuth2Api": {"id": "a4m50EefR3DJoU0R", "name": "Google Drive account"}}
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {"parameters": [{"name": "anthropic-version", "value": "2023-06-01"}]},
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.requestBody }}",
        "options": {"timeout": 60000}
      },
      "id": "call-anthropic-api",
      "name": "Call Anthropic API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [1568, 304],
      "credentials": {"anthropicApi": {"id": "MRSNO4UW3OEIA3tQ", "name": "Anthropic account"}},
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {"mode": "id", "value": "={{ $json.FileID }}"},
        "options": {}
      },
      "id": "copy-to-pool",
      "name": "Copy Invoice to Pool",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [2000, 304],
      "credentials": {"googleDriveOAuth2Api": {"id": "a4m50EefR3DJoU0R", "name": "Google Drive account"}}
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {"mode": "id", "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"},
        "sheetName": {"__rl": true, "value": 1542914058, "mode": "list", "cachedResultName": "Invoices"},
        "columns": {"mappingMode": "autoMapInputData", "value": {}},
        "options": {}
      },
      "id": "log-to-sheet",
      "name": "Log to Invoices Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [2224, 304],
      "credentials": {"googleSheetsOAuth2Api": {"id": "H7ewI1sOrDYabelt", "name": "Google Sheets account"}}
    }
  ],
  "connections": {
    "Google Drive Trigger": {"main": [[{"node": "Filter Valid Files", "type": "main", "index": 0}]]},
    "Filter Valid Files": {"main": [[{"node": "List Invoice Pool Files", "type": "main", "index": 0}]]},
    "List Invoice Pool Files": {"main": [[{"node": "Check for Duplicates", "type": "main", "index": 0}]]},
    "Check for Duplicates": {"main": [[{"node": "Download Invoice", "type": "main", "index": 0}]]},
    "Download Invoice": {"main": [[{"node": "Build Anthropic Request", "type": "main", "index": 0}]]},
    "Build Anthropic Request": {"main": [[{"node": "Call Anthropic API", "type": "main", "index": 0}]]},
    "Call Anthropic API": {"main": [[{"node": "Parse Anthropic Response", "type": "main", "index": 0}]]},
    "Parse Anthropic Response": {"main": [[{"node": "Copy Invoice to Pool", "type": "main", "index": 0}]]},
    "Copy Invoice to Pool": {"main": [[{"node": "Log to Invoices Sheet", "type": "main", "index": 0}]]}
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true
  },
  "backupInfo": {
    "backupDate": "2026-01-20",
    "backupVersion": "v2.2.0",
    "nodeCount": 14,
    "note": "G Drive Invoice Collector - monitors production folder for new SC - invoices"
  }
}
