{
  "updatedAt": "2026-01-30T10:01:00.973Z",
  "createdAt": "2026-01-28T12:20:13.089Z",
  "id": "zFdAi3H5LFFbqusX",
  "name": "Expense System - W6 v2: Expensify Table Extractor (SIMPLE)",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "expensify-processor",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "webhookId": "90e50d17-7e01-43a7-8876-e11fb7e7ab4e",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.body ? $json.body.fileId : $json.fileId }}"
        },
        "options": {}
      },
      "id": "read-pdf-file",
      "name": "Download PDF from Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        224,
        0
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "a4m50EefR3DJoU0R",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "method": "POST",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  model: 'claude-sonnet-4-5',\n  max_tokens: 16000,\n  messages: [{\n    role: 'user',\n    content: [\n      {\n        type: 'text',\n        text: 'Extract the expense table from page 1 of this Expensify report. Return ONLY a JSON array with this exact structure: [{\"date\": \"YYYY-MM-DD\", \"merchant\": \"Company Name\", \"amount\": 25.50, \"currency\": \"EUR\"}]. Do not include any markdown formatting or explanatory text.'\n      },\n      {\n        type: 'document',\n        source: {\n          type: 'base64',\n          media_type: 'application/pdf',\n          data: $json.pdfBase64\n        }\n      }\n    ]\n  }]\n}) }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "call-claude-api",
      "name": "Extract Table with Claude API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        672,
        0
      ],
      "credentials": {
        "anthropicApi": {
          "id": "MRSNO4UW3OEIA3tQ",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\n\n// Get report month - try webhook first, then execute workflow trigger\nlet reportMonth = 'UNKNOWN';\nlet fileId = '';\nlet fileName = '';\ntry {\n  const webhookData = $('Webhook Trigger').first().json.body || $('Webhook Trigger').first().json || {};\n  reportMonth = webhookData.report_month || reportMonth;\n  fileId = webhookData.fileId || '';\n  fileName = webhookData.fileName || '';\n} catch (e) { /* Webhook not used */ }\n\nif (reportMonth === 'UNKNOWN') {\n  try {\n    const executeData = $('Execute Workflow Trigger').first().json || {};\n    reportMonth = executeData.report_month || reportMonth;\n    fileId = fileId || executeData.fileId || '';\n    fileName = fileName || executeData.fileName || '';\n  } catch (e) { /* Execute Workflow Trigger not used */ }\n}\n\n// Get original file name from Download node if not passed in\nif (!fileName) {\n  try {\n    const downloadData = $('Download PDF from Drive').first();\n    fileName = downloadData.binary?.data?.fileName || '';\n  } catch (e) { /* no binary data */ }\n}\n\n// Extract text from Claude's response\nconst textContent = response.content[0].text;\n\n// Try to parse the text content as JSON\nlet transactions;\ntry {\n  transactions = JSON.parse(textContent);\n} catch (error) {\n  const jsonMatch = textContent.match(/\\[\\s*\\{[\\s\\S]*\\}\\s*\\]/);\n  if (jsonMatch) {\n    transactions = JSON.parse(jsonMatch[0]);\n  } else {\n    throw new Error(`Failed to parse JSON from Claude response. Text content: ${textContent}`);\n  }\n}\n\nif (!Array.isArray(transactions)) {\n  throw new Error('Claude response is not an array');\n}\n\n// Format date to DD.MM.YYYY for consistency with W7\nfunction formatDate(dateStr) {\n  if (!dateStr) return '';\n  // Try parsing YYYY-MM-DD\n  const match = dateStr.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if (match) {\n    return `${match[3]}.${match[2]}.${match[1]}`;\n  }\n  return dateStr;\n}\n\n// Current timestamp for ProcessedDate\nconst now = new Date();\nconst processedDate = now.toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true });\n\n// File path from fileId\nconst filePath = fileId ? `https://drive.google.com/file/d/${fileId}/view?usp=drivesdk` : '';\n\nconst results = transactions.map((transaction, index) => {\n  const receiptId = `EXP_${reportMonth}_${String(index + 1).padStart(2, '0')}`;\n  \n  return {\n    json: {\n      ReceiptID: receiptId,\n      FileName: fileName,\n      Vendor: transaction.merchant || '',\n      Amount: parseFloat(transaction.amount) || 0,\n      Date: formatDate(transaction.date),\n      Currency: transaction.currency || 'EUR',\n      FileID: fileId,\n      FilePath: filePath,\n      ProcessedDate: processedDate,\n      Source: 'Expensify',\n      Direction: 'EXPENSE',\n      Notes: `From ${reportMonth} Expensify report`\n    }\n  };\n});\n\nreturn results;"
      },
      "id": "parse-response",
      "name": "Parse Claude Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        0
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "Receipts"
        },
        "columns": {
          "mappingMode": "autoMapInputData"
        }
      },
      "id": "log-to-sheets",
      "name": "Log Receipts to Database",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1104,
        0
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "H7ewI1sOrDYabelt",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "webhook-response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1328,
        0
      ]
    },
    {
      "id": "extract-to-base64",
      "name": "Convert PDF to Base64",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        448,
        100
      ],
      "parameters": {
        "operation": "binaryToPropery",
        "binaryPropertyName": "data",
        "destinationKey": "pdfBase64",
        "options": {
          "keepSource": true
        }
      }
    },
    {
      "id": "read-existing-receipts",
      "name": "Read Existing Receipt IDs",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1000,
        120
      ],
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "Receipts"
        },
        "range": "A:A",
        "options": {}
      },
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "H7ewI1sOrDYabelt",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "id": "remove-duplicates",
      "name": "Remove Duplicates",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1000,
        0
      ],
      "parameters": {
        "jsCode": "// Get existing receipt IDs from the input (Read Existing Receipt IDs node)\nconst existingRows = $input.all();\nconst existingReceiptIds = new Set(\n  existingRows\n    .map(row => row.json.ReceiptID)\n    .filter(id => id && id !== '' && id !== 'ReceiptID')  // Filter out empty and header row\n);\n\n// Get parsed receipts from Parse Claude Response node\nconst parsedReceipts = $('Parse Claude Response').all();\n\n// Filter out receipts that already exist\nconst newReceipts = parsedReceipts.filter(receipt => {\n  const receiptId = receipt.json.ReceiptID;\n  return !existingReceiptIds.has(receiptId);\n});\n\n// Log results\nif (newReceipts.length === 0) {\n  console.log(`All ${parsedReceipts.length} receipts are duplicates. No new receipts to add.`);\n} else {\n  console.log(`Found ${newReceipts.length} new receipts out of ${parsedReceipts.length} total`);\n}\n\nreturn newReceipts;"
      }
    },
    {
      "id": "execute-workflow-trigger",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        0,
        120
      ],
      "parameters": {}
    },
    {
      "id": "upload-to-receipt-pool",
      "name": "Upload to Receipt Pool",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1328,
        120
      ],
      "parameters": {
        "operation": "upload",
        "name": {
          "__rl": true,
          "mode": "expression",
          "value": "={{ $json.ReceiptID }}_{{ $('Download PDF from Drive').first().json.name }}"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "cachedResultName": "Receipt Pool Hard Drive",
          "value": "1NP5y-HvPfAv28wz2It6BtNZXD7Xfe5D4"
        },
        "options": {
          "binaryPropertyName": "data"
        }
      },
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "a4m50EefR3DJoU0R",
          "name": "Google Drive account"
        }
      },
      "onError": "continueRegularOutput"
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Download PDF from Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download PDF from Drive": {
      "main": [
        [
          {
            "node": "Convert PDF to Base64",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Table with Claude API": {
      "main": [
        [
          {
            "node": "Parse Claude Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Claude Response": {
      "main": [
        [
          {
            "node": "Read Existing Receipt IDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Receipts to Database": {
      "main": [
        [
          {
            "node": "Upload to Receipt Pool",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert PDF to Base64": {
      "main": [
        [
          {
            "node": "Extract Table with Claude API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "Log Receipts to Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Existing Receipt IDs": {
      "main": [
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Download PDF from Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Receipt Pool": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": true,
    "timeSavedMode": "fixed"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "8d6b66d5-4539-442d-8664-9161be646545",
  "activeVersionId": "8d6b66d5-4539-442d-8664-9161be646545",
  "versionCounter": 154,
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2026-01-28T12:20:13.089Z",
      "createdAt": "2026-01-28T12:20:13.089Z",
      "role": "workflow:owner",
      "workflowId": "zFdAi3H5LFFbqusX",
      "projectId": "Rs8mhw052fnrzWZM",
      "project": {
        "updatedAt": "2025-12-31T15:54:29.115Z",
        "createdAt": "2025-12-31T15:27:33.865Z",
        "id": "Rs8mhw052fnrzWZM",
        "name": "Sway Clarke <sway@oloxa.ai>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
        "projectRelations": [
          {
            "updatedAt": "2025-12-31T15:27:33.865Z",
            "createdAt": "2025-12-31T15:27:33.865Z",
            "userId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
            "projectId": "Rs8mhw052fnrzWZM",
            "user": {
              "updatedAt": "2026-01-31T00:12:46.682Z",
              "createdAt": "2025-12-31T15:27:33.119Z",
              "id": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
              "email": "sway@oloxa.ai",
              "firstName": "Sway",
              "lastName": "Clarke",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-12-31T15:54:37.562Z",
                "personalization_survey_n8n_version": "2.1.4"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "zbxHkXOoD1qaz6OS",
                "userActivatedAt": 1767398053308,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1767684846804
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-01-30",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2026-01-30T10:01:00.983Z",
    "createdAt": "2026-01-30T10:01:00.983Z",
    "versionId": "8d6b66d5-4539-442d-8664-9161be646545",
    "workflowId": "zFdAi3H5LFFbqusX",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "expensify-processor",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Webhook Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          0,
          0
        ],
        "webhookId": "90e50d17-7e01-43a7-8876-e11fb7e7ab4e",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.body ? $json.body.fileId : $json.fileId }}"
          },
          "options": {}
        },
        "id": "read-pdf-file",
        "name": "Download PDF from Drive",
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          224,
          0
        ],
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "a4m50EefR3DJoU0R",
            "name": "Google Drive account"
          }
        }
      },
      {
        "parameters": {
          "url": "https://api.anthropic.com/v1/messages",
          "method": "POST",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "anthropicApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "anthropic-version",
                "value": "2023-06-01"
              }
            ]
          },
          "sendBody": true,
          "contentType": "json",
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({\n  model: 'claude-sonnet-4-5',\n  max_tokens: 16000,\n  messages: [{\n    role: 'user',\n    content: [\n      {\n        type: 'text',\n        text: 'Extract the expense table from page 1 of this Expensify report. Return ONLY a JSON array with this exact structure: [{\"date\": \"YYYY-MM-DD\", \"merchant\": \"Company Name\", \"amount\": 25.50, \"currency\": \"EUR\"}]. Do not include any markdown formatting or explanatory text.'\n      },\n      {\n        type: 'document',\n        source: {\n          type: 'base64',\n          media_type: 'application/pdf',\n          data: $json.pdfBase64\n        }\n      }\n    ]\n  }]\n}) }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "id": "call-claude-api",
        "name": "Extract Table with Claude API",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          672,
          0
        ],
        "credentials": {
          "anthropicApi": {
            "id": "MRSNO4UW3OEIA3tQ",
            "name": "Anthropic account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const response = $input.first().json;\n\n// Get report month - try webhook first, then execute workflow trigger\nlet reportMonth = 'UNKNOWN';\nlet fileId = '';\nlet fileName = '';\ntry {\n  const webhookData = $('Webhook Trigger').first().json.body || $('Webhook Trigger').first().json || {};\n  reportMonth = webhookData.report_month || reportMonth;\n  fileId = webhookData.fileId || '';\n  fileName = webhookData.fileName || '';\n} catch (e) { /* Webhook not used */ }\n\nif (reportMonth === 'UNKNOWN') {\n  try {\n    const executeData = $('Execute Workflow Trigger').first().json || {};\n    reportMonth = executeData.report_month || reportMonth;\n    fileId = fileId || executeData.fileId || '';\n    fileName = fileName || executeData.fileName || '';\n  } catch (e) { /* Execute Workflow Trigger not used */ }\n}\n\n// Get original file name from Download node if not passed in\nif (!fileName) {\n  try {\n    const downloadData = $('Download PDF from Drive').first();\n    fileName = downloadData.binary?.data?.fileName || '';\n  } catch (e) { /* no binary data */ }\n}\n\n// Extract text from Claude's response\nconst textContent = response.content[0].text;\n\n// Try to parse the text content as JSON\nlet transactions;\ntry {\n  transactions = JSON.parse(textContent);\n} catch (error) {\n  const jsonMatch = textContent.match(/\\[\\s*\\{[\\s\\S]*\\}\\s*\\]/);\n  if (jsonMatch) {\n    transactions = JSON.parse(jsonMatch[0]);\n  } else {\n    throw new Error(`Failed to parse JSON from Claude response. Text content: ${textContent}`);\n  }\n}\n\nif (!Array.isArray(transactions)) {\n  throw new Error('Claude response is not an array');\n}\n\n// Format date to DD.MM.YYYY for consistency with W7\nfunction formatDate(dateStr) {\n  if (!dateStr) return '';\n  // Try parsing YYYY-MM-DD\n  const match = dateStr.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if (match) {\n    return `${match[3]}.${match[2]}.${match[1]}`;\n  }\n  return dateStr;\n}\n\n// Current timestamp for ProcessedDate\nconst now = new Date();\nconst processedDate = now.toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true });\n\n// File path from fileId\nconst filePath = fileId ? `https://drive.google.com/file/d/${fileId}/view?usp=drivesdk` : '';\n\nconst results = transactions.map((transaction, index) => {\n  const receiptId = `EXP_${reportMonth}_${String(index + 1).padStart(2, '0')}`;\n  \n  return {\n    json: {\n      ReceiptID: receiptId,\n      FileName: fileName,\n      Vendor: transaction.merchant || '',\n      Amount: parseFloat(transaction.amount) || 0,\n      Date: formatDate(transaction.date),\n      Currency: transaction.currency || 'EUR',\n      FileID: fileId,\n      FilePath: filePath,\n      ProcessedDate: processedDate,\n      Source: 'Expensify',\n      Direction: 'EXPENSE',\n      Notes: `From ${reportMonth} Expensify report`\n    }\n  };\n});\n\nreturn results;"
        },
        "id": "parse-response",
        "name": "Parse Claude Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          880,
          0
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "Receipts"
          },
          "columns": {
            "mappingMode": "autoMapInputData"
          }
        },
        "id": "log-to-sheets",
        "name": "Log Receipts to Database",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1104,
          0
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "H7ewI1sOrDYabelt",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "webhook-response",
        "name": "Webhook Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1328,
          0
        ]
      },
      {
        "id": "extract-to-base64",
        "name": "Convert PDF to Base64",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1.1,
        "position": [
          448,
          100
        ],
        "parameters": {
          "operation": "binaryToPropery",
          "binaryPropertyName": "data",
          "destinationKey": "pdfBase64",
          "options": {
            "keepSource": true
          }
        }
      },
      {
        "id": "read-existing-receipts",
        "name": "Read Existing Receipt IDs",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1000,
          120
        ],
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "Receipts"
          },
          "range": "A:A",
          "options": {}
        },
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "H7ewI1sOrDYabelt",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "id": "remove-duplicates",
        "name": "Remove Duplicates",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          0
        ],
        "parameters": {
          "jsCode": "// Get existing receipt IDs from the input (Read Existing Receipt IDs node)\nconst existingRows = $input.all();\nconst existingReceiptIds = new Set(\n  existingRows\n    .map(row => row.json.ReceiptID)\n    .filter(id => id && id !== '' && id !== 'ReceiptID')  // Filter out empty and header row\n);\n\n// Get parsed receipts from Parse Claude Response node\nconst parsedReceipts = $('Parse Claude Response').all();\n\n// Filter out receipts that already exist\nconst newReceipts = parsedReceipts.filter(receipt => {\n  const receiptId = receipt.json.ReceiptID;\n  return !existingReceiptIds.has(receiptId);\n});\n\n// Log results\nif (newReceipts.length === 0) {\n  console.log(`All ${parsedReceipts.length} receipts are duplicates. No new receipts to add.`);\n} else {\n  console.log(`Found ${newReceipts.length} new receipts out of ${parsedReceipts.length} total`);\n}\n\nreturn newReceipts;"
        }
      },
      {
        "id": "execute-workflow-trigger",
        "name": "Execute Workflow Trigger",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1,
        "position": [
          0,
          120
        ],
        "parameters": {}
      },
      {
        "id": "upload-to-receipt-pool",
        "name": "Upload to Receipt Pool",
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          1328,
          120
        ],
        "parameters": {
          "operation": "upload",
          "name": {
            "__rl": true,
            "mode": "expression",
            "value": "={{ $json.ReceiptID }}_{{ $('Download PDF from Drive').first().json.name }}"
          },
          "folderId": {
            "__rl": true,
            "mode": "list",
            "cachedResultName": "Receipt Pool Hard Drive",
            "value": "1NP5y-HvPfAv28wz2It6BtNZXD7Xfe5D4"
          },
          "options": {
            "binaryPropertyName": "data"
          }
        },
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "a4m50EefR3DJoU0R",
            "name": "Google Drive account"
          }
        },
        "onError": "continueRegularOutput"
      }
    ],
    "connections": {
      "Webhook Trigger": {
        "main": [
          [
            {
              "node": "Download PDF from Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download PDF from Drive": {
        "main": [
          [
            {
              "node": "Convert PDF to Base64",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Table with Claude API": {
        "main": [
          [
            {
              "node": "Parse Claude Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Claude Response": {
        "main": [
          [
            {
              "node": "Read Existing Receipt IDs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Receipts to Database": {
        "main": [
          [
            {
              "node": "Upload to Receipt Pool",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert PDF to Base64": {
        "main": [
          [
            {
              "node": "Extract Table with Claude API",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Remove Duplicates": {
        "main": [
          [
            {
              "node": "Log Receipts to Database",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Existing Receipt IDs": {
        "main": [
          [
            {
              "node": "Remove Duplicates",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Workflow Trigger": {
        "main": [
          [
            {
              "node": "Download PDF from Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload to Receipt Pool": {
        "main": [
          [
            {
              "node": "Webhook Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Sway Clarke",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-01-30T10:01:01.532Z",
        "id": 2058,
        "workflowId": "zFdAi3H5LFFbqusX",
        "versionId": "8d6b66d5-4539-442d-8664-9161be646545",
        "event": "activated",
        "userId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8"
      }
    ]
  }
}