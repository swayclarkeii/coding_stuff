{
  "updatedAt": "2026-01-29T22:55:03.486Z",
  "createdAt": "2026-01-29T09:59:22.044Z",
  "id": "ewZOYMYOqSfgtjFm",
  "name": "W0 - Master Orchestrator (Phase 0)",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "w0-expense-orchestrator-start",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        240,
        448
      ],
      "webhookId": "6ab02e2b-808d-481c-b0c8-bcdf73071278"
    },
    {
      "parameters": {
        "jsCode": "const month = $json.body?.month || '';\nconst quarter = $json.body?.quarter || '';\nconst processDate = new Date().toISOString();\n\nif (!month && !quarter) {\n  throw new Error('Must provide either month or quarter parameter in body');\n}\n\nreturn [{\n  json: {\n    processing_period: month || quarter,\n    process_date: processDate,\n    status: 'STARTED'\n  }\n}];"
      },
      "id": "extract-params",
      "name": "Extract Input Parameters",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        448
      ]
    },
    {
      "parameters": {
        "workflowId": "MPjDdVMI88158iFW",
        "options": {}
      },
      "id": "execute-w1",
      "name": "Execute W1 (Bank Statements)",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        688,
        208
      ],
      "disabled": true
    },
    {
      "parameters": {
        "workflowId": "dHbwemg7hEB4vDmC",
        "options": {}
      },
      "id": "execute-w2",
      "name": "Execute W2 (Gmail Receipts)",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        912,
        208
      ],
      "disabled": true
    },
    {
      "parameters": {
        "workflowId": "zFdAi3H5LFFbqusX",
        "options": {}
      },
      "id": "execute-w6",
      "name": "Execute W6 (Expensify)",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1136,
        208
      ],
      "disabled": true
    },
    {
      "parameters": {
        "workflowId": "CJtdqMreZ17esJAW",
        "options": {}
      },
      "id": "execute-w3",
      "name": "Execute W3 (Matching)",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1360,
        208
      ],
      "disabled": true
    },
    {
      "parameters": {
        "documentId": {
          "mode": "id",
          "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
        },
        "sheetName": {
          "mode": "name",
          "value": "Transactions"
        },
        "options": {}
      },
      "id": "read-transactions",
      "name": "Read Transactions Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        688,
        544
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "H7ewI1sOrDYabelt",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueRegularOutput",
      "executeOnce": false,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "const transactions = $input.all();\n\n// Handle empty transactions case\nif (!transactions || transactions.length === 0) {\n  return [{\n    json: {\n      _empty: true,\n      _message: 'No transactions found for this period',\n      total_transactions: 0,\n      missing_count: 0\n    }\n  }];\n}\n\nconst excludedVendors = ['Deka', 'Edeka', 'DM', 'Kumpel und Keule', 'Bettoni'];\nconst minAmount = 10;\n\nconst missingDocuments = transactions.filter(item => {\n  const amount = parseFloat(item.json.Amount) || 0;\n  const vendor = item.json.Vendor || '';\n  const matchStatus = (item.json.MatchStatus || '').toLowerCase();\n\n  if (Math.abs(amount) < minAmount) return false;\n  if (excludedVendors.includes(vendor)) return false;\n  if (matchStatus === 'matched') return false;\n\n  return true;\n});\n\nif (missingDocuments.length === 0) {\n  return [{\n    json: {\n      _empty: true,\n      _message: 'All transactions matched or below threshold',\n      total_transactions: transactions.length,\n      missing_count: 0\n    }\n  }];\n}\n\nreturn missingDocuments.map(item => {\n  const amount = parseFloat(item.json.Amount) || 0;\n  const docType = amount < 0 ? 'receipt' : 'invoice';\n  \n  return {\n    json: {\n      transaction_date: item.json.Date,\n      vendor: item.json.Vendor,\n      amount_eur: item.json.Amount,\n      category: item.json.Category,\n      description: item.json.Description,\n      transaction_id: item.json.TransactionID,\n      document_type: docType\n    }\n  };\n});"
      },
      "id": "filter-missing",
      "name": "Filter Missing Documents",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        544
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "has-items",
              "leftValue": "={{ $input.first().json._empty ? 0 : $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "check-missing",
      "name": "Check if Missing Receipts",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1136,
        544
      ]
    },
    {
      "parameters": {
        "jsCode": "const missingItems = $input.all();\n\n// Separate by document type\nconst missingReceipts = missingItems.filter(item => item.json.document_type === 'receipt');\nconst missingInvoices = missingItems.filter(item => item.json.document_type === 'invoice');\n\n// Calculate totals\nconst receiptsTotal = missingReceipts.reduce((sum, item) => {\n  return sum + Math.abs(parseFloat(item.json.amount_eur || 0));\n}, 0);\n\nconst invoicesTotal = missingInvoices.reduce((sum, item) => {\n  return sum + parseFloat(item.json.amount_eur || 0);\n}, 0);\n\nconst grandTotal = receiptsTotal + invoicesTotal;\n\nconst processingPeriod = $('Extract Input Parameters').first().json.processing_period;\nconst spreadsheetId = '1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM';\n\nreturn [{\n  json: {\n    has_missing: true,\n    missing_receipts: {\n      count: missingReceipts.length,\n      total: receiptsTotal.toFixed(2)\n    },\n    missing_invoices: {\n      count: missingInvoices.length,\n      total: invoicesTotal.toFixed(2)\n    },\n    grand_total: grandTotal.toFixed(2),\n    total_count: missingItems.length,\n    processing_period: processingPeriod,\n    sheet_url: `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit`,\n    missing_documents: missingItems.map(item => item.json)\n  }\n}];"
      },
      "id": "calc-missing-summary",
      "name": "Calculate Missing Summary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1360,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\n\n// Separate documents by type\nconst receipts = data.missing_documents.filter(d => d.document_type === 'receipt');\nconst invoices = data.missing_documents.filter(d => d.document_type === 'invoice');\n\nconsole.log('\\n========================================');\nconsole.log('\ud83d\udccb MISSING DOCUMENTS DETECTED');\nconsole.log('========================================');\nconsole.log(`Month/Quarter: ${data.processing_period}`);\nconsole.log('');\nconsole.log(`Missing Receipts (Expenses): ${data.missing_receipts.count} transactions, \u20ac${data.missing_receipts.total}`);\nconsole.log(`Missing Invoices (Income): ${data.missing_invoices.count} transactions, \u20ac${data.missing_invoices.total}`);\nconsole.log('');\nconsole.log(`GRAND TOTAL: ${data.total_count} transactions, \u20ac${data.grand_total}`);\nconsole.log(`\\n\ud83d\udcca View spreadsheet: ${data.sheet_url}`);\nconsole.log('========================================');\n\n// Helper function to format transaction for display\nfunction formatTransaction(doc, index) {\n  const amount = Math.abs(parseFloat(doc.amount_eur)).toFixed(2);\n  const date = doc.transaction_date || 'N/A';\n  const vendor = doc.vendor || 'Unknown';\n  const desc = doc.description || '';\n  \n  // Truncate description if too long\n  const displayDesc = desc.length > 50 ? desc.substring(0, 47) + '...' : desc;\n  \n  return `${(index + 1).toString().padStart(2, ' ')}. ${date} | \u20ac${amount.padStart(10, ' ')} | ${vendor} | ${displayDesc}`;\n}\n\n// Display Missing Receipts (Expenses)\nif (receipts.length > 0) {\n  console.log('\\n\ud83d\udcc4 MISSING RECEIPTS (Expenses):');\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  receipts.forEach((doc, idx) => {\n    console.log(formatTransaction(doc, idx));\n  });\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  console.log(`Subtotal: ${receipts.length} transactions, \u20ac${data.missing_receipts.total}`);\n}\n\n// Display Missing Invoices (Income)\nif (invoices.length > 0) {\n  console.log('\\n\ud83d\udcc4 MISSING INVOICES (Income):');\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  invoices.forEach((doc, idx) => {\n    console.log(formatTransaction(doc, idx));\n  });\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  console.log(`Subtotal: ${invoices.length} transactions, \u20ac${data.missing_invoices.total}`);\n}\n\n// Next steps\nconsole.log('\\n\ud83d\udcc1 NEXT STEPS:');\nconsole.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\nif (receipts.length > 0) {\n  console.log('1. Find and upload missing RECEIPTS (for expenses) to Receipt Pool folder');\n}\nif (invoices.length > 0) {\n  console.log('2. Find and upload missing INVOICES (for income) to Invoice Pool folder');\n}\nconsole.log('3. Re-run W3 (Matching) workflow to match documents');\nconsole.log('4. Re-run W0 to verify all documents matched');\nconsole.log('========================================\\n');\n\nreturn [{ json: data }];}"
      },
      "id": "log-missing",
      "name": "Log Missing Receipts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1808,
        352
      ]
    },
    {
      "parameters": {
        "jsCode": "const allTransactions = $('Read Transactions Sheet').all();\nconst totalCount = allTransactions.length;\nconst totalAmount = allTransactions.reduce((sum, item) => {\n  return sum + parseFloat(item.json.Amount || 0);\n}, 0);\n\nconst processingPeriod = $('Extract Input Parameters').first().json.processing_period;\n\nreturn [{\n  json: {\n    has_missing: false,\n    total_count: totalCount,\n    total_amount_eur: totalAmount.toFixed(2),\n    processing_period: processingPeriod,\n    status: 'COMPLETE',\n    next_steps: 'Ready for W4 (Folder Builder) and accountant handoff'\n  }\n}];"
      },
      "id": "calc-success-summary",
      "name": "Calculate Success Summary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1360,
        688
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\n\nconsole.log('\\n========================================');\nconsole.log('\u2705 ALL RECEIPTS MATCHED');\nconsole.log('========================================');\nconsole.log(`Month/Quarter: ${data.processing_period}`);\nconsole.log(`Total transactions: ${data.total_count}`);\nconsole.log(`Total amount: \u20ac${data.total_amount_eur}`);\nconsole.log(`\\nStatus: ${data.status}`);\nconsole.log('\\n\ud83d\udcc1 Next steps:');\nconsole.log('   1. Run W4 (Folder Builder) to organize files');\nconsole.log('   2. Send organized folder to accountant');\nconsole.log('   3. Mark period as complete');\nconsole.log('========================================\\n');\n\nreturn [{ json: data }];"
      },
      "id": "log-success",
      "name": "Log Success",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1808,
        736
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "name",
          "value": "expense-reports"
        },
        "text": "={{ $json.slack_message }}",
        "otherOptions": {}
      },
      "id": "slack-missing-notification",
      "name": "Send Slack Notification (Missing)",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        2032,
        352
      ],
      "webhookId": "ccd6fa6d-f414-4859-8ed8-f042cb5f7f6d",
      "credentials": {
        "slackApi": {
          "id": "iN2b9bGFpoyptSPr",
          "name": "slack-workflow-notifications"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\n\n// Separate documents by type\nconst receipts = data.missing_documents.filter(d => d.document_type === 'receipt');\nconst invoices = data.missing_documents.filter(d => d.document_type === 'invoice');\n\n// Helper function to format transaction for Slack\nfunction formatTransaction(doc, index) {\n  const amount = Math.abs(parseFloat(doc.amount_eur)).toFixed(2);\n  const date = doc.transaction_date || 'N/A';\n  const vendor = doc.vendor || 'Unknown';\n  return `${index + 1}. ${date} | \u20ac${amount} | ${vendor}`;\n}\n\n// Build message sections\nlet message = `\ud83d\udd14 *Expense Report for ${data.processing_period}*\\n\\n`;\n\n// Summary\nmessage += `\ud83d\udcca *Summary*\\n`;\nmessage += `Missing Receipts (Expenses): ${data.missing_receipts.count} transactions, \u20ac${data.missing_receipts.total}\\n`;\nmessage += `Missing Invoices (Income): ${data.missing_invoices.count} transactions, \u20ac${data.missing_invoices.total}\\n`;\nmessage += `*TOTAL: ${data.total_count} documents needed, \u20ac${data.grand_total}*\\n\\n`;\n\n// Missing Receipts section\nif (receipts.length > 0) {\n  message += `\ud83d\udcc4 *MISSING RECEIPTS (${receipts.length} expenses, \u20ac${data.missing_receipts.total}):*\\n`;\n  message += '```\\n';\n  receipts.slice(0, 20).forEach((doc, idx) => {\n    message += formatTransaction(doc, idx) + '\\n';\n  });\n  if (receipts.length > 20) {\n    message += `... and ${receipts.length - 20} more\\n`;\n  }\n  message += '```\\n\\n';\n}\n\n// Missing Invoices section\nif (invoices.length > 0) {\n  message += `\ud83d\udcc4 *MISSING INVOICES (${invoices.length} income, \u20ac${data.missing_invoices.total}):*\\n`;\n  message += '```\\n';\n  invoices.slice(0, 20).forEach((doc, idx) => {\n    message += formatTransaction(doc, idx) + '\\n';\n  });\n  if (invoices.length > 20) {\n    message += `... and ${invoices.length - 20} more\\n`;\n  }\n  message += '```\\n\\n';\n}\n\n// Next steps\nmessage += `\ud83d\udcc1 *Next Steps:*\\n`;\nif (receipts.length > 0) {\n  message += `\u2022 Find and upload missing RECEIPTS to Receipt Pool folder\\n`;\n}\nif (invoices.length > 0) {\n  message += `\u2022 Find and upload missing INVOICES to Invoice Pool folder\\n`;\n}\nmessage += `\u2022 Re-run W3 (Matching) workflow\\n`;\nmessage += `\u2022 Re-run W0 to verify all matched\\n\\n`;\n\n// Add spreadsheet link\nmessage += `\ud83d\udcca <${data.sheet_url}|View Spreadsheet>`;\n\nreturn [{\n  json: {\n    slack_message: message,\n    ...data\n  }\n}];"
      },
      "id": "format-slack-missing",
      "name": "Format Slack Message (Missing)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        352
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "name",
          "value": "expense-reports"
        },
        "text": "={{ $json.slack_message }}",
        "otherOptions": {}
      },
      "id": "slack-success-notification",
      "name": "Send Slack Notification (Success)",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        2032,
        736
      ],
      "webhookId": "79a6ed0a-3b6d-459b-8c48-3755392dcc34",
      "credentials": {
        "slackApi": {
          "id": "iN2b9bGFpoyptSPr",
          "name": "slack-workflow-notifications"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\n\nconst message = `\u2705 *Expense Report for ${data.processing_period}*\\n\\n` +\n  `\ud83c\udf89 *All transactions matched!*\\n\\n` +\n  `No missing receipts or invoices.\\n\\n` +\n  `Total transactions: ${data.total_count}\\n` +\n  `Total amount: \u20ac${data.total_amount_eur}\\n\\n` +\n  `Status: ${data.status}\\n\\n` +\n  `\ud83d\udcc1 *Next Steps:*\\n` +\n  `\u2022 Run W4 (Folder Builder) to organize files\\n` +\n  `\u2022 Send organized folder to accountant\\n` +\n  `\u2022 Mark period as complete`;\n\nreturn [{\n  json: {\n    slack_message: message,\n    ...data\n  }\n}];"
      },
      "id": "format-slack-success",
      "name": "Format Slack Message (Success)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        736
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst hasMissing = data.has_missing;\n\nlet statusText = '';\nlet statusEmoji = '';\n\nif (hasMissing) {\n  statusEmoji = '\u26a0\ufe0f';\n  statusText = `*Missing Documents Detected*\\n\\n` +\n    `Missing Receipts: ${data.missing_receipts.count} transactions (\u20ac${data.missing_receipts.total})\\n` +\n    `Missing Invoices: ${data.missing_invoices.count} transactions (\u20ac${data.missing_invoices.total})\\n` +\n    `*Total: ${data.total_count} documents needed (\u20ac${data.grand_total})*`;\n} else {\n  statusEmoji = '\u2705';\n  statusText = `*All Transactions Matched!*\\n\\n` +\n    `Total transactions: ${data.total_count}\\n` +\n    `Total amount: \u20ac${data.total_amount_eur}\\n` +\n    `No missing receipts or invoices.`;\n}\n\nconst blocks = [\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `${statusEmoji} *Expense System Status - ${data.processing_period}*\\n\\n${statusText}`\n    }\n  },\n  {\n    \"type\": \"actions\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": {\"type\": \"plain_text\", \"text\": \"Re-match Now\"},\n        \"action_id\": \"expense_rematch\",\n        \"style\": \"primary\",\n        \"value\": \"rematch\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": {\"type\": \"plain_text\", \"text\": \"Execute Filing\"},\n        \"action_id\": \"expense_filing\",\n        \"value\": \"filing\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": {\"type\": \"plain_text\", \"text\": \"Send to Accountant\"},\n        \"action_id\": \"expense_accountant\",\n        \"style\": \"danger\",\n        \"value\": \"accountant\"\n      }\n    ]\n  }\n];\n\nreturn [{\n  json: {\n    blocks: blocks,\n    channel: \"expense-reports\",\n    text: `Expense System Status - ${data.processing_period}`,\n    ...data\n  }\n}];"
      },
      "id": "format-slack-interactive",
      "name": "Format Slack Interactive Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        544
      ]
    },
    {
      "parameters": {
        "url": "https://slack.com/api/chat.postMessage",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "slackApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json; charset=utf-8"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ channel: $json.channel, text: $json.text, blocks: $json.blocks }) }}",
        "options": {}
      },
      "id": "send-slack-interactive",
      "name": "Send Slack Interactive Message",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1808,
        544
      ],
      "credentials": {
        "slackApi": {
          "id": "iN2b9bGFpoyptSPr",
          "name": "slack-workflow-notifications"
        }
      }
    },
    {
      "parameters": {
        "path": "3efd8372-3112-44bd-a8fa-11f6fea3c6d0",
        "options": {
          "rawBody": true
        }
      },
      "id": "webhook-slack-buttons",
      "name": "Webhook: Slack Buttons",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        240,
        1264
      ],
      "webhookId": "3efd8372-3112-44bd-a8fa-11f6fea3c6d0",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// Slack sends payload as form-encoded 'payload' field\nconst payloadStr = $json.body?.payload || $json.payload;\n\nif (!payloadStr) {\n  throw new Error('No Slack payload found in request');\n}\n\n// Parse the JSON payload\nconst payload = typeof payloadStr === 'string' ? JSON.parse(payloadStr) : payloadStr;\n\n// Extract action details\nconst actionId = payload.actions?.[0]?.action_id;\nconst actionValue = payload.actions?.[0]?.value;\nconst responseUrl = payload.response_url;\nconst user = payload.user?.name || 'Unknown';\nconst channel = payload.channel?.id;\n\nreturn [{\n  json: {\n    action_id: actionId,\n    action_value: actionValue,\n    response_url: responseUrl,\n    user: user,\n    channel: channel,\n    full_payload: payload\n  }\n}];"
      },
      "id": "parse-slack-payload",
      "name": "Parse Slack Payload",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        1264
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "rematch-check",
                    "leftValue": "={{ $json.action_id }}",
                    "rightValue": "expense_rematch",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "rematch"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "filing-check",
                    "leftValue": "={{ $json.action_id }}",
                    "rightValue": "expense_filing",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "filing"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "accountant-check",
                    "leftValue": "={{ $json.action_id }}",
                    "rightValue": "expense_accountant",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "accountant"
            }
          ]
        },
        "options": {}
      },
      "id": "route-action",
      "name": "Route by Action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        688,
        1136
      ]
    },
    {
      "parameters": {
        "workflowId": "CJtdqMreZ17esJAW",
        "options": {}
      },
      "id": "execute-w3-rematch",
      "name": "Execute W3 (Re-match)",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        912,
        960
      ]
    },
    {
      "parameters": {
        "documentId": {
          "mode": "id",
          "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
        },
        "sheetName": {
          "mode": "name",
          "value": "Transactions"
        },
        "options": {}
      },
      "id": "read-transactions-after-rematch",
      "name": "Read Transactions After Re-match",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1136,
        960
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "H7ewI1sOrDYabelt",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $('Parse Slack Payload').first().json.response_url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', text: '\u2705 Re-match completed! Updated status will be posted shortly.' }) }}",
        "options": {}
      },
      "id": "respond-rematch-complete",
      "name": "Respond: Re-match Complete",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1360,
        960
      ]
    },
    {
      "parameters": {
        "workflowId": "nASL6hxNQGrNBTV4",
        "options": {}
      },
      "id": "execute-w4-filing",
      "name": "Execute W4 (Filing)",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        912,
        1152
      ]
    },
    {
      "parameters": {
        "url": "={{ $('Parse Slack Payload').first().json.response_url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', text: '\ud83d\udcc1 Filing workflow started! Documents are being organized...' }) }}",
        "options": {}
      },
      "id": "respond-filing-started",
      "name": "Respond: Filing Started",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1136,
        1152
      ]
    },
    {
      "parameters": {
        "jsCode": "// Get processing period from original orchestrator execution\n// Or use current month if not available\nconst now = new Date();\nconst monthName = now.toLocaleString('en-US', { month: 'long' });\nconst year = now.getFullYear();\n\nconst driveFolderId = '1fgJLso3FuZxX6JjUtN_PHsrIc-VCyl15';\nconst driveFolderUrl = `https://drive.google.com/drive/folders/${driveFolderId}`;\n\nconst subject = `VAT ${monthName} ${year} \u2014 Ready for Review`;\nconst body = `Hi,\\n\\nThe expense reports for ${monthName} ${year} are ready for your review.\\n\\nAll documents have been matched and organized in the following folder:\\n${driveFolderUrl}\\n\\nPlease review at your convenience.\\n\\nBest regards,\\nExpense System`;\n\nreturn [{\n  json: {\n    to: 'sway@oloxa.ai',  // TODO: Replace with actual accountant email\n    subject: subject,\n    body: body,\n    folder_url: driveFolderUrl\n  }\n}];"
      },
      "id": "prepare-accountant-email",
      "name": "Prepare Accountant Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        1344
      ]
    },
    {
      "parameters": {
        "sendTo": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.body }}",
        "options": {}
      },
      "id": "send-accountant-email",
      "name": "Send Accountant Email",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1136,
        1344
      ],
      "webhookId": "42451ebf-1e14-4bc3-aa45-06652eb69c72",
      "credentials": {
        "gmailOAuth2": {
          "id": "aYzk7sZF8ZVyfOan",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $('Parse Slack Payload').first().json.response_url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', text: '\u2709\ufe0f Email sent to accountant with folder link!' }) }}",
        "options": {}
      },
      "id": "respond-accountant-emailed",
      "name": "Respond: Accountant Emailed",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1360,
        1344
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ response_type: 'ephemeral', text: 'Processing your request...' }) }}",
        "options": {}
      },
      "id": "acknowledge-slack-button",
      "name": "Acknowledge Slack Button",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        688,
        1360
      ]
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Extract Input Parameters",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Input Parameters": {
      "main": [
        [
          {
            "node": "Execute W1 (Bank Statements)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Read Transactions Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute W1 (Bank Statements)": {
      "main": [
        [
          {
            "node": "Execute W2 (Gmail Receipts)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute W2 (Gmail Receipts)": {
      "main": [
        [
          {
            "node": "Execute W6 (Expensify)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute W6 (Expensify)": {
      "main": [
        [
          {
            "node": "Execute W3 (Matching)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Transactions Sheet": {
      "main": [
        [
          {
            "node": "Filter Missing Documents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Missing Documents": {
      "main": [
        [
          {
            "node": "Check if Missing Receipts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Missing Receipts": {
      "main": [
        [
          {
            "node": "Calculate Missing Summary",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Calculate Success Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Missing Summary": {
      "main": [
        [
          {
            "node": "Format Slack Message (Missing)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Slack Interactive Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Slack Message (Missing)": {
      "main": [
        [
          {
            "node": "Log Missing Receipts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Missing Receipts": {
      "main": [
        [
          {
            "node": "Send Slack Notification (Missing)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Success Summary": {
      "main": [
        [
          {
            "node": "Format Slack Message (Success)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Slack Interactive Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Slack Message (Success)": {
      "main": [
        [
          {
            "node": "Log Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Success": {
      "main": [
        [
          {
            "node": "Send Slack Notification (Success)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Slack Interactive Message": {
      "main": [
        [
          {
            "node": "Send Slack Interactive Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: Slack Buttons": {
      "main": [
        [
          {
            "node": "Parse Slack Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Slack Payload": {
      "main": [
        [
          {
            "node": "Route by Action",
            "type": "main",
            "index": 0
          },
          {
            "node": "Acknowledge Slack Button",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Action": {
      "main": [
        [
          {
            "node": "Execute W3 (Re-match)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Execute W4 (Filing)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare Accountant Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute W3 (Re-match)": {
      "main": [
        [
          {
            "node": "Read Transactions After Re-match",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Transactions After Re-match": {
      "main": [
        [
          {
            "node": "Respond: Re-match Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute W4 (Filing)": {
      "main": [
        [
          {
            "node": "Respond: Filing Started",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Accountant Email": {
      "main": [
        [
          {
            "node": "Send Accountant Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Accountant Email": {
      "main": [
        [
          {
            "node": "Respond: Accountant Emailed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": true,
    "timeSavedMode": "fixed"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "8f797f9e-1377-428f-a411-08d9fe048ee2",
  "activeVersionId": "8f797f9e-1377-428f-a411-08d9fe048ee2",
  "versionCounter": 103,
  "triggerCount": 2,
  "shared": [
    {
      "updatedAt": "2026-01-29T09:59:22.044Z",
      "createdAt": "2026-01-29T09:59:22.044Z",
      "role": "workflow:owner",
      "workflowId": "ewZOYMYOqSfgtjFm",
      "projectId": "Rs8mhw052fnrzWZM",
      "project": {
        "updatedAt": "2025-12-31T15:54:29.115Z",
        "createdAt": "2025-12-31T15:27:33.865Z",
        "id": "Rs8mhw052fnrzWZM",
        "name": "Sway Clarke <sway@oloxa.ai>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
        "projectRelations": [
          {
            "updatedAt": "2025-12-31T15:27:33.865Z",
            "createdAt": "2025-12-31T15:27:33.865Z",
            "userId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
            "projectId": "Rs8mhw052fnrzWZM",
            "user": {
              "updatedAt": "2026-01-31T00:12:46.682Z",
              "createdAt": "2025-12-31T15:27:33.119Z",
              "id": "e9bd9112-c2e3-4f67-873a-e1001baeafd8",
              "email": "sway@oloxa.ai",
              "firstName": "Sway",
              "lastName": "Clarke",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-12-31T15:54:37.562Z",
                "personalization_survey_n8n_version": "2.1.4"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "zbxHkXOoD1qaz6OS",
                "userActivatedAt": 1767398053308,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1767684846804
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-01-30",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2026-01-29T22:32:37.299Z",
    "createdAt": "2026-01-29T22:32:37.299Z",
    "versionId": "8f797f9e-1377-428f-a411-08d9fe048ee2",
    "workflowId": "ewZOYMYOqSfgtjFm",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "w0-expense-orchestrator-start",
          "responseMode": "lastNode",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Webhook Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          240,
          448
        ],
        "webhookId": "6ab02e2b-808d-481c-b0c8-bcdf73071278"
      },
      {
        "parameters": {
          "jsCode": "const month = $json.body?.month || '';\nconst quarter = $json.body?.quarter || '';\nconst processDate = new Date().toISOString();\n\nif (!month && !quarter) {\n  throw new Error('Must provide either month or quarter parameter in body');\n}\n\nreturn [{\n  json: {\n    processing_period: month || quarter,\n    process_date: processDate,\n    status: 'STARTED'\n  }\n}];"
        },
        "id": "extract-params",
        "name": "Extract Input Parameters",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          464,
          448
        ]
      },
      {
        "parameters": {
          "workflowId": "MPjDdVMI88158iFW",
          "options": {}
        },
        "id": "execute-w1",
        "name": "Execute W1 (Bank Statements)",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          688,
          208
        ],
        "disabled": true
      },
      {
        "parameters": {
          "workflowId": "dHbwemg7hEB4vDmC",
          "options": {}
        },
        "id": "execute-w2",
        "name": "Execute W2 (Gmail Receipts)",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          912,
          208
        ],
        "disabled": true
      },
      {
        "parameters": {
          "workflowId": "zFdAi3H5LFFbqusX",
          "options": {}
        },
        "id": "execute-w6",
        "name": "Execute W6 (Expensify)",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          1136,
          208
        ],
        "disabled": true
      },
      {
        "parameters": {
          "workflowId": "CJtdqMreZ17esJAW",
          "options": {}
        },
        "id": "execute-w3",
        "name": "Execute W3 (Matching)",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          1360,
          208
        ],
        "disabled": true
      },
      {
        "parameters": {
          "documentId": {
            "mode": "id",
            "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
          },
          "sheetName": {
            "mode": "name",
            "value": "Transactions"
          },
          "options": {}
        },
        "id": "read-transactions",
        "name": "Read Transactions Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          688,
          544
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "H7ewI1sOrDYabelt",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueRegularOutput",
        "executeOnce": false,
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "jsCode": "const transactions = $input.all();\n\n// Handle empty transactions case\nif (!transactions || transactions.length === 0) {\n  return [{\n    json: {\n      _empty: true,\n      _message: 'No transactions found for this period',\n      total_transactions: 0,\n      missing_count: 0\n    }\n  }];\n}\n\nconst excludedVendors = ['Deka', 'Edeka', 'DM', 'Kumpel und Keule', 'Bettoni'];\nconst minAmount = 10;\n\nconst missingDocuments = transactions.filter(item => {\n  const amount = parseFloat(item.json.Amount) || 0;\n  const vendor = item.json.Vendor || '';\n  const matchStatus = (item.json.MatchStatus || '').toLowerCase();\n\n  if (Math.abs(amount) < minAmount) return false;\n  if (excludedVendors.includes(vendor)) return false;\n  if (matchStatus === 'matched') return false;\n\n  return true;\n});\n\nif (missingDocuments.length === 0) {\n  return [{\n    json: {\n      _empty: true,\n      _message: 'All transactions matched or below threshold',\n      total_transactions: transactions.length,\n      missing_count: 0\n    }\n  }];\n}\n\nreturn missingDocuments.map(item => {\n  const amount = parseFloat(item.json.Amount) || 0;\n  const docType = amount < 0 ? 'receipt' : 'invoice';\n  \n  return {\n    json: {\n      transaction_date: item.json.Date,\n      vendor: item.json.Vendor,\n      amount_eur: item.json.Amount,\n      category: item.json.Category,\n      description: item.json.Description,\n      transaction_id: item.json.TransactionID,\n      document_type: docType\n    }\n  };\n});"
        },
        "id": "filter-missing",
        "name": "Filter Missing Documents",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          912,
          544
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "has-items",
                "leftValue": "={{ $input.first().json._empty ? 0 : $input.all().length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ]
          },
          "options": {}
        },
        "id": "check-missing",
        "name": "Check if Missing Receipts",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1136,
          544
        ]
      },
      {
        "parameters": {
          "jsCode": "const missingItems = $input.all();\n\n// Separate by document type\nconst missingReceipts = missingItems.filter(item => item.json.document_type === 'receipt');\nconst missingInvoices = missingItems.filter(item => item.json.document_type === 'invoice');\n\n// Calculate totals\nconst receiptsTotal = missingReceipts.reduce((sum, item) => {\n  return sum + Math.abs(parseFloat(item.json.amount_eur || 0));\n}, 0);\n\nconst invoicesTotal = missingInvoices.reduce((sum, item) => {\n  return sum + parseFloat(item.json.amount_eur || 0);\n}, 0);\n\nconst grandTotal = receiptsTotal + invoicesTotal;\n\nconst processingPeriod = $('Extract Input Parameters').first().json.processing_period;\nconst spreadsheetId = '1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM';\n\nreturn [{\n  json: {\n    has_missing: true,\n    missing_receipts: {\n      count: missingReceipts.length,\n      total: receiptsTotal.toFixed(2)\n    },\n    missing_invoices: {\n      count: missingInvoices.length,\n      total: invoicesTotal.toFixed(2)\n    },\n    grand_total: grandTotal.toFixed(2),\n    total_count: missingItems.length,\n    processing_period: processingPeriod,\n    sheet_url: `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit`,\n    missing_documents: missingItems.map(item => item.json)\n  }\n}];"
        },
        "id": "calc-missing-summary",
        "name": "Calculate Missing Summary",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1360,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const data = $input.first().json;\n\n// Separate documents by type\nconst receipts = data.missing_documents.filter(d => d.document_type === 'receipt');\nconst invoices = data.missing_documents.filter(d => d.document_type === 'invoice');\n\nconsole.log('\\n========================================');\nconsole.log('\ud83d\udccb MISSING DOCUMENTS DETECTED');\nconsole.log('========================================');\nconsole.log(`Month/Quarter: ${data.processing_period}`);\nconsole.log('');\nconsole.log(`Missing Receipts (Expenses): ${data.missing_receipts.count} transactions, \u20ac${data.missing_receipts.total}`);\nconsole.log(`Missing Invoices (Income): ${data.missing_invoices.count} transactions, \u20ac${data.missing_invoices.total}`);\nconsole.log('');\nconsole.log(`GRAND TOTAL: ${data.total_count} transactions, \u20ac${data.grand_total}`);\nconsole.log(`\\n\ud83d\udcca View spreadsheet: ${data.sheet_url}`);\nconsole.log('========================================');\n\n// Helper function to format transaction for display\nfunction formatTransaction(doc, index) {\n  const amount = Math.abs(parseFloat(doc.amount_eur)).toFixed(2);\n  const date = doc.transaction_date || 'N/A';\n  const vendor = doc.vendor || 'Unknown';\n  const desc = doc.description || '';\n  \n  // Truncate description if too long\n  const displayDesc = desc.length > 50 ? desc.substring(0, 47) + '...' : desc;\n  \n  return `${(index + 1).toString().padStart(2, ' ')}. ${date} | \u20ac${amount.padStart(10, ' ')} | ${vendor} | ${displayDesc}`;\n}\n\n// Display Missing Receipts (Expenses)\nif (receipts.length > 0) {\n  console.log('\\n\ud83d\udcc4 MISSING RECEIPTS (Expenses):');\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  receipts.forEach((doc, idx) => {\n    console.log(formatTransaction(doc, idx));\n  });\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  console.log(`Subtotal: ${receipts.length} transactions, \u20ac${data.missing_receipts.total}`);\n}\n\n// Display Missing Invoices (Income)\nif (invoices.length > 0) {\n  console.log('\\n\ud83d\udcc4 MISSING INVOICES (Income):');\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  invoices.forEach((doc, idx) => {\n    console.log(formatTransaction(doc, idx));\n  });\n  console.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\n  console.log(`Subtotal: ${invoices.length} transactions, \u20ac${data.missing_invoices.total}`);\n}\n\n// Next steps\nconsole.log('\\n\ud83d\udcc1 NEXT STEPS:');\nconsole.log('\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501');\nif (receipts.length > 0) {\n  console.log('1. Find and upload missing RECEIPTS (for expenses) to Receipt Pool folder');\n}\nif (invoices.length > 0) {\n  console.log('2. Find and upload missing INVOICES (for income) to Invoice Pool folder');\n}\nconsole.log('3. Re-run W3 (Matching) workflow to match documents');\nconsole.log('4. Re-run W0 to verify all documents matched');\nconsole.log('========================================\\n');\n\nreturn [{ json: data }];}"
        },
        "id": "log-missing",
        "name": "Log Missing Receipts",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1808,
          352
        ]
      },
      {
        "parameters": {
          "jsCode": "const allTransactions = $('Read Transactions Sheet').all();\nconst totalCount = allTransactions.length;\nconst totalAmount = allTransactions.reduce((sum, item) => {\n  return sum + parseFloat(item.json.Amount || 0);\n}, 0);\n\nconst processingPeriod = $('Extract Input Parameters').first().json.processing_period;\n\nreturn [{\n  json: {\n    has_missing: false,\n    total_count: totalCount,\n    total_amount_eur: totalAmount.toFixed(2),\n    processing_period: processingPeriod,\n    status: 'COMPLETE',\n    next_steps: 'Ready for W4 (Folder Builder) and accountant handoff'\n  }\n}];"
        },
        "id": "calc-success-summary",
        "name": "Calculate Success Summary",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1360,
          688
        ]
      },
      {
        "parameters": {
          "jsCode": "const data = $input.first().json;\n\nconsole.log('\\n========================================');\nconsole.log('\u2705 ALL RECEIPTS MATCHED');\nconsole.log('========================================');\nconsole.log(`Month/Quarter: ${data.processing_period}`);\nconsole.log(`Total transactions: ${data.total_count}`);\nconsole.log(`Total amount: \u20ac${data.total_amount_eur}`);\nconsole.log(`\\nStatus: ${data.status}`);\nconsole.log('\\n\ud83d\udcc1 Next steps:');\nconsole.log('   1. Run W4 (Folder Builder) to organize files');\nconsole.log('   2. Send organized folder to accountant');\nconsole.log('   3. Mark period as complete');\nconsole.log('========================================\\n');\n\nreturn [{ json: data }];"
        },
        "id": "log-success",
        "name": "Log Success",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1808,
          736
        ]
      },
      {
        "parameters": {
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "name",
            "value": "expense-reports"
          },
          "text": "={{ $json.slack_message }}",
          "otherOptions": {}
        },
        "id": "slack-missing-notification",
        "name": "Send Slack Notification (Missing)",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.4,
        "position": [
          2032,
          352
        ],
        "webhookId": "ccd6fa6d-f414-4859-8ed8-f042cb5f7f6d",
        "credentials": {
          "slackApi": {
            "id": "iN2b9bGFpoyptSPr",
            "name": "slack-workflow-notifications"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const data = $input.first().json;\n\n// Separate documents by type\nconst receipts = data.missing_documents.filter(d => d.document_type === 'receipt');\nconst invoices = data.missing_documents.filter(d => d.document_type === 'invoice');\n\n// Helper function to format transaction for Slack\nfunction formatTransaction(doc, index) {\n  const amount = Math.abs(parseFloat(doc.amount_eur)).toFixed(2);\n  const date = doc.transaction_date || 'N/A';\n  const vendor = doc.vendor || 'Unknown';\n  return `${index + 1}. ${date} | \u20ac${amount} | ${vendor}`;\n}\n\n// Build message sections\nlet message = `\ud83d\udd14 *Expense Report for ${data.processing_period}*\\n\\n`;\n\n// Summary\nmessage += `\ud83d\udcca *Summary*\\n`;\nmessage += `Missing Receipts (Expenses): ${data.missing_receipts.count} transactions, \u20ac${data.missing_receipts.total}\\n`;\nmessage += `Missing Invoices (Income): ${data.missing_invoices.count} transactions, \u20ac${data.missing_invoices.total}\\n`;\nmessage += `*TOTAL: ${data.total_count} documents needed, \u20ac${data.grand_total}*\\n\\n`;\n\n// Missing Receipts section\nif (receipts.length > 0) {\n  message += `\ud83d\udcc4 *MISSING RECEIPTS (${receipts.length} expenses, \u20ac${data.missing_receipts.total}):*\\n`;\n  message += '```\\n';\n  receipts.slice(0, 20).forEach((doc, idx) => {\n    message += formatTransaction(doc, idx) + '\\n';\n  });\n  if (receipts.length > 20) {\n    message += `... and ${receipts.length - 20} more\\n`;\n  }\n  message += '```\\n\\n';\n}\n\n// Missing Invoices section\nif (invoices.length > 0) {\n  message += `\ud83d\udcc4 *MISSING INVOICES (${invoices.length} income, \u20ac${data.missing_invoices.total}):*\\n`;\n  message += '```\\n';\n  invoices.slice(0, 20).forEach((doc, idx) => {\n    message += formatTransaction(doc, idx) + '\\n';\n  });\n  if (invoices.length > 20) {\n    message += `... and ${invoices.length - 20} more\\n`;\n  }\n  message += '```\\n\\n';\n}\n\n// Next steps\nmessage += `\ud83d\udcc1 *Next Steps:*\\n`;\nif (receipts.length > 0) {\n  message += `\u2022 Find and upload missing RECEIPTS to Receipt Pool folder\\n`;\n}\nif (invoices.length > 0) {\n  message += `\u2022 Find and upload missing INVOICES to Invoice Pool folder\\n`;\n}\nmessage += `\u2022 Re-run W3 (Matching) workflow\\n`;\nmessage += `\u2022 Re-run W0 to verify all matched\\n\\n`;\n\n// Add spreadsheet link\nmessage += `\ud83d\udcca <${data.sheet_url}|View Spreadsheet>`;\n\nreturn [{\n  json: {\n    slack_message: message,\n    ...data\n  }\n}];"
        },
        "id": "format-slack-missing",
        "name": "Format Slack Message (Missing)",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1584,
          352
        ]
      },
      {
        "parameters": {
          "select": "channel",
          "channelId": {
            "__rl": true,
            "mode": "name",
            "value": "expense-reports"
          },
          "text": "={{ $json.slack_message }}",
          "otherOptions": {}
        },
        "id": "slack-success-notification",
        "name": "Send Slack Notification (Success)",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.4,
        "position": [
          2032,
          736
        ],
        "webhookId": "79a6ed0a-3b6d-459b-8c48-3755392dcc34",
        "credentials": {
          "slackApi": {
            "id": "iN2b9bGFpoyptSPr",
            "name": "slack-workflow-notifications"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const data = $input.first().json;\n\nconst message = `\u2705 *Expense Report for ${data.processing_period}*\\n\\n` +\n  `\ud83c\udf89 *All transactions matched!*\\n\\n` +\n  `No missing receipts or invoices.\\n\\n` +\n  `Total transactions: ${data.total_count}\\n` +\n  `Total amount: \u20ac${data.total_amount_eur}\\n\\n` +\n  `Status: ${data.status}\\n\\n` +\n  `\ud83d\udcc1 *Next Steps:*\\n` +\n  `\u2022 Run W4 (Folder Builder) to organize files\\n` +\n  `\u2022 Send organized folder to accountant\\n` +\n  `\u2022 Mark period as complete`;\n\nreturn [{\n  json: {\n    slack_message: message,\n    ...data\n  }\n}];"
        },
        "id": "format-slack-success",
        "name": "Format Slack Message (Success)",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1584,
          736
        ]
      },
      {
        "parameters": {
          "jsCode": "const data = $input.first().json;\nconst hasMissing = data.has_missing;\n\nlet statusText = '';\nlet statusEmoji = '';\n\nif (hasMissing) {\n  statusEmoji = '\u26a0\ufe0f';\n  statusText = `*Missing Documents Detected*\\n\\n` +\n    `Missing Receipts: ${data.missing_receipts.count} transactions (\u20ac${data.missing_receipts.total})\\n` +\n    `Missing Invoices: ${data.missing_invoices.count} transactions (\u20ac${data.missing_invoices.total})\\n` +\n    `*Total: ${data.total_count} documents needed (\u20ac${data.grand_total})*`;\n} else {\n  statusEmoji = '\u2705';\n  statusText = `*All Transactions Matched!*\\n\\n` +\n    `Total transactions: ${data.total_count}\\n` +\n    `Total amount: \u20ac${data.total_amount_eur}\\n` +\n    `No missing receipts or invoices.`;\n}\n\nconst blocks = [\n  {\n    \"type\": \"section\",\n    \"text\": {\n      \"type\": \"mrkdwn\",\n      \"text\": `${statusEmoji} *Expense System Status - ${data.processing_period}*\\n\\n${statusText}`\n    }\n  },\n  {\n    \"type\": \"actions\",\n    \"elements\": [\n      {\n        \"type\": \"button\",\n        \"text\": {\"type\": \"plain_text\", \"text\": \"Re-match Now\"},\n        \"action_id\": \"expense_rematch\",\n        \"style\": \"primary\",\n        \"value\": \"rematch\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": {\"type\": \"plain_text\", \"text\": \"Execute Filing\"},\n        \"action_id\": \"expense_filing\",\n        \"value\": \"filing\"\n      },\n      {\n        \"type\": \"button\",\n        \"text\": {\"type\": \"plain_text\", \"text\": \"Send to Accountant\"},\n        \"action_id\": \"expense_accountant\",\n        \"style\": \"danger\",\n        \"value\": \"accountant\"\n      }\n    ]\n  }\n];\n\nreturn [{\n  json: {\n    blocks: blocks,\n    channel: \"expense-reports\",\n    text: `Expense System Status - ${data.processing_period}`,\n    ...data\n  }\n}];"
        },
        "id": "format-slack-interactive",
        "name": "Format Slack Interactive Message",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1584,
          544
        ]
      },
      {
        "parameters": {
          "url": "https://slack.com/api/chat.postMessage",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "slackApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json; charset=utf-8"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ channel: $json.channel, text: $json.text, blocks: $json.blocks }) }}",
          "options": {}
        },
        "id": "send-slack-interactive",
        "name": "Send Slack Interactive Message",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1808,
          544
        ],
        "credentials": {
          "slackApi": {
            "id": "iN2b9bGFpoyptSPr",
            "name": "slack-workflow-notifications"
          }
        }
      },
      {
        "parameters": {
          "path": "3efd8372-3112-44bd-a8fa-11f6fea3c6d0",
          "options": {
            "rawBody": true
          }
        },
        "id": "webhook-slack-buttons",
        "name": "Webhook: Slack Buttons",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          240,
          1264
        ],
        "webhookId": "3efd8372-3112-44bd-a8fa-11f6fea3c6d0",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "jsCode": "// Slack sends payload as form-encoded 'payload' field\nconst payloadStr = $json.body?.payload || $json.payload;\n\nif (!payloadStr) {\n  throw new Error('No Slack payload found in request');\n}\n\n// Parse the JSON payload\nconst payload = typeof payloadStr === 'string' ? JSON.parse(payloadStr) : payloadStr;\n\n// Extract action details\nconst actionId = payload.actions?.[0]?.action_id;\nconst actionValue = payload.actions?.[0]?.value;\nconst responseUrl = payload.response_url;\nconst user = payload.user?.name || 'Unknown';\nconst channel = payload.channel?.id;\n\nreturn [{\n  json: {\n    action_id: actionId,\n    action_value: actionValue,\n    response_url: responseUrl,\n    user: user,\n    channel: channel,\n    full_payload: payload\n  }\n}];"
        },
        "id": "parse-slack-payload",
        "name": "Parse Slack Payload",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          464,
          1264
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "rematch-check",
                      "leftValue": "={{ $json.action_id }}",
                      "rightValue": "expense_rematch",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "rematch"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "filing-check",
                      "leftValue": "={{ $json.action_id }}",
                      "rightValue": "expense_filing",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "filing"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "accountant-check",
                      "leftValue": "={{ $json.action_id }}",
                      "rightValue": "expense_accountant",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "accountant"
              }
            ]
          },
          "options": {}
        },
        "id": "route-action",
        "name": "Route by Action",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          688,
          1136
        ]
      },
      {
        "parameters": {
          "workflowId": "CJtdqMreZ17esJAW",
          "options": {}
        },
        "id": "execute-w3-rematch",
        "name": "Execute W3 (Re-match)",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          912,
          960
        ]
      },
      {
        "parameters": {
          "documentId": {
            "mode": "id",
            "value": "1l1uA8qA0DCGzGLBhmP2HqTzaajjbkURY2SLeqSuHMXM"
          },
          "sheetName": {
            "mode": "name",
            "value": "Transactions"
          },
          "options": {}
        },
        "id": "read-transactions-after-rematch",
        "name": "Read Transactions After Re-match",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1136,
          960
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "H7ewI1sOrDYabelt",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "url": "={{ $('Parse Slack Payload').first().json.response_url }}",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', text: '\u2705 Re-match completed! Updated status will be posted shortly.' }) }}",
          "options": {}
        },
        "id": "respond-rematch-complete",
        "name": "Respond: Re-match Complete",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1360,
          960
        ]
      },
      {
        "parameters": {
          "workflowId": "nASL6hxNQGrNBTV4",
          "options": {}
        },
        "id": "execute-w4-filing",
        "name": "Execute W4 (Filing)",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          912,
          1152
        ]
      },
      {
        "parameters": {
          "url": "={{ $('Parse Slack Payload').first().json.response_url }}",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', text: '\ud83d\udcc1 Filing workflow started! Documents are being organized...' }) }}",
          "options": {}
        },
        "id": "respond-filing-started",
        "name": "Respond: Filing Started",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1136,
          1152
        ]
      },
      {
        "parameters": {
          "jsCode": "// Get processing period from original orchestrator execution\n// Or use current month if not available\nconst now = new Date();\nconst monthName = now.toLocaleString('en-US', { month: 'long' });\nconst year = now.getFullYear();\n\nconst driveFolderId = '1fgJLso3FuZxX6JjUtN_PHsrIc-VCyl15';\nconst driveFolderUrl = `https://drive.google.com/drive/folders/${driveFolderId}`;\n\nconst subject = `VAT ${monthName} ${year} \u2014 Ready for Review`;\nconst body = `Hi,\\n\\nThe expense reports for ${monthName} ${year} are ready for your review.\\n\\nAll documents have been matched and organized in the following folder:\\n${driveFolderUrl}\\n\\nPlease review at your convenience.\\n\\nBest regards,\\nExpense System`;\n\nreturn [{\n  json: {\n    to: 'sway@oloxa.ai',  // TODO: Replace with actual accountant email\n    subject: subject,\n    body: body,\n    folder_url: driveFolderUrl\n  }\n}];"
        },
        "id": "prepare-accountant-email",
        "name": "Prepare Accountant Email",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          912,
          1344
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.to }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.body }}",
          "options": {}
        },
        "id": "send-accountant-email",
        "name": "Send Accountant Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1136,
          1344
        ],
        "webhookId": "42451ebf-1e14-4bc3-aa45-06652eb69c72",
        "credentials": {
          "gmailOAuth2": {
            "id": "aYzk7sZF8ZVyfOan",
            "name": "Gmail account"
          }
        }
      },
      {
        "parameters": {
          "url": "={{ $('Parse Slack Payload').first().json.response_url }}",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ response_type: 'in_channel', text: '\u2709\ufe0f Email sent to accountant with folder link!' }) }}",
          "options": {}
        },
        "id": "respond-accountant-emailed",
        "name": "Respond: Accountant Emailed",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1360,
          1344
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify({ response_type: 'ephemeral', text: 'Processing your request...' }) }}",
          "options": {}
        },
        "id": "acknowledge-slack-button",
        "name": "Acknowledge Slack Button",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          688,
          1360
        ]
      }
    ],
    "connections": {
      "Webhook Trigger": {
        "main": [
          [
            {
              "node": "Extract Input Parameters",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Input Parameters": {
        "main": [
          [
            {
              "node": "Execute W1 (Bank Statements)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Read Transactions Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute W1 (Bank Statements)": {
        "main": [
          [
            {
              "node": "Execute W2 (Gmail Receipts)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute W2 (Gmail Receipts)": {
        "main": [
          [
            {
              "node": "Execute W6 (Expensify)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute W6 (Expensify)": {
        "main": [
          [
            {
              "node": "Execute W3 (Matching)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Transactions Sheet": {
        "main": [
          [
            {
              "node": "Filter Missing Documents",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Missing Documents": {
        "main": [
          [
            {
              "node": "Check if Missing Receipts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if Missing Receipts": {
        "main": [
          [
            {
              "node": "Calculate Missing Summary",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Calculate Success Summary",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Missing Summary": {
        "main": [
          [
            {
              "node": "Format Slack Message (Missing)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Format Slack Interactive Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Slack Message (Missing)": {
        "main": [
          [
            {
              "node": "Log Missing Receipts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Missing Receipts": {
        "main": [
          [
            {
              "node": "Send Slack Notification (Missing)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Success Summary": {
        "main": [
          [
            {
              "node": "Format Slack Message (Success)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Format Slack Interactive Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Slack Message (Success)": {
        "main": [
          [
            {
              "node": "Log Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Success": {
        "main": [
          [
            {
              "node": "Send Slack Notification (Success)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Slack Interactive Message": {
        "main": [
          [
            {
              "node": "Send Slack Interactive Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook: Slack Buttons": {
        "main": [
          [
            {
              "node": "Parse Slack Payload",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Slack Payload": {
        "main": [
          [
            {
              "node": "Route by Action",
              "type": "main",
              "index": 0
            },
            {
              "node": "Acknowledge Slack Button",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Action": {
        "main": [
          [
            {
              "node": "Execute W3 (Re-match)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Execute W4 (Filing)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Prepare Accountant Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute W3 (Re-match)": {
        "main": [
          [
            {
              "node": "Read Transactions After Re-match",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Transactions After Re-match": {
        "main": [
          [
            {
              "node": "Respond: Re-match Complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute W4 (Filing)": {
        "main": [
          [
            {
              "node": "Respond: Filing Started",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Accountant Email": {
        "main": [
          [
            {
              "node": "Send Accountant Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Accountant Email": {
        "main": [
          [
            {
              "node": "Respond: Accountant Emailed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Sway Clarke",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-01-29T22:32:37.452Z",
        "id": 1853,
        "workflowId": "ewZOYMYOqSfgtjFm",
        "versionId": "8f797f9e-1377-428f-a411-08d9fe048ee2",
        "event": "activated",
        "userId": "e9bd9112-c2e3-4f67-873a-e1001baeafd8"
      }
    ]
  }
}