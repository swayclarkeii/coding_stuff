# SOP Builder Update - Quick Reference Checklist

## ✅ Implementation Status: COMPLETE

All 10 requested changes have been implemented and validated.

---

## Pre-Testing Checklist

### 1. Airtable Schema Updates Required

**Action:** Add these columns to Airtable table `tblEHjJlvorWTgptU`:

| Column Name | Type | Description |
|-------------|------|-------------|
| `end_user` | Single line text | Who will use this SOP |
| `lead_id` | Single line text | Unique identifier for tracking |
| `submission_count` | Number | Count of submissions (starts at 1) |
| `score_history` | Long text | Comma-separated scores (e.g., "45,62,78") |
| `previous_score` | Number | Last score (for comparison) |

**How to verify:**
1. Go to Airtable base: `appvd4nlsNhIWYdbI` (Oloxa CRM)
2. Open table: `tblEHjJlvorWTgptU`
3. Check if columns exist
4. If missing, add them with correct field types

---

### 2. Form Integration Updates Required

**Action:** Update sopbuilder.oloxa.ai form to:

1. **Add `end_user` field:**
   - Label: "Who will use this SOP?"
   - Type: Text input
   - Example: "Sales team members", "Customer support agents"

2. **Handle `lead_id` parameter:**
   - Check URL for `?lead=xxx` parameter
   - If present: include in form submission
   - If absent: leave blank (workflow will generate)

3. **Pre-fill returning user data:**
   - Check URL for `?email=xxx&name=xxx` parameters
   - Pre-fill form fields if present
   - User should see: "Welcome back, [name]!"

**Form submission structure:**
```javascript
{
  email: "user@example.com",
  name: "John Doe",
  goal: "Improve customer onboarding",
  department: "Sales",
  improvement_type: "process_improvement",
  process_steps: "Step 1: ...\nStep 2: ...",
  end_user: "Sales team members",  // ← NEW
  lead_id: "lead_abc123xyz"        // ← NEW (if returning user)
}
```

---

## Testing Workflow

### Test 1: New User (Basic)
**Status:** ⬜ Not tested

**Input:**
```json
{
  "email": "newuser@test.com",
  "name": "Test User",
  "goal": "Document approval process",
  "department": "Operations",
  "improvement_type": "process_improvement",
  "process_steps": "1. Receive request\n2. Review document\n3. Approve or reject",
  "end_user": "Operations managers"
}
```

**Expected:**
- ✅ Lead ID generated automatically
- ✅ Score calculated (likely <75%)
- ✅ 3 quick wins in email
- ✅ "Who will use this" shows in email
- ✅ Airtable: new record created with `submission_count: 1`
- ✅ Email: Resubmit CTA with lead_id in URL

---

### Test 2: Returning User (Score Improvement)
**Status:** ⬜ Not tested

**Input:** Same email as Test 1, improved process_steps, include lead_id from previous test

**Expected:**
- ✅ Existing record found
- ✅ `submission_count` incremented to 2
- ✅ `score_history` appended: "45,62" (example)
- ✅ Progress badge shows: "Previous: 45% → Now: 62%"
- ✅ Airtable: record updated (NOT created)
- ✅ Email: Same resubmit CTA with lead_id

---

### Test 3: High Score (Success Email)
**Status:** ⬜ Not tested

**Input:** Comprehensive SOP with all 5 elements (should score ≥75%)

**Expected:**
- ✅ Success email sent (not improvement email)
- ✅ Header shows "Congratulations!"
- ✅ "Who will use this" field present
- ✅ Calendly CTA (not resubmit CTA)
- ✅ Full improved SOP shown

---

## Verification Points

### Email Rendering
- [ ] Header displays at 28px font size
- [ ] Quick wins section shows 3 items
- [ ] Quick wins have gold numbers (#d4af37)
- [ ] "How to fix" text is amber/orange (#E8A317)
- [ ] Progress badge displays correctly (if returning)
- [ ] Resubmit CTA button is gold
- [ ] CTA link includes lead_id and email parameters

### Airtable Records
- [ ] New records have `submission_count: 1`
- [ ] Returning users increment `submission_count`
- [ ] `score_history` appends correctly: "45,62,78"
- [ ] `lead_id` is unique per user
- [ ] `end_user` field populated
- [ ] No duplicate records created

### Workflow Execution
- [ ] No errors in execution log
- [ ] All nodes execute successfully
- [ ] Quick wins generated by LLM
- [ ] Lead ID generation works
- [ ] Airtable search finds existing records
- [ ] Email sent successfully

---

## Troubleshooting Guide

### Issue: No quick wins in email
**Cause:** LLM didn't return `top_3_quick_wins` in JSON
**Fix:** Check LLM response in "Extract Validation Response" node output

### Issue: Lead ID not passed to form on resubmit
**Cause:** Email CTA link missing parameters
**Fix:** Verify CTA URL includes: `?lead=${data.lead_id}&email=${encodeURIComponent(data.email)}`

### Issue: Duplicate Airtable records
**Cause:** Search by email not working
**Fix:** Check "Check Existing Lead" node filterByFormula syntax

### Issue: Progress badge not showing
**Cause:** `submission_count` or `previous_score` missing
**Fix:** Verify "Prepare Update Data" node stores `previous_score` correctly

### Issue: Email design broken
**Cause:** HTML rendering issues in email client
**Fix:** Test in multiple clients (Gmail, Outlook, Apple Mail)

---

## Post-Testing Actions

### If Tests Pass:
1. ✅ Activate workflow (if not already active)
2. ✅ Update form to include new fields
3. ✅ Monitor first 10 real submissions
4. ✅ Check Airtable data quality
5. ✅ Verify email deliverability

### If Tests Fail:
1. Document specific failure
2. Check execution logs in n8n
3. Run workflow in debug mode
4. Contact solution-builder-agent for fixes

---

## Quick Access Links

- **n8n Workflow:** https://n8n.oloxa.ai/workflow/ikVyMpDI0az6Zk4t
- **Airtable Base:** https://airtable.com/appvd4nlsNhIWYdbI
- **Webhook URL:** https://n8n.oloxa.ai/webhook/sop-builder
- **Form URL:** https://sopbuilder.oloxa.ai

---

## Files Generated

1. **Implementation Summary:** `sop-builder-comprehensive-update-2026-01-28.md`
2. **Workflow Diagram:** `sop-builder-workflow-diagram-2026-01-28.md`
3. **Checklist (this file):** `sop-builder-update-checklist-2026-01-28.md`

---

## Support

If you encounter issues:
1. Check execution logs in n8n
2. Verify Airtable schema matches requirements
3. Test form submission manually
4. Contact: solution-builder-agent for workflow fixes

**Estimated Testing Time:** 30-45 minutes

**Status:** Ready for testing
